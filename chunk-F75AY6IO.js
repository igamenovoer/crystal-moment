import{a as c,b as m,c as ce,d as S,e as bl,f as $e,g as xn,h as f,i as y,j as C,k as ie,l as D}from"./chunk-TJICSKBO.js";var ci=S((cm,li)=>{"use strict";li.exports=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var yi=S((dm,On)=>{"use strict";var wl=/[\p{Lu}]/u,vl=/[\p{Ll}]/u,di=/^[\p{Lu}](?![\p{Lu}])/gu,pi=/([\p{Alpha}\p{N}_]|$)/u,mi=/[_.\- ]+/,El=new RegExp("^"+mi.source),fi=new RegExp(mi.source+pi.source,"gu"),hi=new RegExp("\\d+"+pi.source,"gu"),xl=(n,e,t)=>{let r=!1,a=!1,i=!1;for(let s=0;s<n.length;s++){let o=n[s];r&&wl.test(o)?(n=n.slice(0,s)+"-"+n.slice(s),r=!1,i=a,a=!0,s++):a&&i&&vl.test(o)?(n=n.slice(0,s-1)+"-"+n.slice(s-1),i=a,a=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=a,a=t(o)===o&&e(o)!==o)}return n},Ol=(n,e)=>(di.lastIndex=0,n.replace(di,t=>e(t))),Tl=(n,e)=>(fi.lastIndex=0,hi.lastIndex=0,n.replace(fi,(t,r)=>e(r)).replace(hi,t=>e(t))),gi=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e=c({pascalCase:!1,preserveConsecutiveUppercase:!1},e),Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";let t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=xl(n,t,r)),n=n.replace(El,""),e.preserveConsecutiveUppercase?n=Ol(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),Tl(n,r))};On.exports=gi;On.exports.default=gi});var Hi=S((mg,qi)=>{"use strict";function we(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}qi.exports=we;we.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};we.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};we.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};we.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};we.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};we.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};we.prototype.start=we.prototype.try;we.prototype.errors=function(){return this._errors};we.prototype.attempts=function(){return this._attempts};we.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var a=this._errors[r],i=a.message,s=(n[i]||0)+1;n[i]=s,s>=t&&(e=a,t=s)}return e}});var Bi=S(it=>{"use strict";var Ac=Hi();it.operation=function(n){var e=it.timeouts(n);return new Ac(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};it.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],a=0;a<e.retries;a++)r.push(this.createTimeout(a,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(a,e)),r.sort(function(i,s){return i-s}),r};it.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};it.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var a=0;a<t.length;a++){var i=t[a],s=n[i];n[i]=(function(u){var l=it.operation(e),d=Array.prototype.slice.call(arguments,1),h=d.pop();d.push(function(p){l.retry(p)||(p&&(arguments[0]=l.mainError()),h.apply(this,arguments))}),l.attempt(function(){u.apply(n,d)})}).bind(n,s),n[i].options=e}}});var Gi=S((yg,Vi)=>{"use strict";Vi.exports=Bi()});var Rr=S((Ji,Ir)=>{"use strict";var Cc=Gi(),Nc=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Sr=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},$c=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},jc=n=>Nc.includes(n),zi=(n,e)=>new Promise((t,r)=>{e=c({onFailedAttempt:()=>{},retries:10},e);let a=Cc.operation(e);a.attempt(i=>f(Ji,null,function*(){try{t(yield n(i))}catch(s){if(!(s instanceof Error)){r(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof Sr)a.stop(),r(s.originalError);else if(s instanceof TypeError&&!jc(s.message))a.stop(),r(s);else{$c(s,i,e);try{yield e.onFailedAttempt(s)}catch(o){r(o);return}a.retry(s)||r(a.mainError())}}}))});Ir.exports=zi;Ir.exports.default=zi;Ir.exports.AbortError=Sr});var is=S((ty,Qn)=>{"use strict";var Qc=Object.prototype.hasOwnProperty,fe="~";function Vt(){}Object.create&&(Vt.prototype=Object.create(null),new Vt().__proto__||(fe=!1));function ed(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function as(n,e,t,r,a){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new ed(t,r||n,a),s=fe?fe+e:e;return n._events[s]?n._events[s].fn?n._events[s]=[n._events[s],i]:n._events[s].push(i):(n._events[s]=i,n._eventsCount++),n}function Dr(n,e){--n._eventsCount===0?n._events=new Vt:delete n._events[e]}function oe(){this._events=new Vt,this._eventsCount=0}oe.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)Qc.call(t,r)&&e.push(fe?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};oe.prototype.listeners=function(e){var t=fe?fe+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,i=r.length,s=new Array(i);a<i;a++)s[a]=r[a].fn;return s};oe.prototype.listenerCount=function(e){var t=fe?fe+e:e,r=this._events[t];return r?r.fn?1:r.length:0};oe.prototype.emit=function(e,t,r,a,i,s){var o=fe?fe+e:e;if(!this._events[o])return!1;var u=this._events[o],l=arguments.length,d,h;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,i),!0;case 6:return u.fn.call(u.context,t,r,a,i,s),!0}for(h=1,d=new Array(l-1);h<l;h++)d[h-1]=arguments[h];u.fn.apply(u.context,d)}else{var p=u.length,g;for(h=0;h<p;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),l){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,r);break;case 4:u[h].fn.call(u[h].context,t,r,a);break;default:if(!d)for(g=1,d=new Array(l-1);g<l;g++)d[g-1]=arguments[g];u[h].fn.apply(u[h].context,d)}}return!0};oe.prototype.on=function(e,t,r){return as(this,e,t,r,!1)};oe.prototype.once=function(e,t,r){return as(this,e,t,r,!0)};oe.prototype.removeListener=function(e,t,r,a){var i=fe?fe+e:e;if(!this._events[i])return this;if(!t)return Dr(this,i),this;var s=this._events[i];if(s.fn)s.fn===t&&(!a||s.once)&&(!r||s.context===r)&&Dr(this,i);else{for(var o=0,u=[],l=s.length;o<l;o++)(s[o].fn!==t||a&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[i]=u.length===1?u[0]:u:Dr(this,i)}return this};oe.prototype.removeAllListeners=function(e){var t;return e?(t=fe?fe+e:e,this._events[t]&&Dr(this,t)):(this._events=new Vt,this._eventsCount=0),this};oe.prototype.off=oe.prototype.removeListener;oe.prototype.addListener=oe.prototype.on;oe.prefixed=fe;oe.EventEmitter=oe;typeof Qn<"u"&&(Qn.exports=oe)});var os=S((ry,ss)=>{"use strict";ss.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var ls=S((ny,Fr)=>{"use strict";var td=os(),Ur=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},us=(n,e,t)=>new Promise((r,a)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(u){a(u)}return}let s=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Ur(s);typeof n.cancel=="function"&&n.cancel(),a(o)},e);td(n.then(r,a),()=>{clearTimeout(i)})});Fr.exports=us;Fr.exports.default=us;Fr.exports.TimeoutError=Ur});var cs=S(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});function rd(n,e,t){let r=0,a=n.length;for(;a>0;){let i=a/2|0,s=r+i;t(n[s],e)<=0?(r=++s,a-=i+1):a=i}return r}ea.default=rd});var ds=S(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});var nd=cs(),ta=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let a=nd.default(this._queue,r,(i,s)=>s.priority-i.priority);this._queue.splice(a,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};ra.default=ta});var qr=S(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});var ad=is(),fs=ls(),id=ds(),Zr=()=>{},sd=new fs.TimeoutError,na=class extends ad{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Zr,this._resolveIdle=Zr,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:id.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(a=e.interval)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Zr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Zr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}add(r){return f(this,arguments,function*(e,t={}){return new Promise((a,i)=>{let s=()=>f(this,null,function*(){this._pendingCount++,this._intervalCount++;try{let o=this._timeout===void 0&&t.timeout===void 0?e():fs.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&i(sd)});a(yield o)}catch(o){i(o)}this._next()});this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})})}addAll(e,t){return f(this,null,function*(){return Promise.all(e.map(r=>f(this,null,function*(){return this.add(r,t)})))})}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}onEmpty(){return f(this,null,function*(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})})}onIdle(){return f(this,null,function*(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};aa.default=na});var zt=S((by,ys)=>{"use strict";var _d="2.0.0",bd=Number.MAX_SAFE_INTEGER||9007199254740991,wd=16,vd=250,Ed=["major","premajor","minor","preminor","patch","prepatch","prerelease"];ys.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:wd,MAX_SAFE_BUILD_LENGTH:vd,MAX_SAFE_INTEGER:bd,RELEASE_TYPES:Ed,SEMVER_SPEC_VERSION:_d,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Jt=S((wy,_s)=>{"use strict";var xd=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};_s.exports=xd});var St=S((Ve,bs)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:la,MAX_SAFE_BUILD_LENGTH:Od,MAX_LENGTH:Td}=zt(),Sd=Jt();Ve=bs.exports={};var Id=Ve.re=[],Rd=Ve.safeRe=[],x=Ve.src=[],O=Ve.t={},kd=0,ca="[a-zA-Z0-9-]",Pd=[["\\s",1],["\\d",Td],[ca,Od]],Ad=n=>{for(let[e,t]of Pd)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},N=(n,e,t)=>{let r=Ad(e),a=kd++;Sd(n,a,e),O[n]=a,x[a]=e,Id[a]=new RegExp(e,t?"g":void 0),Rd[a]=new RegExp(r,t?"g":void 0)};N("NUMERICIDENTIFIER","0|[1-9]\\d*");N("NUMERICIDENTIFIERLOOSE","\\d+");N("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${ca}*`);N("MAINVERSION",`(${x[O.NUMERICIDENTIFIER]})\\.(${x[O.NUMERICIDENTIFIER]})\\.(${x[O.NUMERICIDENTIFIER]})`);N("MAINVERSIONLOOSE",`(${x[O.NUMERICIDENTIFIERLOOSE]})\\.(${x[O.NUMERICIDENTIFIERLOOSE]})\\.(${x[O.NUMERICIDENTIFIERLOOSE]})`);N("PRERELEASEIDENTIFIER",`(?:${x[O.NUMERICIDENTIFIER]}|${x[O.NONNUMERICIDENTIFIER]})`);N("PRERELEASEIDENTIFIERLOOSE",`(?:${x[O.NUMERICIDENTIFIERLOOSE]}|${x[O.NONNUMERICIDENTIFIER]})`);N("PRERELEASE",`(?:-(${x[O.PRERELEASEIDENTIFIER]}(?:\\.${x[O.PRERELEASEIDENTIFIER]})*))`);N("PRERELEASELOOSE",`(?:-?(${x[O.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${x[O.PRERELEASEIDENTIFIERLOOSE]})*))`);N("BUILDIDENTIFIER",`${ca}+`);N("BUILD",`(?:\\+(${x[O.BUILDIDENTIFIER]}(?:\\.${x[O.BUILDIDENTIFIER]})*))`);N("FULLPLAIN",`v?${x[O.MAINVERSION]}${x[O.PRERELEASE]}?${x[O.BUILD]}?`);N("FULL",`^${x[O.FULLPLAIN]}$`);N("LOOSEPLAIN",`[v=\\s]*${x[O.MAINVERSIONLOOSE]}${x[O.PRERELEASELOOSE]}?${x[O.BUILD]}?`);N("LOOSE",`^${x[O.LOOSEPLAIN]}$`);N("GTLT","((?:<|>)?=?)");N("XRANGEIDENTIFIERLOOSE",`${x[O.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);N("XRANGEIDENTIFIER",`${x[O.NUMERICIDENTIFIER]}|x|X|\\*`);N("XRANGEPLAIN",`[v=\\s]*(${x[O.XRANGEIDENTIFIER]})(?:\\.(${x[O.XRANGEIDENTIFIER]})(?:\\.(${x[O.XRANGEIDENTIFIER]})(?:${x[O.PRERELEASE]})?${x[O.BUILD]}?)?)?`);N("XRANGEPLAINLOOSE",`[v=\\s]*(${x[O.XRANGEIDENTIFIERLOOSE]})(?:\\.(${x[O.XRANGEIDENTIFIERLOOSE]})(?:\\.(${x[O.XRANGEIDENTIFIERLOOSE]})(?:${x[O.PRERELEASELOOSE]})?${x[O.BUILD]}?)?)?`);N("XRANGE",`^${x[O.GTLT]}\\s*${x[O.XRANGEPLAIN]}$`);N("XRANGELOOSE",`^${x[O.GTLT]}\\s*${x[O.XRANGEPLAINLOOSE]}$`);N("COERCEPLAIN",`(^|[^\\d])(\\d{1,${la}})(?:\\.(\\d{1,${la}}))?(?:\\.(\\d{1,${la}}))?`);N("COERCE",`${x[O.COERCEPLAIN]}(?:$|[^\\d])`);N("COERCEFULL",x[O.COERCEPLAIN]+`(?:${x[O.PRERELEASE]})?(?:${x[O.BUILD]})?(?:$|[^\\d])`);N("COERCERTL",x[O.COERCE],!0);N("COERCERTLFULL",x[O.COERCEFULL],!0);N("LONETILDE","(?:~>?)");N("TILDETRIM",`(\\s*)${x[O.LONETILDE]}\\s+`,!0);Ve.tildeTrimReplace="$1~";N("TILDE",`^${x[O.LONETILDE]}${x[O.XRANGEPLAIN]}$`);N("TILDELOOSE",`^${x[O.LONETILDE]}${x[O.XRANGEPLAINLOOSE]}$`);N("LONECARET","(?:\\^)");N("CARETTRIM",`(\\s*)${x[O.LONECARET]}\\s+`,!0);Ve.caretTrimReplace="$1^";N("CARET",`^${x[O.LONECARET]}${x[O.XRANGEPLAIN]}$`);N("CARETLOOSE",`^${x[O.LONECARET]}${x[O.XRANGEPLAINLOOSE]}$`);N("COMPARATORLOOSE",`^${x[O.GTLT]}\\s*(${x[O.LOOSEPLAIN]})$|^$`);N("COMPARATOR",`^${x[O.GTLT]}\\s*(${x[O.FULLPLAIN]})$|^$`);N("COMPARATORTRIM",`(\\s*)${x[O.GTLT]}\\s*(${x[O.LOOSEPLAIN]}|${x[O.XRANGEPLAIN]})`,!0);Ve.comparatorTrimReplace="$1$2$3";N("HYPHENRANGE",`^\\s*(${x[O.XRANGEPLAIN]})\\s+-\\s+(${x[O.XRANGEPLAIN]})\\s*$`);N("HYPHENRANGELOOSE",`^\\s*(${x[O.XRANGEPLAINLOOSE]})\\s+-\\s+(${x[O.XRANGEPLAINLOOSE]})\\s*$`);N("STAR","(<|>)?=?\\s*\\*");N("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");N("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var zr=S((vy,ws)=>{"use strict";var Cd=Object.freeze({loose:!0}),Nd=Object.freeze({}),$d=n=>n?typeof n!="object"?Cd:n:Nd;ws.exports=$d});var da=S((Ey,xs)=>{"use strict";var vs=/^[0-9]+$/,Es=(n,e)=>{let t=vs.test(n),r=vs.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},jd=(n,e)=>Es(e,n);xs.exports={compareIdentifiers:Es,rcompareIdentifiers:jd}});var ue=S((xy,Is)=>{"use strict";var Jr=Jt(),{MAX_LENGTH:Os,MAX_SAFE_INTEGER:Wr}=zt(),{safeRe:Ts,t:Ss}=St(),Ld=zr(),{compareIdentifiers:It}=da(),fa=class n{constructor(e,t){if(t=Ld(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Os)throw new TypeError(`version is longer than ${Os} characters`);Jr("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?Ts[Ss.LOOSE]:Ts[Ss.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Wr||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Wr||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Wr||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(a=>{if(/^[0-9]+$/.test(a)){let i=+a;if(i>=0&&i<Wr)return i}return a}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Jr("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),It(this.major,e.major)||It(this.minor,e.minor)||It(this.patch,e.patch)}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],a=e.prerelease[t];if(Jr("prerelease compare",t,r,a),r===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(r===void 0)return-1;if(r===a)continue;return It(r,a)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],a=e.build[t];if(Jr("build compare",t,r,a),r===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(r===void 0)return-1;if(r===a)continue;return It(r,a)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let a=Number(r)?1:0;if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[a];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(a)}}if(t){let i=[t,a];r===!1&&(i=[t]),It(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Is.exports=fa});var dt=S((Oy,ks)=>{"use strict";var Rs=ue(),Md=(n,e,t=!1)=>{if(n instanceof Rs)return n;try{return new Rs(n,e)}catch(r){if(!t)return null;throw r}};ks.exports=Md});var As=S((Ty,Ps)=>{"use strict";var Dd=dt(),Ud=(n,e)=>{let t=Dd(n,e);return t?t.version:null};Ps.exports=Ud});var Ns=S((Sy,Cs)=>{"use strict";var Fd=dt(),Zd=(n,e)=>{let t=Fd(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Cs.exports=Zd});var Ls=S((Iy,js)=>{"use strict";var $s=ue(),qd=(n,e,t,r,a)=>{typeof t=="string"&&(a=r,r=t,t=void 0);try{return new $s(n instanceof $s?n.version:n,t).inc(e,r,a).version}catch{return null}};js.exports=qd});var Us=S((Ry,Ds)=>{"use strict";var Ms=dt(),Hd=(n,e)=>{let t=Ms(n,null,!0),r=Ms(e,null,!0),a=t.compare(r);if(a===0)return null;let i=a>0,s=i?t:r,o=i?r:t,u=!!s.prerelease.length;if(!!o.prerelease.length&&!u)return!o.patch&&!o.minor?"major":s.patch?"patch":s.minor?"minor":"major";let d=u?"pre":"";return t.major!==r.major?d+"major":t.minor!==r.minor?d+"minor":t.patch!==r.patch?d+"patch":"prerelease"};Ds.exports=Hd});var Zs=S((ky,Fs)=>{"use strict";var Bd=ue(),Vd=(n,e)=>new Bd(n,e).major;Fs.exports=Vd});var Hs=S((Py,qs)=>{"use strict";var Gd=ue(),zd=(n,e)=>new Gd(n,e).minor;qs.exports=zd});var Vs=S((Ay,Bs)=>{"use strict";var Jd=ue(),Wd=(n,e)=>new Jd(n,e).patch;Bs.exports=Wd});var zs=S((Cy,Gs)=>{"use strict";var Kd=dt(),Xd=(n,e)=>{let t=Kd(n,e);return t&&t.prerelease.length?t.prerelease:null};Gs.exports=Xd});var xe=S((Ny,Ws)=>{"use strict";var Js=ue(),Yd=(n,e,t)=>new Js(n,t).compare(new Js(e,t));Ws.exports=Yd});var Xs=S(($y,Ks)=>{"use strict";var Qd=xe(),ef=(n,e,t)=>Qd(e,n,t);Ks.exports=ef});var Qs=S((jy,Ys)=>{"use strict";var tf=xe(),rf=(n,e)=>tf(n,e,!0);Ys.exports=rf});var Kr=S((Ly,to)=>{"use strict";var eo=ue(),nf=(n,e,t)=>{let r=new eo(n,t),a=new eo(e,t);return r.compare(a)||r.compareBuild(a)};to.exports=nf});var no=S((My,ro)=>{"use strict";var af=Kr(),sf=(n,e)=>n.sort((t,r)=>af(t,r,e));ro.exports=sf});var io=S((Dy,ao)=>{"use strict";var of=Kr(),uf=(n,e)=>n.sort((t,r)=>of(r,t,e));ao.exports=uf});var Wt=S((Uy,so)=>{"use strict";var lf=xe(),cf=(n,e,t)=>lf(n,e,t)>0;so.exports=cf});var Xr=S((Fy,oo)=>{"use strict";var df=xe(),ff=(n,e,t)=>df(n,e,t)<0;oo.exports=ff});var ha=S((Zy,uo)=>{"use strict";var hf=xe(),pf=(n,e,t)=>hf(n,e,t)===0;uo.exports=pf});var pa=S((qy,lo)=>{"use strict";var mf=xe(),gf=(n,e,t)=>mf(n,e,t)!==0;lo.exports=gf});var Yr=S((Hy,co)=>{"use strict";var yf=xe(),_f=(n,e,t)=>yf(n,e,t)>=0;co.exports=_f});var Qr=S((By,fo)=>{"use strict";var bf=xe(),wf=(n,e,t)=>bf(n,e,t)<=0;fo.exports=wf});var ma=S((Vy,ho)=>{"use strict";var vf=ha(),Ef=pa(),xf=Wt(),Of=Yr(),Tf=Xr(),Sf=Qr(),If=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return vf(n,t,r);case"!=":return Ef(n,t,r);case">":return xf(n,t,r);case">=":return Of(n,t,r);case"<":return Tf(n,t,r);case"<=":return Sf(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};ho.exports=If});var mo=S((Gy,po)=>{"use strict";var Rf=ue(),kf=dt(),{safeRe:en,t:tn}=St(),Pf=(n,e)=>{if(n instanceof Rf)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?en[tn.COERCEFULL]:en[tn.COERCE]);else{let u=e.includePrerelease?en[tn.COERCERTLFULL]:en[tn.COERCERTL],l;for(;(l=u.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||l.index+l[0].length!==t.index+t[0].length)&&(t=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(t===null)return null;let r=t[2],a=t[3]||"0",i=t[4]||"0",s=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return kf(`${r}.${a}.${i}${s}${o}`,e)};po.exports=Pf});var yo=S((zy,go)=>{"use strict";var ga=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let a=this.map.keys().next().value;this.delete(a)}this.map.set(e,t)}return this}};go.exports=ga});var Oe=S((Jy,vo)=>{"use strict";var Af=/\s+/g,ya=class n{constructor(e,t){if(t=Nf(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof _a)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(Af," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(a=>!bo(a[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let a of this.set)if(a.length===1&&Ff(a[0])){this.set=[a];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&Df)|(this.options.loose&&Uf))+":"+e,a=_o.get(r);if(a)return a;let i=this.options.loose,s=i?ye[he.HYPHENRANGELOOSE]:ye[he.HYPHENRANGE];e=e.replace(s,Kf(this.options.includePrerelease)),z("hyphen replace",e),e=e.replace(ye[he.COMPARATORTRIM],jf),z("comparator trim",e),e=e.replace(ye[he.TILDETRIM],Lf),z("tilde trim",e),e=e.replace(ye[he.CARETTRIM],Mf),z("caret trim",e);let o=e.split(" ").map(h=>Zf(h,this.options)).join(" ").split(/\s+/).map(h=>Wf(h,this.options));i&&(o=o.filter(h=>(z("loose invalid filter",h,this.options),!!h.match(ye[he.COMPARATORLOOSE])))),z("range list",o);let u=new Map,l=o.map(h=>new _a(h,this.options));for(let h of l){if(bo(h))return[h];u.set(h.value,h)}u.size>1&&u.has("")&&u.delete("");let d=[...u.values()];return _o.set(r,d),d}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>wo(r,t)&&e.set.some(a=>wo(a,t)&&r.every(i=>a.every(s=>i.intersects(s,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new $f(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Xf(this.set[t],e,this.options))return!0;return!1}};vo.exports=ya;var Cf=yo(),_o=new Cf,Nf=zr(),_a=Kt(),z=Jt(),$f=ue(),{safeRe:ye,t:he,comparatorTrimReplace:jf,tildeTrimReplace:Lf,caretTrimReplace:Mf}=St(),{FLAG_INCLUDE_PRERELEASE:Df,FLAG_LOOSE:Uf}=zt(),bo=n=>n.value==="<0.0.0-0",Ff=n=>n.value==="",wo=(n,e)=>{let t=!0,r=n.slice(),a=r.pop();for(;t&&r.length;)t=r.every(i=>a.intersects(i,e)),a=r.pop();return t},Zf=(n,e)=>(z("comp",n,e),n=Bf(n,e),z("caret",n),n=qf(n,e),z("tildes",n),n=Gf(n,e),z("xrange",n),n=Jf(n,e),z("stars",n),n),pe=n=>!n||n.toLowerCase()==="x"||n==="*",qf=(n,e)=>n.trim().split(/\s+/).map(t=>Hf(t,e)).join(" "),Hf=(n,e)=>{let t=e.loose?ye[he.TILDELOOSE]:ye[he.TILDE];return n.replace(t,(r,a,i,s,o)=>{z("tilde",n,r,a,i,s,o);let u;return pe(a)?u="":pe(i)?u=`>=${a}.0.0 <${+a+1}.0.0-0`:pe(s)?u=`>=${a}.${i}.0 <${a}.${+i+1}.0-0`:o?(z("replaceTilde pr",o),u=`>=${a}.${i}.${s}-${o} <${a}.${+i+1}.0-0`):u=`>=${a}.${i}.${s} <${a}.${+i+1}.0-0`,z("tilde return",u),u})},Bf=(n,e)=>n.trim().split(/\s+/).map(t=>Vf(t,e)).join(" "),Vf=(n,e)=>{z("caret",n,e);let t=e.loose?ye[he.CARETLOOSE]:ye[he.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(a,i,s,o,u)=>{z("caret",n,a,i,s,o,u);let l;return pe(i)?l="":pe(s)?l=`>=${i}.0.0${r} <${+i+1}.0.0-0`:pe(o)?i==="0"?l=`>=${i}.${s}.0${r} <${i}.${+s+1}.0-0`:l=`>=${i}.${s}.0${r} <${+i+1}.0.0-0`:u?(z("replaceCaret pr",u),i==="0"?s==="0"?l=`>=${i}.${s}.${o}-${u} <${i}.${s}.${+o+1}-0`:l=`>=${i}.${s}.${o}-${u} <${i}.${+s+1}.0-0`:l=`>=${i}.${s}.${o}-${u} <${+i+1}.0.0-0`):(z("no pr"),i==="0"?s==="0"?l=`>=${i}.${s}.${o}${r} <${i}.${s}.${+o+1}-0`:l=`>=${i}.${s}.${o}${r} <${i}.${+s+1}.0-0`:l=`>=${i}.${s}.${o} <${+i+1}.0.0-0`),z("caret return",l),l})},Gf=(n,e)=>(z("replaceXRanges",n,e),n.split(/\s+/).map(t=>zf(t,e)).join(" ")),zf=(n,e)=>{n=n.trim();let t=e.loose?ye[he.XRANGELOOSE]:ye[he.XRANGE];return n.replace(t,(r,a,i,s,o,u)=>{z("xRange",n,r,a,i,s,o,u);let l=pe(i),d=l||pe(s),h=d||pe(o),p=h;return a==="="&&p&&(a=""),u=e.includePrerelease?"-0":"",l?a===">"||a==="<"?r="<0.0.0-0":r="*":a&&p?(d&&(s=0),o=0,a===">"?(a=">=",d?(i=+i+1,s=0,o=0):(s=+s+1,o=0)):a==="<="&&(a="<",d?i=+i+1:s=+s+1),a==="<"&&(u="-0"),r=`${a+i}.${s}.${o}${u}`):d?r=`>=${i}.0.0${u} <${+i+1}.0.0-0`:h&&(r=`>=${i}.${s}.0${u} <${i}.${+s+1}.0-0`),z("xRange return",r),r})},Jf=(n,e)=>(z("replaceStars",n,e),n.trim().replace(ye[he.STAR],"")),Wf=(n,e)=>(z("replaceGTE0",n,e),n.trim().replace(ye[e.includePrerelease?he.GTE0PRE:he.GTE0],"")),Kf=n=>(e,t,r,a,i,s,o,u,l,d,h,p)=>(pe(r)?t="":pe(a)?t=`>=${r}.0.0${n?"-0":""}`:pe(i)?t=`>=${r}.${a}.0${n?"-0":""}`:s?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,pe(l)?u="":pe(d)?u=`<${+l+1}.0.0-0`:pe(h)?u=`<${l}.${+d+1}.0-0`:p?u=`<=${l}.${d}.${h}-${p}`:n?u=`<${l}.${d}.${+h+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),Xf=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(z(n[r].semver),n[r].semver!==_a.ANY&&n[r].semver.prerelease.length>0){let a=n[r].semver;if(a.major===e.major&&a.minor===e.minor&&a.patch===e.patch)return!0}return!1}return!0}});var Kt=S((Wy,Io)=>{"use strict";var Xt=Symbol("SemVer ANY"),va=class n{static get ANY(){return Xt}constructor(e,t){if(t=Eo(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),wa("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Xt?this.value="":this.value=this.operator+this.semver.version,wa("comp",this)}parse(e){let t=this.options.loose?xo[Oo.COMPARATORLOOSE]:xo[Oo.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new To(r[2],this.options.loose):this.semver=Xt}toString(){return this.value}test(e){if(wa("Comparator.test",e,this.options.loose),this.semver===Xt||e===Xt)return!0;if(typeof e=="string")try{e=new To(e,this.options)}catch{return!1}return ba(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new So(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new So(this.value,t).test(e.semver):(t=Eo(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||ba(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||ba(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Io.exports=va;var Eo=zr(),{safeRe:xo,t:Oo}=St(),ba=ma(),wa=Jt(),To=ue(),So=Oe()});var Yt=S((Ky,Ro)=>{"use strict";var Yf=Oe(),Qf=(n,e,t)=>{try{e=new Yf(e,t)}catch{return!1}return e.test(n)};Ro.exports=Qf});var Po=S((Xy,ko)=>{"use strict";var eh=Oe(),th=(n,e)=>new eh(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));ko.exports=th});var Co=S((Yy,Ao)=>{"use strict";var rh=ue(),nh=Oe(),ah=(n,e,t)=>{let r=null,a=null,i=null;try{i=new nh(e,t)}catch{return null}return n.forEach(s=>{i.test(s)&&(!r||a.compare(s)===-1)&&(r=s,a=new rh(r,t))}),r};Ao.exports=ah});var $o=S((Qy,No)=>{"use strict";var ih=ue(),sh=Oe(),oh=(n,e,t)=>{let r=null,a=null,i=null;try{i=new sh(e,t)}catch{return null}return n.forEach(s=>{i.test(s)&&(!r||a.compare(s)===1)&&(r=s,a=new ih(r,t))}),r};No.exports=oh});var Mo=S((e_,Lo)=>{"use strict";var Ea=ue(),uh=Oe(),jo=Wt(),lh=(n,e)=>{n=new uh(n,e);let t=new Ea("0.0.0");if(n.test(t)||(t=new Ea("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let a=n.set[r],i=null;a.forEach(s=>{let o=new Ea(s.semver.version);switch(s.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||jo(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),i&&(!t||jo(t,i))&&(t=i)}return t&&n.test(t)?t:null};Lo.exports=lh});var Uo=S((t_,Do)=>{"use strict";var ch=Oe(),dh=(n,e)=>{try{return new ch(n,e).range||"*"}catch{return null}};Do.exports=dh});var rn=S((r_,Ho)=>{"use strict";var fh=ue(),qo=Kt(),{ANY:hh}=qo,ph=Oe(),mh=Yt(),Fo=Wt(),Zo=Xr(),gh=Qr(),yh=Yr(),_h=(n,e,t,r)=>{n=new fh(n,r),e=new ph(e,r);let a,i,s,o,u;switch(t){case">":a=Fo,i=gh,s=Zo,o=">",u=">=";break;case"<":a=Zo,i=yh,s=Fo,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(mh(n,e,r))return!1;for(let l=0;l<e.set.length;++l){let d=e.set[l],h=null,p=null;if(d.forEach(g=>{g.semver===hh&&(g=new qo(">=0.0.0")),h=h||g,p=p||g,a(g.semver,h.semver,r)?h=g:s(g.semver,p.semver,r)&&(p=g)}),h.operator===o||h.operator===u||(!p.operator||p.operator===o)&&i(n,p.semver))return!1;if(p.operator===u&&s(n,p.semver))return!1}return!0};Ho.exports=_h});var Vo=S((n_,Bo)=>{"use strict";var bh=rn(),wh=(n,e,t)=>bh(n,e,">",t);Bo.exports=wh});var zo=S((a_,Go)=>{"use strict";var vh=rn(),Eh=(n,e,t)=>vh(n,e,"<",t);Go.exports=Eh});var Ko=S((i_,Wo)=>{"use strict";var Jo=Oe(),xh=(n,e,t)=>(n=new Jo(n,t),e=new Jo(e,t),n.intersects(e,t));Wo.exports=xh});var Yo=S((s_,Xo)=>{"use strict";var Oh=Yt(),Th=xe();Xo.exports=(n,e,t)=>{let r=[],a=null,i=null,s=n.sort((d,h)=>Th(d,h,t));for(let d of s)Oh(d,e,t)?(i=d,a||(a=d)):(i&&r.push([a,i]),i=null,a=null);a&&r.push([a,null]);let o=[];for(let[d,h]of r)d===h?o.push(d):!h&&d===s[0]?o.push("*"):h?d===s[0]?o.push(`<=${h}`):o.push(`${d} - ${h}`):o.push(`>=${d}`);let u=o.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return u.length<l.length?u:e}});var au=S((o_,nu)=>{"use strict";var Qo=Oe(),Oa=Kt(),{ANY:xa}=Oa,Qt=Yt(),Ta=xe(),Sh=(n,e,t={})=>{if(n===e)return!0;n=new Qo(n,t),e=new Qo(e,t);let r=!1;e:for(let a of n.set){for(let i of e.set){let s=Rh(a,i,t);if(r=r||s!==null,s)continue e}if(r)return!1}return!0},Ih=[new Oa(">=0.0.0-0")],eu=[new Oa(">=0.0.0")],Rh=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===xa){if(e.length===1&&e[0].semver===xa)return!0;t.includePrerelease?n=Ih:n=eu}if(e.length===1&&e[0].semver===xa){if(t.includePrerelease)return!0;e=eu}let r=new Set,a,i;for(let g of n)g.operator===">"||g.operator===">="?a=tu(a,g,t):g.operator==="<"||g.operator==="<="?i=ru(i,g,t):r.add(g.semver);if(r.size>1)return null;let s;if(a&&i){if(s=Ta(a.semver,i.semver,t),s>0)return null;if(s===0&&(a.operator!==">="||i.operator!=="<="))return null}for(let g of r){if(a&&!Qt(g,String(a),t)||i&&!Qt(g,String(i),t))return null;for(let U of e)if(!Qt(g,String(U),t))return!1;return!0}let o,u,l,d,h=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,p=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1;h&&h.prerelease.length===1&&i.operator==="<"&&h.prerelease[0]===0&&(h=!1);for(let g of e){if(d=d||g.operator===">"||g.operator===">=",l=l||g.operator==="<"||g.operator==="<=",a){if(p&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===p.major&&g.semver.minor===p.minor&&g.semver.patch===p.patch&&(p=!1),g.operator===">"||g.operator===">="){if(o=tu(a,g,t),o===g&&o!==a)return!1}else if(a.operator===">="&&!Qt(a.semver,String(g),t))return!1}if(i){if(h&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===h.major&&g.semver.minor===h.minor&&g.semver.patch===h.patch&&(h=!1),g.operator==="<"||g.operator==="<="){if(u=ru(i,g,t),u===g&&u!==i)return!1}else if(i.operator==="<="&&!Qt(i.semver,String(g),t))return!1}if(!g.operator&&(i||a)&&s!==0)return!1}return!(a&&l&&!i&&s!==0||i&&d&&!a&&s!==0||p||h)},tu=(n,e,t)=>{if(!n)return e;let r=Ta(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},ru=(n,e,t)=>{if(!n)return e;let r=Ta(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};nu.exports=Sh});var uu=S((u_,ou)=>{"use strict";var Sa=St(),iu=zt(),kh=ue(),su=da(),Ph=dt(),Ah=As(),Ch=Ns(),Nh=Ls(),$h=Us(),jh=Zs(),Lh=Hs(),Mh=Vs(),Dh=zs(),Uh=xe(),Fh=Xs(),Zh=Qs(),qh=Kr(),Hh=no(),Bh=io(),Vh=Wt(),Gh=Xr(),zh=ha(),Jh=pa(),Wh=Yr(),Kh=Qr(),Xh=ma(),Yh=mo(),Qh=Kt(),ep=Oe(),tp=Yt(),rp=Po(),np=Co(),ap=$o(),ip=Mo(),sp=Uo(),op=rn(),up=Vo(),lp=zo(),cp=Ko(),dp=Yo(),fp=au();ou.exports={parse:Ph,valid:Ah,clean:Ch,inc:Nh,diff:$h,major:jh,minor:Lh,patch:Mh,prerelease:Dh,compare:Uh,rcompare:Fh,compareLoose:Zh,compareBuild:qh,sort:Hh,rsort:Bh,gt:Vh,lt:Gh,eq:zh,neq:Jh,gte:Wh,lte:Kh,cmp:Xh,coerce:Yh,Comparator:Qh,Range:ep,satisfies:tp,toComparators:rp,maxSatisfying:np,minSatisfying:ap,minVersion:ip,validRange:sp,outside:op,gtr:up,ltr:lp,intersects:cp,simplifyRange:dp,subset:fp,SemVer:kh,re:Sa.re,src:Sa.src,tokens:Sa.t,SEMVER_SPEC_VERSION:iu.SEMVER_SPEC_VERSION,RELEASE_TYPES:iu.RELEASE_TYPES,compareIdentifiers:su.compareIdentifiers,rcompareIdentifiers:su.rcompareIdentifiers}});var yu=S((F_,gu)=>{"use strict";var pu=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,mu=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function xp(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[a,i]of Object.entries(r))e[a]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},r[a]=e[a],n.set(i[0],i[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=pu(),e.color.ansi16m=mu(),e.bgColor.ansi256=pu(10),e.bgColor.ansi16m=mu(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,a)=>t===r&&r===a?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(a/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:a}=r.groups;a.length===3&&(a=a.split("").map(s=>s+s).join(""));let i=Number.parseInt(a,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(gu,"exports",{enumerable:!0,get:xp})});var _i=$e(ci(),1),Sl=$e(yi(),1);function bi(n,e){return e?.[n]||(0,_i.default)(n)}function wi(n,e,t){let r={};for(let a in n)Object.hasOwn(n,a)&&(r[e(a,t)]=n[a]);return r}function vi(n){return Array.isArray(n)?[...n]:c({},n)}function Il(n,e){let t=vi(n);for(let[r,a]of Object.entries(e)){let[i,...s]=r.split(".").reverse(),o=t;for(let u of s.reverse()){if(o[u]===void 0)break;o[u]=vi(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[a]})}return t}function Tn(n){let e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}var Re=class n{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Tn(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof n||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((a,i)=>(a[i]=i in this?this[i]:this.lc_kwargs[i],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let i=this,s=r,[o,...u]=a.split(".").reverse();for(let l of u.reverse()){if(!(l in i)||i[l]===void 0)return;(!(l in s)||s[l]===void 0)&&(typeof i[l]=="object"&&i[l]!=null?s[l]={}:Array.isArray(i[l])&&(s[l]=[])),i=i[l],s=s[l]}o in i&&i[o]!==void 0&&(s[o]=s[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:wi(Object.keys(t).length?Il(r,t):r,bi,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Qe(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?fr(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function Rl(n,e){function t(r,a){if(typeof r!="object"||r===null||r===void 0)return r;if(a>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(s=>t(s,a+1));let i={};for(let s of Object.keys(r))i[s]=t(r[s],a+1);return i}return JSON.stringify(t(n,0),null,2)}var je=class extends Re{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=Rl(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function Le(n,e){let t=c({},n);for(let[r,a]of Object.entries(e))if(t[r]==null)t[r]=a;else{if(a==null)continue;if(typeof t[r]!=typeof a||Array.isArray(t[r])!==Array.isArray(a))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=a}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Le(t[r],a);else if(Array.isArray(t[r]))t[r]=fr(t[r],a);else{if(t[r]===a)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function fr(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{let t=[...n];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let a=t.findIndex(i=>i.index===r.index);a!==-1?t[a]=Le(t[a],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}var Fe=class extends je{};var $t=class extends je{static lc_name(){return"HumanMessage"}_getType(){return"human"}};function Sn(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}var hr=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};function Ei(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="",t=[],r=!1,a=!1;for(let i of n){if(r)i==='"'&&!a?r=!1:i===`
`&&!a?i="\\n":i==="\\"?a=!a:a=!1;else if(i==='"')r=!0,a=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}r&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var et=class n extends Fe{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t=m(c({},e),{tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]});else{let r=[],a=[];for(let i of e.tool_call_chunks){let s={};try{if(s=Ei(i.args||"{}"),s===null||typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");r.push({name:i.name??"",args:s,id:i.id,type:"tool_call"})}catch{a.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t=m(c({},e),{tool_calls:r,invalid_tool_calls:a})}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return m(c({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"})}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return m(c({},super._printableFields),{tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata})}concat(e){let t={content:Qe(this.content,e.content),additional_kwargs:Le(this.additional_kwargs,e.additional_kwargs),response_metadata:Le(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let r=fr(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i={input_tokens:r.input_tokens+a.input_tokens,output_tokens:r.output_tokens+a.output_tokens,total_tokens:r.total_tokens+a.total_tokens};t.usage_metadata=i}return new n(t)}};function pr(n,e="Human",t="AI"){let r=[];for(let a of n){let i;if(a._getType()==="human")i=e;else if(a._getType()==="ai")i=t;else if(a._getType()==="system")i="System";else if(a._getType()==="function")i="Function";else if(a._getType()==="tool")i="Tool";else if(a._getType()==="generic")i=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);let s=a.name?`${a.name}, `:"",o=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);r.push(`${i}: ${s}${o}`)}return r.join(`
`)}var mr=class extends Re{},gr=class extends mr{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new $t(this.value)]}},xi=class extends mr{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return pr(this.messages)}toChatMessages(){return this.messages}};var q;(function(n){n.assertEqual=a=>a;function e(a){}n.assertIs=e;function t(a){throw new Error}n.assertNever=t,n.arrayToEnum=a=>{let i={};for(let s of a)i[s]=s;return i},n.getValidEnumValues=a=>{let i=n.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),s={};for(let o of i)s[o]=a[o];return n.objectValues(s)},n.objectValues=a=>n.objectKeys(a).map(function(i){return a[i]}),n.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let i=[];for(let s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},n.find=(a,i)=>{for(let s of a)if(i(s))return s},n.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(q||(q={}));var Si=function(n){return n.mergeShapes=(e,t)=>c(c({},e),t),n}(Si||{}),E=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Je=n=>{switch(typeof n){case"undefined":return E.undefined;case"string":return E.string;case"number":return isNaN(n)?E.nan:E.number;case"boolean":return E.boolean;case"function":return E.function;case"bigint":return E.bigint;case"symbol":return E.symbol;case"object":return Array.isArray(n)?E.array:n===null?E.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?E.promise:typeof Map<"u"&&n instanceof Map?E.map:typeof Set<"u"&&n instanceof Set?E.set:typeof Date<"u"&&n instanceof Date?E.date:E.object;default:return E.unknown}},_=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),kl=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),qe=(()=>{class n extends Error{constructor(t){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){let r=t||function(s){return s.message},a={_errors:[]},i=s=>{for(let o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)a._errors.push(r(o));else{let u=a,l=0;for(;l<o.path.length;){let d=o.path[l];l===o.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(r(o))):u[d]=u[d]||{_errors:[]},u=u[d],l++}}};return i(this),a}static assert(t){if(!(t instanceof n))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){let r={},a=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):a.push(t(i));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}return n.create=e=>new n(e),n})(),bt=(n,e)=>{let t;switch(n.code){case _.invalid_type:n.received===E.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case _.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,q.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:t=`Unrecognized key(s) in object: ${q.joinValues(n.keys,", ")}`;break;case _.invalid_union:t="Invalid input";break;case _.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${q.joinValues(n.options)}`;break;case _.invalid_enum_value:t=`Invalid enum value. Expected ${q.joinValues(n.options)}, received '${n.received}'`;break;case _.invalid_arguments:t="Invalid function arguments";break;case _.invalid_return_type:t="Invalid function return type";break;case _.invalid_date:t="Invalid date";break;case _.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:q.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case _.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case _.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case _.custom:t="Invalid input";break;case _.invalid_intersection_types:t="Intersection results could not be merged";break;case _.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case _.not_finite:t="Number must be finite";break;default:t=e.defaultError,q.assertNever(n)}return{message:t}},Ii=bt;function Pl(n){Ii=n}function yr(){return Ii}var _r=n=>{let{data:e,path:t,errorMaps:r,issueData:a}=n,i=[...t,...a.path||[]],s=m(c({},a),{path:i});if(a.message!==void 0)return m(c({},a),{path:i,message:a.message});let o="",u=r.filter(l=>!!l).slice().reverse();for(let l of u)o=l(s,{data:e,defaultError:o}).message;return m(c({},a),{path:i,message:o})},Al=[];function v(n,e){let t=yr(),r=_r({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===bt?void 0:bt].filter(a=>!!a)});n.common.issues.push(r)}var se=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if(a.status==="aborted")return A;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static mergeObjectAsync(e,t){return f(this,null,function*(){let r=[];for(let a of t){let i=yield a.key,s=yield a.value;r.push({key:i,value:s})}return n.mergeObjectSync(e,r)})}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:i,value:s}=a;if(i.status==="aborted"||s.status==="aborted")return A;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||a.alwaysSet)&&(r[i.value]=s.value)}return{status:e.value,value:r}}},A=Object.freeze({status:"aborted"}),_t=n=>({status:"dirty",value:n}),de=n=>({status:"valid",value:n}),Rn=n=>n.status==="aborted",kn=n=>n.status==="dirty",Dt=n=>n.status==="valid",Ut=n=>typeof Promise<"u"&&n instanceof Promise;function br(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function Ri(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t}var I=function(n){return n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message,n}(I||{}),jt,Lt,be=class{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Oi=(n,e)=>{if(Dt(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new qe(n.common.issues);return this._error=t,this._error}}};function $(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:a}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(s,o)=>{var u,l;let{message:d}=n;return s.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:(u=d??r)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=d??t)!==null&&l!==void 0?l:o.defaultError}},description:a}}var j=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Je(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new se,ctx:{common:e.parent.common,data:e.data,parsedType:Je(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Ut(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:(r=t?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Je(e)},i=this._parseSync({data:e,path:a.path,parent:a});return Oi(a,i)}parseAsync(e,t){return f(this,null,function*(){let r=yield this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error})}safeParseAsync(e,t){return f(this,null,function*(){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Je(e)},a=this._parse({data:e,path:r.path,parent:r}),i=yield Ut(a)?a:Promise.resolve(a);return Oi(r,i)})}refine(e,t){let r=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,i)=>{let s=e(a),o=()=>i.addIssue(c({code:_.custom},r(a)));return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof t=="function"?t(r,a):t),!1))}_refinement(e){return new at({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return We.create(this,this._def)}nullable(){return Et.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ft.create(this,this._def)}promise(){return Tr.create(this,this._def)}or(e){return Mn.create([this,e],this._def)}and(e){return Dn.create(this,e,this._def)}transform(e){return new at(m(c({},$(this._def)),{schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){let t=typeof e=="function"?e:()=>e;return new Zn(m(c({},$(this._def)),{innerType:this,defaultValue:t,typeName:b.ZodDefault}))}brand(){return new Zt(c({typeName:b.ZodBranded,type:this},$(this._def)))}catch(e){let t=typeof e=="function"?e:()=>e;return new qn(m(c({},$(this._def)),{innerType:this,catchValue:t,typeName:b.ZodCatch}))}describe(e){let t=this.constructor;return new t(m(c({},this._def),{description:e}))}pipe(e){return qt.create(this,e)}readonly(){return Hn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Cl=/^c[^\s-]{8,}$/i,Nl=/^[0-9a-z]+$/,$l=/^[0-9A-HJKMNP-TV-Z]{26}$/,jl=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ll=/^[a-z0-9_-]{21}$/i,Ml=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Dl=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ul="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",In,Fl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Zl=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ql=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ki="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Hl=new RegExp(`^${ki}$`);function Pi(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Bl(n){return new RegExp(`^${Pi(n)}$`)}function Ai(n){let e=`${ki}T${Pi(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Vl(n,e){return!!((e==="v4"||!e)&&Fl.test(n)||(e==="v6"||!e)&&Zl.test(n))}var Or=(()=>{class n extends j{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==E.string){let s=this._getOrReturnCtx(t);return v(s,{code:_.invalid_type,expected:E.string,received:s.parsedType}),A}let a=new se,i;for(let s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(i=this._getOrReturnCtx(t,i),v(i,{code:_.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")t.data.length>s.value&&(i=this._getOrReturnCtx(t,i),v(i,{code:_.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let o=t.data.length>s.value,u=t.data.length<s.value;(o||u)&&(i=this._getOrReturnCtx(t,i),o?v(i,{code:_.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):u&&v(i,{code:_.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")Dl.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"email",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")In||(In=new RegExp(Ul,"u")),In.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"emoji",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")jl.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"uuid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")Ll.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"nanoid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")Cl.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"cuid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")Nl.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"cuid2",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")$l.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"ulid",code:_.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{i=this._getOrReturnCtx(t,i),v(i,{validation:"url",code:_.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"regex",code:_.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(t,i),v(i,{code:_.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(i=this._getOrReturnCtx(t,i),v(i,{code:_.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(i=this._getOrReturnCtx(t,i),v(i,{code:_.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?Ai(s).test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{code:_.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?Hl.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{code:_.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?Bl(s).test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{code:_.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?Ml.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"duration",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?Vl(t.data,s.version)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"ip",code:_.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?ql.test(t.data)||(i=this._getOrReturnCtx(t,i),v(i,{validation:"base64",code:_.invalid_string,message:s.message}),a.dirty()):q.assertNever(s);return{status:a.value,value:t.data}}_regex(t,r,a){return this.refinement(i=>t.test(i),c({validation:r,code:_.invalid_string},I.errToObj(a)))}_addCheck(t){return new n(m(c({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(c({kind:"email"},I.errToObj(t)))}url(t){return this._addCheck(c({kind:"url"},I.errToObj(t)))}emoji(t){return this._addCheck(c({kind:"emoji"},I.errToObj(t)))}uuid(t){return this._addCheck(c({kind:"uuid"},I.errToObj(t)))}nanoid(t){return this._addCheck(c({kind:"nanoid"},I.errToObj(t)))}cuid(t){return this._addCheck(c({kind:"cuid"},I.errToObj(t)))}cuid2(t){return this._addCheck(c({kind:"cuid2"},I.errToObj(t)))}ulid(t){return this._addCheck(c({kind:"ulid"},I.errToObj(t)))}base64(t){return this._addCheck(c({kind:"base64"},I.errToObj(t)))}ip(t){return this._addCheck(c({kind:"ip"},I.errToObj(t)))}datetime(t){var r,a;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(c({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:(r=t?.offset)!==null&&r!==void 0?r:!1,local:(a=t?.local)!==null&&a!==void 0?a:!1},I.errToObj(t?.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(c({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision},I.errToObj(t?.message)))}duration(t){return this._addCheck(c({kind:"duration"},I.errToObj(t)))}regex(t,r){return this._addCheck(c({kind:"regex",regex:t},I.errToObj(r)))}includes(t,r){return this._addCheck(c({kind:"includes",value:t,position:r?.position},I.errToObj(r?.message)))}startsWith(t,r){return this._addCheck(c({kind:"startsWith",value:t},I.errToObj(r)))}endsWith(t,r){return this._addCheck(c({kind:"endsWith",value:t},I.errToObj(r)))}min(t,r){return this._addCheck(c({kind:"min",value:t},I.errToObj(r)))}max(t,r){return this._addCheck(c({kind:"max",value:t},I.errToObj(r)))}length(t,r){return this._addCheck(c({kind:"length",value:t},I.errToObj(r)))}nonempty(t){return this.min(1,I.errToObj(t))}trim(){return new n(m(c({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new n(m(c({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new n(m(c({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}return n.create=e=>{var t;return new n(c({checks:[],typeName:b.ZodString,coerce:(t=e?.coerce)!==null&&t!==void 0?t:!1},$(e)))},n})();function Gl(n,e){let t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=t>r?t:r,i=parseInt(n.toFixed(a).replace(".","")),s=parseInt(e.toFixed(a).replace(".",""));return i%s/Math.pow(10,a)}var An=(()=>{class n extends j{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==E.number){let s=this._getOrReturnCtx(t);return v(s,{code:_.invalid_type,expected:E.number,received:s.parsedType}),A}let a,i=new se;for(let s of this._def.checks)s.kind==="int"?q.isInteger(t.data)||(a=this._getOrReturnCtx(t,a),v(a,{code:_.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(a=this._getOrReturnCtx(t,a),v(a,{code:_.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(a=this._getOrReturnCtx(t,a),v(a,{code:_.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?Gl(t.data,s.value)!==0&&(a=this._getOrReturnCtx(t,a),v(a,{code:_.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(a=this._getOrReturnCtx(t,a),v(a,{code:_.not_finite,message:s.message}),i.dirty()):q.assertNever(s);return{status:i.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,I.toString(r))}gt(t,r){return this.setLimit("min",t,!1,I.toString(r))}lte(t,r){return this.setLimit("max",t,!0,I.toString(r))}lt(t,r){return this.setLimit("max",t,!1,I.toString(r))}setLimit(t,r,a,i){return new n(m(c({},this._def),{checks:[...this._def.checks,{kind:t,value:r,inclusive:a,message:I.toString(i)}]}))}_addCheck(t){return new n(m(c({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:I.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:I.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:I.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:I.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:I.toString(t)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&q.isInteger(t.value))}get isFinite(){let t=null,r=null;for(let a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(t===null||a.value<t)&&(t=a.value)}return Number.isFinite(r)&&Number.isFinite(t)}}return n.create=e=>new n(c({checks:[],typeName:b.ZodNumber,coerce:e?.coerce||!1},$(e))),n})(),Cn=(()=>{class n extends j{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==E.bigint){let s=this._getOrReturnCtx(t);return v(s,{code:_.invalid_type,expected:E.bigint,received:s.parsedType}),A}let a,i=new se;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(a=this._getOrReturnCtx(t,a),v(a,{code:_.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(a=this._getOrReturnCtx(t,a),v(a,{code:_.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(t,a),v(a,{code:_.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):q.assertNever(s);return{status:i.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,I.toString(r))}gt(t,r){return this.setLimit("min",t,!1,I.toString(r))}lte(t,r){return this.setLimit("max",t,!0,I.toString(r))}lt(t,r){return this.setLimit("max",t,!1,I.toString(r))}setLimit(t,r,a,i){return new n(m(c({},this._def),{checks:[...this._def.checks,{kind:t,value:r,inclusive:a,message:I.toString(i)}]}))}_addCheck(t){return new n(m(c({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:I.toString(r)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}return n.create=e=>{var t;return new n(c({checks:[],typeName:b.ZodBigInt,coerce:(t=e?.coerce)!==null&&t!==void 0?t:!1},$(e)))},n})(),Nn=(()=>{class n extends j{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==E.boolean){let a=this._getOrReturnCtx(t);return v(a,{code:_.invalid_type,expected:E.boolean,received:a.parsedType}),A}return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodBoolean,coerce:e?.coerce||!1},$(e))),n})(),$n=(()=>{class n extends j{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==E.date){let s=this._getOrReturnCtx(t);return v(s,{code:_.invalid_type,expected:E.date,received:s.parsedType}),A}if(isNaN(t.data.getTime())){let s=this._getOrReturnCtx(t);return v(s,{code:_.invalid_date}),A}let a=new se,i;for(let s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(i=this._getOrReturnCtx(t,i),v(i,{code:_.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(i=this._getOrReturnCtx(t,i),v(i,{code:_.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):q.assertNever(s);return{status:a.value,value:new Date(t.data.getTime())}}_addCheck(t){return new n(m(c({},this._def),{checks:[...this._def.checks,t]}))}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:I.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:I.toString(r)})}get minDate(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}return n.create=e=>new n(c({checks:[],coerce:e?.coerce||!1,typeName:b.ZodDate},$(e))),n})(),Ci=(()=>{class n extends j{_parse(t){if(this._getType(t)!==E.symbol){let a=this._getOrReturnCtx(t);return v(a,{code:_.invalid_type,expected:E.symbol,received:a.parsedType}),A}return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodSymbol},$(e))),n})(),jn=(()=>{class n extends j{_parse(t){if(this._getType(t)!==E.undefined){let a=this._getOrReturnCtx(t);return v(a,{code:_.invalid_type,expected:E.undefined,received:a.parsedType}),A}return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodUndefined},$(e))),n})(),Ln=(()=>{class n extends j{_parse(t){if(this._getType(t)!==E.null){let a=this._getOrReturnCtx(t);return v(a,{code:_.invalid_type,expected:E.null,received:a.parsedType}),A}return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodNull},$(e))),n})(),wr=(()=>{class n extends j{constructor(){super(...arguments),this._any=!0}_parse(t){return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodAny},$(e))),n})(),Mt=(()=>{class n extends j{constructor(){super(...arguments),this._unknown=!0}_parse(t){return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodUnknown},$(e))),n})(),tt=(()=>{class n extends j{_parse(t){let r=this._getOrReturnCtx(t);return v(r,{code:_.invalid_type,expected:E.never,received:r.parsedType}),A}}return n.create=e=>new n(c({typeName:b.ZodNever},$(e))),n})(),Ni=(()=>{class n extends j{_parse(t){if(this._getType(t)!==E.undefined){let a=this._getOrReturnCtx(t);return v(a,{code:_.invalid_type,expected:E.void,received:a.parsedType}),A}return de(t.data)}}return n.create=e=>new n(c({typeName:b.ZodVoid},$(e))),n})(),Ft=(()=>{class n extends j{_parse(t){let{ctx:r,status:a}=this._processInputParams(t),i=this._def;if(r.parsedType!==E.array)return v(r,{code:_.invalid_type,expected:E.array,received:r.parsedType}),A;if(i.exactLength!==null){let o=r.data.length>i.exactLength.value,u=r.data.length<i.exactLength.value;(o||u)&&(v(r,{code:o?_.too_big:_.too_small,minimum:u?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),a.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(v(r,{code:_.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),a.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(v(r,{code:_.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((o,u)=>i.type._parseAsync(new be(r,o,r.path,u)))).then(o=>se.mergeArray(a,o));let s=[...r.data].map((o,u)=>i.type._parseSync(new be(r,o,r.path,u)));return se.mergeArray(a,s)}get element(){return this._def.type}min(t,r){return new n(m(c({},this._def),{minLength:{value:t,message:I.toString(r)}}))}max(t,r){return new n(m(c({},this._def),{maxLength:{value:t,message:I.toString(r)}}))}length(t,r){return new n(m(c({},this._def),{exactLength:{value:t,message:I.toString(r)}}))}nonempty(t){return this.min(1,t)}}return n.create=(e,t)=>new n(c({type:e,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray},$(t))),n})();function yt(n){if(n instanceof wt){let e={};for(let t in n.shape){let r=n.shape[t];e[t]=We.create(yt(r))}return new wt(m(c({},n._def),{shape:()=>e}))}else return n instanceof Ft?new Ft(m(c({},n._def),{type:yt(n.element)})):n instanceof We?We.create(yt(n.unwrap())):n instanceof Et?Et.create(yt(n.unwrap())):n instanceof vt?vt.create(n.items.map(e=>yt(e))):n}var wt=(()=>{class n extends j{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),r=q.objectKeys(t);return this._cached={shape:t,keys:r}}_parse(t){if(this._getType(t)!==E.object){let d=this._getOrReturnCtx(t);return v(d,{code:_.invalid_type,expected:E.object,received:d.parsedType}),A}let{status:a,ctx:i}=this._processInputParams(t),{shape:s,keys:o}=this._getCached(),u=[];if(!(this._def.catchall instanceof tt&&this._def.unknownKeys==="strip"))for(let d in i.data)o.includes(d)||u.push(d);let l=[];for(let d of o){let h=s[d],p=i.data[d];l.push({key:{status:"valid",value:d},value:h._parse(new be(i,p,i.path,d)),alwaysSet:d in i.data})}if(this._def.catchall instanceof tt){let d=this._def.unknownKeys;if(d==="passthrough")for(let h of u)l.push({key:{status:"valid",value:h},value:{status:"valid",value:i.data[h]}});else if(d==="strict")u.length>0&&(v(i,{code:_.unrecognized_keys,keys:u}),a.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let h of u){let p=i.data[h];l.push({key:{status:"valid",value:h},value:d._parse(new be(i,p,i.path,h)),alwaysSet:h in i.data})}}return i.common.async?Promise.resolve().then(()=>f(this,null,function*(){let d=[];for(let h of l){let p=yield h.key,g=yield h.value;d.push({key:p,value:g,alwaysSet:h.alwaysSet})}return d})).then(d=>se.mergeObjectSync(a,d)):se.mergeObjectSync(a,l)}get shape(){return this._def.shape()}strict(t){return I.errToObj,new n(c(m(c({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(r,a)=>{var i,s,o,u;let l=(o=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,r,a).message)!==null&&o!==void 0?o:a.defaultError;return r.code==="unrecognized_keys"?{message:(u=I.errToObj(t).message)!==null&&u!==void 0?u:l}:{message:l}}}:{}))}strip(){return new n(m(c({},this._def),{unknownKeys:"strip"}))}passthrough(){return new n(m(c({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new n(m(c({},this._def),{shape:()=>c(c({},this._def.shape()),t)}))}merge(t){return new n({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>c(c({},this._def.shape()),t._def.shape()),typeName:b.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new n(m(c({},this._def),{catchall:t}))}pick(t){let r={};return q.objectKeys(t).forEach(a=>{t[a]&&this.shape[a]&&(r[a]=this.shape[a])}),new n(m(c({},this._def),{shape:()=>r}))}omit(t){let r={};return q.objectKeys(this.shape).forEach(a=>{t[a]||(r[a]=this.shape[a])}),new n(m(c({},this._def),{shape:()=>r}))}deepPartial(){return yt(this)}partial(t){let r={};return q.objectKeys(this.shape).forEach(a=>{let i=this.shape[a];t&&!t[a]?r[a]=i:r[a]=i.optional()}),new n(m(c({},this._def),{shape:()=>r}))}required(t){let r={};return q.objectKeys(this.shape).forEach(a=>{if(t&&!t[a])r[a]=this.shape[a];else{let s=this.shape[a];for(;s instanceof We;)s=s._def.innerType;r[a]=s}}),new n(m(c({},this._def),{shape:()=>r}))}keyof(){return Li(q.objectKeys(this.shape))}}return n.create=(e,t)=>new n(c({shape:()=>e,unknownKeys:"strip",catchall:tt.create(),typeName:b.ZodObject},$(t))),n.strictCreate=(e,t)=>new n(c({shape:()=>e,unknownKeys:"strict",catchall:tt.create(),typeName:b.ZodObject},$(t))),n.lazycreate=(e,t)=>new n(c({shape:e,unknownKeys:"strip",catchall:tt.create(),typeName:b.ZodObject},$(t))),n})(),Mn=(()=>{class n extends j{_parse(t){let{ctx:r}=this._processInputParams(t),a=this._def.options;function i(s){for(let u of s)if(u.result.status==="valid")return u.result;for(let u of s)if(u.result.status==="dirty")return r.common.issues.push(...u.ctx.common.issues),u.result;let o=s.map(u=>new qe(u.ctx.common.issues));return v(r,{code:_.invalid_union,unionErrors:o}),A}if(r.common.async)return Promise.all(a.map(s=>f(this,null,function*(){let o=m(c({},r),{common:m(c({},r.common),{issues:[]}),parent:null});return{result:yield s._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}}))).then(i);{let s,o=[];for(let l of a){let d=m(c({},r),{common:m(c({},r.common),{issues:[]}),parent:null}),h=l._parseSync({data:r.data,path:r.path,parent:d});if(h.status==="valid")return h;h.status==="dirty"&&!s&&(s={result:h,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let u=o.map(l=>new qe(l));return v(r,{code:_.invalid_union,unionErrors:u}),A}}get options(){return this._def.options}}return n.create=(e,t)=>new n(c({options:e,typeName:b.ZodUnion},$(t))),n})(),Ze=n=>n instanceof Un?Ze(n.schema):n instanceof at?Ze(n.innerType()):n instanceof Fn?[n.value]:n instanceof rt?n.options:n instanceof nt?q.objectValues(n.enum):n instanceof Zn?Ze(n._def.innerType):n instanceof jn?[void 0]:n instanceof Ln?[null]:n instanceof We?[void 0,...Ze(n.unwrap())]:n instanceof Et?[null,...Ze(n.unwrap())]:n instanceof Zt||n instanceof Hn?Ze(n.unwrap()):n instanceof qn?Ze(n._def.innerType):[],vr=class n extends j{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.object)return v(t,{code:_.invalid_type,expected:E.object,received:t.parsedType}),A;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(v(t,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let i of t){let s=Ze(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,i)}}return new n(c({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a},$(r)))}};function Pn(n,e){let t=Je(n),r=Je(e);if(n===e)return{valid:!0,data:n};if(t===E.object&&r===E.object){let a=q.objectKeys(e),i=q.objectKeys(n).filter(o=>a.indexOf(o)!==-1),s=c(c({},n),e);for(let o of i){let u=Pn(n[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(t===E.array&&r===E.array){if(n.length!==e.length)return{valid:!1};let a=[];for(let i=0;i<n.length;i++){let s=n[i],o=e[i],u=Pn(s,o);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return t===E.date&&r===E.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var Dn=(()=>{class n extends j{_parse(t){let{status:r,ctx:a}=this._processInputParams(t),i=(s,o)=>{if(Rn(s)||Rn(o))return A;let u=Pn(s.value,o.value);return u.valid?((kn(s)||kn(o))&&r.dirty(),{status:r.value,value:u.data}):(v(a,{code:_.invalid_intersection_types}),A)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}return n.create=(e,t,r)=>new n(c({left:e,right:t,typeName:b.ZodIntersection},$(r))),n})(),vt=(()=>{class n extends j{_parse(t){let{status:r,ctx:a}=this._processInputParams(t);if(a.parsedType!==E.array)return v(a,{code:_.invalid_type,expected:E.array,received:a.parsedType}),A;if(a.data.length<this._def.items.length)return v(a,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&a.data.length>this._def.items.length&&(v(a,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...a.data].map((o,u)=>{let l=this._def.items[u]||this._def.rest;return l?l._parse(new be(a,o,a.path,u)):null}).filter(o=>!!o);return a.common.async?Promise.all(s).then(o=>se.mergeArray(r,o)):se.mergeArray(r,s)}get items(){return this._def.items}rest(t){return new n(m(c({},this._def),{rest:t}))}}return n.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new n(c({items:e,typeName:b.ZodTuple,rest:null},$(t)))},n})(),Er=class n extends j{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==E.object)return v(r,{code:_.invalid_type,expected:E.object,received:r.parsedType}),A;let a=[],i=this._def.keyType,s=this._def.valueType;for(let o in r.data)a.push({key:i._parse(new be(r,o,r.path,o)),value:s._parse(new be(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?se.mergeObjectAsync(t,a):se.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof j?new n(c({keyType:e,valueType:t,typeName:b.ZodRecord},$(r))):new n(c({keyType:Or.create(),valueType:e,typeName:b.ZodRecord},$(t)))}},$i=(()=>{class n extends j{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:a}=this._processInputParams(t);if(a.parsedType!==E.map)return v(a,{code:_.invalid_type,expected:E.map,received:a.parsedType}),A;let i=this._def.keyType,s=this._def.valueType,o=[...a.data.entries()].map(([u,l],d)=>({key:i._parse(new be(a,u,a.path,[d,"key"])),value:s._parse(new be(a,l,a.path,[d,"value"]))}));if(a.common.async){let u=new Map;return Promise.resolve().then(()=>f(this,null,function*(){for(let l of o){let d=yield l.key,h=yield l.value;if(d.status==="aborted"||h.status==="aborted")return A;(d.status==="dirty"||h.status==="dirty")&&r.dirty(),u.set(d.value,h.value)}return{status:r.value,value:u}}))}else{let u=new Map;for(let l of o){let d=l.key,h=l.value;if(d.status==="aborted"||h.status==="aborted")return A;(d.status==="dirty"||h.status==="dirty")&&r.dirty(),u.set(d.value,h.value)}return{status:r.value,value:u}}}}return n.create=(e,t,r)=>new n(c({valueType:t,keyType:e,typeName:b.ZodMap},$(r))),n})(),ji=(()=>{class n extends j{_parse(t){let{status:r,ctx:a}=this._processInputParams(t);if(a.parsedType!==E.set)return v(a,{code:_.invalid_type,expected:E.set,received:a.parsedType}),A;let i=this._def;i.minSize!==null&&a.data.size<i.minSize.value&&(v(a,{code:_.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&a.data.size>i.maxSize.value&&(v(a,{code:_.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let s=this._def.valueType;function o(l){let d=new Set;for(let h of l){if(h.status==="aborted")return A;h.status==="dirty"&&r.dirty(),d.add(h.value)}return{status:r.value,value:d}}let u=[...a.data.values()].map((l,d)=>s._parse(new be(a,l,a.path,d)));return a.common.async?Promise.all(u).then(l=>o(l)):o(u)}min(t,r){return new n(m(c({},this._def),{minSize:{value:t,message:I.toString(r)}}))}max(t,r){return new n(m(c({},this._def),{maxSize:{value:t,message:I.toString(r)}}))}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}return n.create=(e,t)=>new n(c({valueType:e,minSize:null,maxSize:null,typeName:b.ZodSet},$(t))),n})(),xr=class n extends j{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.function)return v(t,{code:_.invalid_type,expected:E.function,received:t.parsedType}),A;function r(o,u){return _r({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,yr(),bt].filter(l=>!!l),issueData:{code:_.invalid_arguments,argumentsError:u}})}function a(o,u){return _r({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,yr(),bt].filter(l=>!!l),issueData:{code:_.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Tr){let o=this;return de(function(...u){return f(this,null,function*(){let l=new qe([]),d=yield o._def.args.parseAsync(u,i).catch(g=>{throw l.addIssue(r(u,g)),l}),h=yield Reflect.apply(s,this,d);return yield o._def.returns._def.type.parseAsync(h,i).catch(g=>{throw l.addIssue(a(h,g)),l})})})}else{let o=this;return de(function(...u){let l=o._def.args.safeParse(u,i);if(!l.success)throw new qe([r(u,l.error)]);let d=Reflect.apply(s,this,l.data),h=o._def.returns.safeParse(d,i);if(!h.success)throw new qe([a(d,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n(m(c({},this._def),{args:vt.create(e).rest(Mt.create())}))}returns(e){return new n(m(c({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new n(c({args:e||vt.create([]).rest(Mt.create()),returns:t||Mt.create(),typeName:b.ZodFunction},$(r)))}},Un=(()=>{class n extends j{get schema(){return this._def.getter()}_parse(t){let{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}return n.create=(e,t)=>new n(c({getter:e,typeName:b.ZodLazy},$(t))),n})(),Fn=(()=>{class n extends j{_parse(t){if(t.data!==this._def.value){let r=this._getOrReturnCtx(t);return v(r,{received:r.data,code:_.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:t.data}}get value(){return this._def.value}}return n.create=(e,t)=>new n(c({value:e,typeName:b.ZodLiteral},$(t))),n})();function Li(n,e){return new rt(c({values:n,typeName:b.ZodEnum},$(e)))}var rt=class n extends j{constructor(){super(...arguments),jt.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{expected:q.joinValues(r),received:t.parsedType,code:_.invalid_type}),A}if(br(this,jt,"f")||Ri(this,jt,new Set(this._def.values),"f"),!br(this,jt,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{received:t.data,code:_.invalid_enum_value,options:r}),A}return de(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return n.create(e,c(c({},this._def),t))}exclude(e,t=this._def){return n.create(this.options.filter(r=>!e.includes(r)),c(c({},this._def),t))}};jt=new WeakMap;rt.create=Li;var nt=class extends j{constructor(){super(...arguments),Lt.set(this,void 0)}_parse(e){let t=q.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==E.string&&r.parsedType!==E.number){let a=q.objectValues(t);return v(r,{expected:q.joinValues(a),received:r.parsedType,code:_.invalid_type}),A}if(br(this,Lt,"f")||Ri(this,Lt,new Set(q.getValidEnumValues(this._def.values)),"f"),!br(this,Lt,"f").has(e.data)){let a=q.objectValues(t);return v(r,{received:r.data,code:_.invalid_enum_value,options:a}),A}return de(e.data)}get enum(){return this._def.values}};Lt=new WeakMap;nt.create=(n,e)=>new nt(c({values:n,typeName:b.ZodNativeEnum},$(e)));var Tr=(()=>{class n extends j{unwrap(){return this._def.type}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==E.promise&&r.common.async===!1)return v(r,{code:_.invalid_type,expected:E.promise,received:r.parsedType}),A;let a=r.parsedType===E.promise?r.data:Promise.resolve(r.data);return de(a.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}}return n.create=(e,t)=>new n(c({type:e,typeName:b.ZodPromise},$(t))),n})(),at=(()=>{class n extends j{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:r,ctx:a}=this._processInputParams(t),i=this._def.effect||null,s={addIssue:o=>{v(a,o),o.fatal?r.abort():r.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){let o=i.transform(a.data,s);if(a.common.async)return Promise.resolve(o).then(u=>f(this,null,function*(){if(r.value==="aborted")return A;let l=yield this._def.schema._parseAsync({data:u,path:a.path,parent:a});return l.status==="aborted"?A:l.status==="dirty"||r.value==="dirty"?_t(l.value):l}));{if(r.value==="aborted")return A;let u=this._def.schema._parseSync({data:o,path:a.path,parent:a});return u.status==="aborted"?A:u.status==="dirty"||r.value==="dirty"?_t(u.value):u}}if(i.type==="refinement"){let o=u=>{let l=i.refinement(u,s);if(a.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(a.common.async===!1){let u=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return u.status==="aborted"?A:(u.status==="dirty"&&r.dirty(),o(u.value),{status:r.value,value:u.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(u=>u.status==="aborted"?A:(u.status==="dirty"&&r.dirty(),o(u.value).then(()=>({status:r.value,value:u.value}))))}if(i.type==="transform")if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Dt(o))return o;let u=i.transform(o.value,s);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:u}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>Dt(o)?Promise.resolve(i.transform(o.value,s)).then(u=>({status:r.value,value:u})):o);q.assertNever(i)}}return n.create=(e,t,r)=>new n(c({schema:e,typeName:b.ZodEffects,effect:t},$(r))),n.createWithPreprocess=(e,t,r)=>new n(c({schema:t,effect:{type:"preprocess",transform:e},typeName:b.ZodEffects},$(r))),n})(),We=(()=>{class n extends j{_parse(t){return this._getType(t)===E.undefined?de(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return n.create=(e,t)=>new n(c({innerType:e,typeName:b.ZodOptional},$(t))),n})(),Et=(()=>{class n extends j{_parse(t){return this._getType(t)===E.null?de(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return n.create=(e,t)=>new n(c({innerType:e,typeName:b.ZodNullable},$(t))),n})(),Zn=(()=>{class n extends j{_parse(t){let{ctx:r}=this._processInputParams(t),a=r.data;return r.parsedType===E.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}return n.create=(e,t)=>new n(c({innerType:e,typeName:b.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},$(t))),n})(),qn=(()=>{class n extends j{_parse(t){let{ctx:r}=this._processInputParams(t),a=m(c({},r),{common:m(c({},r.common),{issues:[]})}),i=this._def.innerType._parse({data:a.data,path:a.path,parent:c({},a)});return Ut(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new qe(a.common.issues)},input:a.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new qe(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}return n.create=(e,t)=>new n(c({innerType:e,typeName:b.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},$(t))),n})(),Mi=(()=>{class n extends j{_parse(t){if(this._getType(t)!==E.nan){let a=this._getOrReturnCtx(t);return v(a,{code:_.invalid_type,expected:E.nan,received:a.parsedType}),A}return{status:"valid",value:t.data}}}return n.create=e=>new n(c({typeName:b.ZodNaN},$(e))),n})(),zl=Symbol("zod_brand"),Zt=class extends j{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},qt=class n extends j{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return f(this,null,function*(){let i=yield this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?A:i.status==="dirty"?(t.dirty(),_t(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})});{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?A:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,t){return new n({in:e,out:t,typeName:b.ZodPipeline})}},Hn=(()=>{class n extends j{_parse(t){let r=this._def.innerType._parse(t),a=i=>(Dt(i)&&(i.value=Object.freeze(i.value)),i);return Ut(r)?r.then(i=>a(i)):a(r)}unwrap(){return this._def.innerType}}return n.create=(e,t)=>new n(c({innerType:e,typeName:b.ZodReadonly},$(t))),n})();function Di(n,e={},t){return n?wr.create().superRefine((r,a)=>{var i,s;if(!n(r)){let o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(s=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&s!==void 0?s:!0,l=typeof o=="string"?{message:o}:o;a.addIssue(m(c({code:"custom"},l),{fatal:u}))}}):wr.create()}var Jl={object:wt.lazycreate},b=function(n){return n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly",n}(b||{}),Wl=(n,e={message:`Input not instance of ${n.name}`})=>Di(t=>t instanceof n,e),Ui=Or.create,Fi=An.create,Kl=Mi.create,Xl=Cn.create,Zi=Nn.create,Yl=$n.create,Ql=Ci.create,ec=jn.create,tc=Ln.create,rc=wr.create,nc=Mt.create,ac=tt.create,ic=Ni.create,sc=Ft.create,oc=wt.create,uc=wt.strictCreate,lc=Mn.create,cc=vr.create,dc=Dn.create,fc=vt.create,hc=Er.create,pc=$i.create,mc=ji.create,gc=xr.create,yc=Un.create,_c=Fn.create,bc=rt.create,wc=nt.create,vc=Tr.create,Ti=at.create,Ec=We.create,xc=Et.create,Oc=at.createWithPreprocess,Tc=qt.create,Sc=()=>Ui().optional(),Ic=()=>Fi().optional(),Rc=()=>Zi().optional(),kc={string:n=>Or.create(m(c({},n),{coerce:!0})),number:n=>An.create(m(c({},n),{coerce:!0})),boolean:n=>Nn.create(m(c({},n),{coerce:!0})),bigint:n=>Cn.create(m(c({},n),{coerce:!0})),date:n=>$n.create(m(c({},n),{coerce:!0}))},Pc=A,xt=Object.freeze({__proto__:null,defaultErrorMap:bt,setErrorMap:Pl,getErrorMap:yr,makeIssue:_r,EMPTY_PATH:Al,addIssueToContext:v,ParseStatus:se,INVALID:A,DIRTY:_t,OK:de,isAborted:Rn,isDirty:kn,isValid:Dt,isAsync:Ut,get util(){return q},get objectUtil(){return Si},ZodParsedType:E,getParsedType:Je,ZodType:j,datetimeRegex:Ai,ZodString:Or,ZodNumber:An,ZodBigInt:Cn,ZodBoolean:Nn,ZodDate:$n,ZodSymbol:Ci,ZodUndefined:jn,ZodNull:Ln,ZodAny:wr,ZodUnknown:Mt,ZodNever:tt,ZodVoid:Ni,ZodArray:Ft,ZodObject:wt,ZodUnion:Mn,ZodDiscriminatedUnion:vr,ZodIntersection:Dn,ZodTuple:vt,ZodRecord:Er,ZodMap:$i,ZodSet:ji,ZodFunction:xr,ZodLazy:Un,ZodLiteral:Fn,ZodEnum:rt,ZodNativeEnum:nt,ZodPromise:Tr,ZodEffects:at,ZodTransformer:at,ZodOptional:We,ZodNullable:Et,ZodDefault:Zn,ZodCatch:qn,ZodNaN:Mi,BRAND:zl,ZodBranded:Zt,ZodPipeline:qt,ZodReadonly:Hn,custom:Di,Schema:j,ZodSchema:j,late:Jl,get ZodFirstPartyTypeKind(){return b},coerce:kc,any:rc,array:sc,bigint:Xl,boolean:Zi,date:Yl,discriminatedUnion:cc,effect:Ti,enum:bc,function:gc,instanceof:Wl,intersection:dc,lazy:yc,literal:_c,map:pc,nan:Kl,nativeEnum:wc,never:ac,null:tc,nullable:xc,number:Fi,object:oc,oboolean:Rc,onumber:Ic,optional:Ec,ostring:Sc,pipeline:Tc,preprocess:Oc,promise:vc,record:hc,set:mc,strictObject:uc,string:Ui,symbol:Ql,transformer:Ti,tuple:fc,undefined:ec,union:lc,unknown:nc,void:ic,NEVER:Pc,ZodIssueCode:_,quotelessJson:kl,ZodError:qe});var Ya=$e(Rr(),1);var Wi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Lc(n){return typeof n=="string"&&Wi.test(n)}var st=Lc;var re=[];for(kr=0;kr<256;++kr)re.push((kr+256).toString(16).slice(1));var kr;function Ki(n,e=0){return(re[n[e+0]]+re[n[e+1]]+re[n[e+2]]+re[n[e+3]]+"-"+re[n[e+4]]+re[n[e+5]]+"-"+re[n[e+6]]+re[n[e+7]]+"-"+re[n[e+8]]+re[n[e+9]]+"-"+re[n[e+10]]+re[n[e+11]]+re[n[e+12]]+re[n[e+13]]+re[n[e+14]]+re[n[e+15]]).toLowerCase()}var Pr,Mc=new Uint8Array(16);function Bn(){if(!Pr&&(Pr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pr(Mc)}var Dc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vn={randomUUID:Dc};function Uc(n,e,t){if(Vn.randomUUID&&!e&&!n)return Vn.randomUUID();n=n||{};var r=n.random||(n.rng||Bn)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var a=0;a<16;++a)e[t+a]=r[a];return e}return Ki(r)}var Y=Uc;var zn=class{getStore(){}run(e,t){return t()}},Gn=Symbol.for("ls:tracing_async_local_storage"),Fc=new zn,Jn=class{getInstance(){return globalThis[Gn]??Fc}initializeGlobalInstance(e){globalThis[Gn]===void 0&&(globalThis[Gn]=e)}},Zc=new Jn,Xi=()=>{let n=Zc.getInstance().getStore();if(n===void 0)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n};var Ag=Symbol.for("langsmith:traceable:root");function Cr(n){return typeof n=="function"&&"langsmith:traceable"in n}var Wn={};bl(Wn,{JsonPatchError:()=>K,_areEquals:()=>Bt,applyOperation:()=>ut,applyPatch:()=>lt,applyReducer:()=>Vc,deepClone:()=>Hc,getValueByPointer:()=>Lr,validate:()=>ts,validator:()=>Mr});var qc=Object.prototype.hasOwnProperty;function Qi(n,e){return qc.call(n,e)}function es(n){if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)Qi(n,t)&&e.push(t);return e}function ve(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function $r(n){let e=0,t=n.length,r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function jr(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function Ht(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Nr(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Nr(n[t]))return!0}else if(typeof n=="object"){let t=es(n),r=t.length;for(var e=0;e<r;e++)if(Nr(n[t[e]]))return!0}}return!1}function Yi(n,e){let t=[n];for(let r in e){let a=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof a<"u"&&t.push(`${r}: ${a}`)}return t.join(`
`)}var ot=class extends Error{constructor(e,t,r,a,i){super(Yi(e,{name:t,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=Yi(e,{name:t,index:r,operation:a,tree:i})}};var K=ot,Hc=ve,Ot={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Lr(t,this.path);r&&(r=ve(r));let a=ut(t,{op:"remove",path:this.from}).removed;return ut(t,{op:"add",path:this.path,value:a}),{newDocument:t,removed:r}},copy:function(n,e,t){let r=Lr(t,this.from);return ut(t,{op:"add",path:this.path,value:ve(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Bt(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},Bc={add:function(n,e,t){return $r(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Ot.move,copy:Ot.copy,test:Ot.test,_get:Ot._get};function Lr(n,e){if(e=="")return n;var t={op:"_get",path:e};return ut(n,t),t.value}function ut(n,e,t=!1,r=!0,a=!0,i=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Mr(e,0)),e.path===""){let s={newDocument:n};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=n,s;if(e.op==="move"||e.op==="copy")return s.newDocument=Lr(n,e.from),e.op==="move"&&(s.removed=n),s;if(e.op==="test"){if(s.test=Bt(n,e.value),s.test===!1)throw new K("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return s.newDocument=n,s}else{if(e.op==="remove")return s.removed=n,s.newDocument=null,s;if(e.op==="_get")return e.value=n,s;if(t)throw new K("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,n);return s}}else{r||(n=ve(n));let o=(e.path||"").split("/"),u=n,l=1,d=o.length,h,p,g;for(typeof t=="function"?g=t:g=Mr;;){if(p=o[l],p&&p.indexOf("~")!=-1&&(p=Ht(p)),a&&(p=="__proto__"||p=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&h===void 0&&(u[p]===void 0?h=o.slice(0,l).join("/"):l==d-1&&(h=e.path),h!==void 0&&g(e,0,n,h)),l++,Array.isArray(u)){if(p==="-")p=u.length;else{if(t&&!$r(p))throw new K("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,n);$r(p)&&(p=~~p)}if(l>=d){if(t&&e.op==="add"&&p>u.length)throw new K("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,n);let U=Bc[e.op].call(e,u,p,n);if(U.test===!1)throw new K("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return U}}else if(l>=d){let U=Ot[e.op].call(e,u,p,n);if(U.test===!1)throw new K("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return U}if(u=u[p],t&&l<d&&(!u||typeof u!="object"))throw new K("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,n)}}}function lt(n,e,t,r=!0,a=!0){if(t&&!Array.isArray(e))throw new K("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=ve(n));let i=new Array(e.length);for(let s=0,o=e.length;s<o;s++)i[s]=ut(n,e[s],t,!0,a,s),n=i[s].newDocument;return i.newDocument=n,i}function Vc(n,e,t){let r=ut(n,e);if(r.test===!1)throw new K("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function Mr(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new K("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Ot[n.op]){if(typeof n.path!="string")throw new K("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new K('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new K("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new K("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Nr(n.value))throw new K("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var a=n.path.split("/").length,i=r.split("/").length;if(a!==i+1&&a!==i)throw new K("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new K("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var s={op:"_get",path:n.from,value:void 0},o=ts([s],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new K("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new K("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function ts(n,e,t){try{if(!Array.isArray(n))throw new K("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)lt(ve(e),ve(n),t||!0);else{t=t||Mr;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(a){if(a instanceof K)return a;throw a}}function Bt(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),a,i,s;if(t&&r){if(i=n.length,i!=e.length)return!1;for(a=i;a--!==0;)if(!Bt(n[a],e[a]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(i=o.length,i!==Object.keys(e).length)return!1;for(a=i;a--!==0;)if(!e.hasOwnProperty(o[a]))return!1;for(a=i;a--!==0;)if(s=o[a],!Bt(n[s],e[s]))return!1;return!0}return n!==n&&e!==e}var Zg=m(c({},Wn),{JsonPatchError:ot,deepClone:ve,escapePathComponent:jr,unescapePathComponent:Ht});var Gc=()=>typeof window<"u"&&typeof window.document<"u",zc=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Jc=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),rs=()=>typeof Deno<"u",Wc=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!rs(),Kc=()=>{let n;return Gc()?n="browser":Wc()?n="node":zc()?n="webworker":Jc()?n="jsdom":rs()?n="deno":n="other",n},Kn;function ns(){return f(this,null,function*(){return Kn===void 0&&(Kn={library:"langchain-js",runtime:Kc()}),Kn})}function ke(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}var Xn=class{},ct=class n extends Xn{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Tn(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ke("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Re.prototype.toJSON.call(this)}toJSONNotImplemented(){return Re.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends n{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.assign(this,e)}}return new t}};function Yn(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function Xc(n){return n.replace(/[-:.]/g,"")}function Yc(n,e,t){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return Xc(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Tt(n){return typeof n._addRunToRunMap=="function"}var Ee=class extends ct{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=Yc(e.start_time,e.id,e.execution_order),r=c({},e);if(r.parent_run_id!==void 0){let a=this.runMap.get(r.parent_run_id);a&&(this._addChildRun(a,r),a.child_execution_order=Math.max(a.child_execution_order,r.child_execution_order),r.trace_id=a.trace_id,a.dotted_order!==void 0&&(r.dotted_order=[a.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}_endTrace(e){return f(this,null,function*(){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):yield this.persistRun(e),this.runMap.delete(e.id),yield this.onRunUpdate?.(e)})}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,a,i,s,o,u){let l=this._getExecutionOrder(a),d=Date.now(),h=o?m(c({},i),{metadata:o}):i,p={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:s||[]};return this._addRunToRunMap(p)}handleLLMStart(e,t,r,a,i,s,o,u){return f(this,null,function*(){let l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,a,i,s,o,u);return yield this.onRunCreate?.(l),yield this.onLLMStart?.(l),l})}_createRunForChatModelStart(e,t,r,a,i,s,o,u){let l=this._getExecutionOrder(a),d=Date.now(),h=o?m(c({},i),{metadata:o}):i,p={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:s||[]};return this._addRunToRunMap(p)}handleChatModelStart(e,t,r,a,i,s,o,u){return f(this,null,function*(){let l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,a,i,s,o,u);return yield this.onRunCreate?.(l),yield this.onLLMStart?.(l),l})}handleLLMEnd(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),yield this.onLLMEnd?.(r),yield this._endTrace(r),r})}handleLLMError(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),yield this.onLLMError?.(r),yield this._endTrace(r),r})}_createRunForChainStart(e,t,r,a,i,s,o,u){let l=this._getExecutionOrder(a),d=Date.now(),h={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(h)}handleChainStart(e,t,r,a,i,s,o,u){return f(this,null,function*(){let l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,a,i,s,o,u);return yield this.onRunCreate?.(l),yield this.onChainStart?.(l),l})}handleChainEnd(e,t,r,a,i){return f(this,null,function*(){let s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=Yn(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),i?.inputs!==void 0&&(s.inputs=Yn(i.inputs,"input")),yield this.onChainEnd?.(s),yield this._endTrace(s),s})}handleChainError(e,t,r,a,i){return f(this,null,function*(){let s=this.runMap.get(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),i?.inputs!==void 0&&(s.inputs=Yn(i.inputs,"input")),yield this.onChainError?.(s),yield this._endTrace(s),s})}_createRunForToolStart(e,t,r,a,i,s,o){let u=this._getExecutionOrder(a),l=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(d)}handleToolStart(e,t,r,a,i,s,o){return f(this,null,function*(){let u=this.runMap.get(r)??this._createRunForToolStart(e,t,r,a,i,s,o);return yield this.onRunCreate?.(u),yield this.onToolStart?.(u),u})}handleToolEnd(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),yield this.onToolEnd?.(r),yield this._endTrace(r),r})}handleToolError(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),yield this.onToolError?.(r),yield this._endTrace(r),r})}handleAgentAction(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentAction?.(r)})}handleAgentEnd(e,t){return f(this,null,function*(){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentEnd?.(r))})}_createRunForRetrieverStart(e,t,r,a,i,s,o){let u=this._getExecutionOrder(a),l=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(d)}handleRetrieverStart(e,t,r,a,i,s,o){return f(this,null,function*(){let u=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,a,i,s,o);return yield this.onRunCreate?.(u),yield this.onRetrieverStart?.(u),u})}handleRetrieverEnd(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),yield this.onRetrieverEnd?.(r),yield this._endTrace(r),r})}handleRetrieverError(e,t){return f(this,null,function*(){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),yield this.onRetrieverError?.(r),yield this._endTrace(r),r})}handleText(e,t){return f(this,null,function*(){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),yield this.onText?.(r))})}handleLLMNewToken(e,t,r,a,i,s){return f(this,null,function*(){let o=this.runMap.get(r);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s?.chunk}}),yield this.onLLMNewToken?.(o,e,{chunk:s?.chunk}),o})}};var hs=$e(Rr(),1),Hr=$e(qr(),1);var od=(...n)=>fetch(...n),ud=Symbol.for("ls:fetch_implementation");var k=()=>globalThis[ud]??od;var ld=[400,401,403,404,405,406,407,408],cd=[409],Gt=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Hr.default?this.queue=new Hr.default.default({concurrency:this.maxConcurrency}):this.queue=new Hr.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,hs.default)(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{onFailedAttempt(i){return f(this,null,function*(){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||i?.code==="ECONNABORTED")throw i;let s=i?.response,o=s?.status;if(o){if(ld.includes(+o))throw i;if(cd.includes(+o))return;r&&(yield r(s))}})},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{e.signal?.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>k()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function ia(n){return typeof n?._getType=="function"}function sa(n){let e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs=c({},n.additional_kwargs)),e}var He,dd=()=>typeof window<"u"&&typeof window.document<"u",fd=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",hd=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),ps=()=>typeof Deno<"u",pd=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!ps(),md=()=>He||(dd()?He="browser":pd()?He="node":fd()?He="webworker":hd()?He="jsdom":ps()?He="deno":He="other",He),oa;function Br(){return f(this,null,function*(){if(oa===void 0){let n=md(),e=yd();oa=c({library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:Vr},e)}return oa})}function ms(){let n=gd()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[r,a]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof a=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[r]=a);return e}function gd(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Ke(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}function Be(n){return Ke(`LANGSMITH_${n}`)||Ke(`LANGCHAIN_${n}`)}var ua;function yd(){if(ua!==void 0)return ua;let n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of n){let r=Ke(t);r!==void 0&&(e[t]=r)}return ua=e,e}function B(n){if(!st(n))throw new Error(`Invalid UUID: ${n}`)}var gs={};function Gr(n){gs[n]||(console.warn(n),gs[n]=!0)}var Ia=$e(uu(),1);function lu(n,e){let t=(0,Ia.parse)(n),r=(0,Ia.parse)(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function Ge(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);let[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){let[a,i]=e.split("/",2);if(!a||!i)throw new Error(`Invalid identifier format: ${n}`);return[a,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}var Ra=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}};function H(n,e,t){return f(this,null,function*(){let r;if(n.ok){t&&(r=yield n.text());return}r=yield n.text();let a=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new Ra(a):new Error(a)})}var hp="[Circular]",Rt=n=>{let e=new WeakSet;return JSON.stringify(n,(r,a)=>{if(typeof a=="object"&&a!==null){if(e.has(a))return{result:hp};e.add(a)}return a})};function cu(n){return f(this,null,function*(){let e=yield Br(),t=ms();return n.map(r=>{let a=r.extra??{},i=a.metadata;return r.extra=m(c({},a),{runtime:c(c({},e),a?.runtime),metadata:c(c(c({},t),t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{}),i)}),r})})}var pp=()=>{let n=Be("TRACING_SAMPLING_RATE");if(n===void 0)return;let e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},mp=n=>{let t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};function gp(n){return f(this,null,function*(){let e=[];try{for(var t=D(n),r,a,i;r=!(a=yield t.next()).done;r=!1){let s=a.value;e.push(s)}}catch{i=[a]}finally{try{r&&(a=t.return)&&(yield a.call(t))}finally{if(i)throw i[0]}}return e})}function ka(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var yp=n=>f(void 0,null,function*(){if(n?.status===429){let e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return yield new Promise(t=>setTimeout(t,e)),!0}return!1}),Pa=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");let t=[];for(;t.length<e&&this.items.length;){let r=this.items.shift();if(r)t.push(r);else break}return[t.map(r=>r[0]),()=>t.forEach(r=>r[1]())]}},_p=20971520,ft=class n{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Pa}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultClientConfig();this.tracingSampleRate=pp(),this.apiUrl=ka(e.apiUrl??t.apiUrl)??"",this.apiKey=ka(e.apiKey??t.apiKey),this.webUrl=ka(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Gt(e.callerOptions??{}),this.batchIngestCaller=new Gt(m(c({},e.callerOptions??{}),{onFailedResponseHook:yp})),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=Be("API_KEY"),t=Be("ENDPOINT")??"https://api.smith.langchain.com",r=Be("HIDE_INPUTS")==="true",a=Be("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:mp(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${Vr}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t=c({},e);return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}_getResponse(e,t){return f(this,null,function*(){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,i=yield this.caller.call(k(),a,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(i,`Failed to fetch ${e}`),i})}_get(e,t){return f(this,null,function*(){return(yield this._getResponse(e,t)).json()})}_getPaginated(a){return C(this,arguments,function*(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0,s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(s));let o=`${this.apiUrl}${e}?${t}`,u=yield new y(this.caller.call(k(),o,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)));yield new y(H(u,`Failed to fetch ${e}`));let l=r?r(yield new y(u.json())):yield new y(u.json());if(l.length===0||(yield l,l.length<s))break;i+=l.length}})}_getCursorPaginatedList(e,t=null,r="POST",a="runs"){return C(this,null,function*(){let i=t?c({},t):{};for(;;){let s=yield new y(this.caller.call(k(),`${this.apiUrl}${e}`,m(c({method:r,headers:m(c({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:JSON.stringify(i)}))),o=yield new y(s.json());if(!o||!o[a])break;yield o[a];let u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}})}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let r=[];for(let a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):r.push(a);return r}else{let r=[];for(let a of e)a.id!==a.trace_id&&!this.filteredPostUuids.has(a.trace_id)||Math.random()<this.tracingSampleRate?r.push(a):this.filteredPostUuids.add(a.id);return r}}drainAutoBatchQueue(){return f(this,null,function*(){for(;this.autoBatchQueue.size>=0;){let[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{yield this.batchIngestRuns({runCreates:e.filter(r=>r.action==="create").map(r=>r.item),runUpdates:e.filter(r=>r.action==="update").map(r=>r.item)})}finally{t()}}})}processRunOperation(e,t){return f(this,null,function*(){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;let a=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&(yield this.drainAutoBatchQueue()),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),a})}_getServerInfo(){return f(this,null,function*(){let e=yield k()(`${this.apiUrl}/info`,c({method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(e,"get server info"),e.json()})}batchEndpointIsSupported(){return f(this,null,function*(){try{this.serverInfo=yield this._getServerInfo()}catch{return!1}return!0})}_getSettings(){return f(this,null,function*(){return this.settings||(this.settings=this._get("/settings")),yield this.settings})}createRun(e){return f(this,null,function*(){if(!this._filterForSampling([e]).length)return;let t=m(c({},this.headers),{"Content-Type":"application/json"}),r=e.project_name;delete e.project_name;let a=this.prepareRunCreateOrUpdateInputs(m(c({session_name:r},e),{start_time:e.start_time??Date.now()}));if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}let i=yield cu([a]),s=yield this.caller.call(k(),`${this.apiUrl}/runs`,c({method:"POST",headers:t,body:Rt(i[0]),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(s,"create run",!0)})}batchIngestRuns(r){return f(this,arguments,function*({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let a=e?.map(d=>this.prepareRunCreateOrUpdateInputs(d))??[],i=t?.map(d=>this.prepareRunCreateOrUpdateInputs(d))??[];if(a.length>0&&i.length>0){let d=a.reduce((p,g)=>(g.id&&(p[g.id]=g),p),{}),h=[];for(let p of i)p.id!==void 0&&d[p.id]?d[p.id]=c(c({},d[p.id]),p):h.push(p);a=Object.values(d),i=h}let s={post:this._filterForSampling(a),patch:this._filterForSampling(i,!0)};if(!s.post.length&&!s.patch.length)return;if(a=yield cu(a),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=yield this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(let d of s.post)yield this.createRun(d);for(let d of s.patch)d.id!==void 0&&(yield this.updateRun(d.id,d));return}let o=this.serverInfo?.batch_ingest_config?.size_limit_bytes??_p,u={post:[],patch:[]},l=0;for(let d of["post","patch"]){let h=d,p=s[h].reverse(),g=p.pop();for(;g!==void 0;){let U=Rt(g);l>0&&l+U.length>o&&(yield this._postBatchIngestRuns(Rt(u)),l=0,u.post=[],u.patch=[]),l+=U.length,u[h].push(g),g=p.pop()}}(u.post.length>0||u.patch.length>0)&&(yield this._postBatchIngestRuns(Rt(u)))})}_postBatchIngestRuns(e){return f(this,null,function*(){let t=m(c({},this.headers),{"Content-Type":"application/json",Accept:"application/json"}),r=yield this.batchIngestCaller.call(k(),`${this.apiUrl}/runs/batch`,c({method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(r,"batch create run",!0)})}updateRun(e,t){return f(this,null,function*(){B(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r=m(c({},t),{id:e});if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0){yield this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let a=m(c({},this.headers),{"Content-Type":"application/json"}),i=yield this.caller.call(k(),`${this.apiUrl}/runs/${e}`,c({method:"PATCH",headers:a,body:Rt(t),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(i,"update run",!0)})}readRun(r){return f(this,arguments,function*(e,{loadChildRuns:t}={loadChildRuns:!1}){B(e);let a=yield this._get(`/runs/${e}`);return t&&a.child_run_ids&&(a=yield this._loadChildRuns(a)),a})}getRunUrl(a){return f(this,arguments,function*({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r?.projectName?i=(yield this.readProject({projectName:r?.projectName})).id:r?.projectId?i=r?.projectId:i=(yield this.readProject({projectName:Be("PROJECT")||"default"})).id;let s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){let i=yield this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")})}_loadChildRuns(e){return f(this,null,function*(){let t=yield gp(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort((i,s)=>(i?.dotted_order??"").localeCompare(s?.dotted_order??""));for(let i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),a[i.id]=i}e.child_runs=r[e.id]||[];for(let i in r)i!==e.id&&(a[i].child_runs=r[i]);return e})}listRuns(e){return C(this,null,function*(){let{projectId:t,projectName:r,parentRunId:a,traceId:i,referenceExampleId:s,startTime:o,executionOrder:u,isRoot:l,runType:d,error:h,id:p,query:g,filter:U,traceFilter:L,treeFilter:T,limit:w,select:P}=e,M=[];if(t&&(M=Array.isArray(t)?t:[t]),r){let Ye=Array.isArray(r)?r:[r],En=yield new y(Promise.all(Ye.map(yl=>this.readProject({projectName:yl}).then(_l=>_l.id))));M.push(...En)}let F=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],V={session:M.length?M:null,run_type:d,reference_example:s,query:g,filter:U,trace_filter:L,tree_filter:T,execution_order:u,parent_run:a,start_time:o?o.toISOString():null,error:h,id:p,limit:w,trace:i,select:P||F,is_root:l},J=0;try{for(var Q=D(this._getCursorPaginatedList("/runs/query",V)),W,ae,ui;W=!(ae=yield new y(Q.next())).done;W=!1){let Ye=ae.value;if(w){if(J>=w)break;if(Ye.length+J>w){let En=Ye.slice(0,w-J);yield*ie(En);break}J+=Ye.length,yield*ie(Ye)}else yield*ie(Ye)}}catch{ui=[ae]}finally{try{W&&(ae=Q.return)&&(yield new y(ae.call(Q)))}finally{if(ui)throw ui[0]}}})}getRunStats(w){return f(this,arguments,function*({id:e,trace:t,parentRun:r,runType:a,projectNames:i,projectIds:s,referenceExampleIds:o,startTime:u,endTime:l,error:d,query:h,filter:p,traceFilter:g,treeFilter:U,isRoot:L,dataSourceType:T}){let P=s||[];i&&(P=[...s||[],...yield Promise.all(i.map(Q=>this.readProject({projectName:Q}).then(W=>W.id)))]);let F=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:a,session:P,reference_example:o,start_time:u,end_time:l,error:d,query:h,filter:p,trace_filter:g,tree_filter:U,is_root:L,data_source_type:T}).filter(([Q,W])=>W!==void 0));return yield(yield this.caller.call(k(),`${this.apiUrl}/runs/stats`,c({method:"POST",headers:this.headers,body:JSON.stringify(F),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}shareRun(r){return f(this,arguments,function*(e,{shareId:t}={}){let a={run_id:e,share_token:t||Y()};B(e);let s=yield(yield this.caller.call(k(),`${this.apiUrl}/runs/${e}/share`,c({method:"PUT",headers:this.headers,body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(s===null||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`})}unshareRun(e){return f(this,null,function*(){B(e);let t=yield this.caller.call(k(),`${this.apiUrl}/runs/${e}/share`,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(t,"unshare run",!0)})}readRunSharedLink(e){return f(this,null,function*(){B(e);let r=yield(yield this.caller.call(k(),`${this.apiUrl}/runs/${e}/share`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`})}listSharedRuns(r){return f(this,arguments,function*(e,{runIds:t}={}){let a=new URLSearchParams({share_token:e});if(t!==void 0)for(let o of t)a.append("id",o);return B(e),yield(yield this.caller.call(k(),`${this.apiUrl}/public/${e}/runs${a}`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}readDatasetSharedSchema(e,t){return f(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id),B(e);let a=yield(yield this.caller.call(k(),`${this.apiUrl}/datasets/${e}/share`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a})}shareDataset(e,t){return f(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id);let r={dataset_id:e};B(e);let i=yield(yield this.caller.call(k(),`${this.apiUrl}/datasets/${e}/share`,c({method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i})}unshareDataset(e){return f(this,null,function*(){B(e);let t=yield this.caller.call(k(),`${this.apiUrl}/datasets/${e}/share`,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(t,"unshare dataset",!0)})}readSharedDataset(e){return f(this,null,function*(){return B(e),yield(yield this.caller.call(k(),`${this.apiUrl}/public/${e}/datasets`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listSharedExamples(e,t){return f(this,null,function*(){let r={};t?.exampleIds&&(r.id=t.exampleIds);let a=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>a.append(o,l)):a.append(o,u)});let i=yield this.caller.call(k(),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),s=yield i.json();if(!i.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${s.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return s.map(o=>m(c({},o),{_hostUrl:this.getHostUrl()}))})}createProject(o){return f(this,arguments,function*({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:i=null,referenceDatasetId:s=null}){let u=a?"?upsert=true":"",l=`${this.apiUrl}/sessions${u}`,d=i||{};r&&(d.metadata=r);let h={name:e,extra:d,description:t};s!==null&&(h.reference_dataset_id=s);let p=yield this.caller.call(k(),l,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(p,"create project"),yield p.json()})}updateProject(o,u){return f(this,arguments,function*(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:i=null,endTime:s=null}){let l=`${this.apiUrl}/sessions/${e}`,d=i;a&&(d=m(c({},d||{}),{metadata:a}));let h={name:t,extra:d,description:r,end_time:s?new Date(s).toISOString():null},p=yield this.caller.call(k(),l,c({method:"PATCH",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(p,"update project"),yield p.json()})}hasProject(r){return f(this,arguments,function*({projectId:e,projectName:t}){let a="/sessions",i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)B(e),a+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");let s=yield this.caller.call(k(),`${this.apiUrl}${a}?${i}`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));try{let o=yield s.json();return s.ok?Array.isArray(o)?o.length>0:!0:!1}catch{return!1}})}readProject(a){return f(this,arguments,function*({projectId:e,projectName:t,includeStats:r}){let i="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)B(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&s.append("include_stats",r.toString());let o=yield this._get(i,s),u;if(Array.isArray(o)){if(o.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);u=o[0]}else u=o;return u})}getProjectUrl(r){return f(this,arguments,function*({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let a=yield this.readProject({projectId:e,projectName:t}),i=yield this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${a.id}`})}getDatasetUrl(r){return f(this,arguments,function*({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let a=yield this.readDataset({datasetId:e,datasetName:t}),i=yield this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${a.id}`})}_getTenantId(){return f(this,null,function*(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});try{for(var t=D(this._getPaginated("/sessions",e)),r,a,i;r=!(a=yield t.next()).done;r=!1){let s=a.value;return this._tenantId=s[0].tenant_id,s[0].tenant_id}}catch{i=[a]}finally{try{r&&(a=t.return)&&(yield a.call(t))}finally{if(i)throw i[0]}}throw new Error("No projects found to resolve tenant.")})}listProjects(){return C(this,arguments,function*({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:s,metadata:o}={}){let u=new URLSearchParams;if(e!==void 0)for(let g of e)u.append("id",g);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),a!==void 0)u.append("reference_dataset",a);else if(i!==void 0){let g=yield new y(this.readDataset({datasetName:i}));u.append("reference_dataset",g.id)}s!==void 0&&u.append("reference_free",s.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));try{for(var l=D(this._getPaginated("/sessions",u)),d,h,p;d=!(h=yield new y(l.next())).done;d=!1){let g=h.value;yield*ie(g)}}catch{p=[h]}finally{try{d&&(h=l.return)&&(yield new y(h.call(l)))}finally{if(p)throw p[0]}}})}deleteProject(r){return f(this,arguments,function*({projectId:e,projectName:t}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?a=(yield this.readProject({projectName:t})).id:a=e,B(a);let i=yield this.caller.call(k(),`${this.apiUrl}/sessions/${a}`,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(i,`delete session ${a} (${t})`,!0)})}uploadCsv(u){return f(this,arguments,function*({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:s,name:o}){let l=`${this.apiUrl}/datasets/upload`,d=new FormData;d.append("file",e,t),r.forEach(g=>{d.append("input_keys",g)}),a.forEach(g=>{d.append("output_keys",g)}),i&&d.append("description",i),s&&d.append("data_type",s),o&&d.append("name",o);let h=yield this.caller.call(k(),l,c({method:"POST",headers:this.headers,body:d,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(h,"upload CSV"),yield h.json()})}createDataset(o){return f(this,arguments,function*(e,{description:t,dataType:r,inputsSchema:a,outputsSchema:i,metadata:s}={}){let u={name:e,description:t,extra:s?{metadata:s}:void 0};r&&(u.data_type=r),a&&(u.inputs_schema_definition=a),i&&(u.outputs_schema_definition=i);let l=yield this.caller.call(k(),`${this.apiUrl}/datasets`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(l,"create dataset"),yield l.json()})}readDataset(r){return f(this,arguments,function*({datasetId:e,datasetName:t}){let a="/datasets",i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)B(e),a+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");let s=yield this._get(a,i),o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);o=s[0]}else o=s;return o})}hasDataset(r){return f(this,arguments,function*({datasetId:e,datasetName:t}){try{return yield this.readDataset({datasetId:e,datasetName:t}),!0}catch(a){if(a instanceof Error&&a.message.toLocaleLowerCase().includes("not found"))return!1;throw a}})}diffDatasetVersions(i){return f(this,arguments,function*({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let s=e;if(s===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(yield this.readDataset({datasetName:t})).id);let o=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return yield this._get(`/datasets/${s}/versions/diff`,o)})}readDatasetOpenaiFinetuning(r){return f(this,arguments,function*({datasetId:e,datasetName:t}){let a="/datasets";if(e===void 0)if(t!==void 0)e=(yield this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(yield(yield this._getResponse(`${a}/${e}/openai_ft`)).text()).trim().split(`
`).map(u=>JSON.parse(u))})}listDatasets(){return C(this,arguments,function*({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i,metadata:s}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(let g of r)u.append("id",g);a!==void 0&&u.append("name",a),i!==void 0&&u.append("name_contains",i),s!==void 0&&u.append("metadata",JSON.stringify(s));try{for(var l=D(this._getPaginated(o,u)),d,h,p;d=!(h=yield new y(l.next())).done;d=!1){let g=h.value;yield*ie(g)}}catch{p=[h]}finally{try{d&&(h=l.return)&&(yield new y(h.call(l)))}finally{if(p)throw p[0]}}})}updateDataset(e){return f(this,null,function*(){let o=e,{datasetId:t,datasetName:r}=o,a=ce(o,["datasetId","datasetName"]);if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");let i=t??(yield this.readDataset({datasetName:r})).id;B(i);let s=yield this.caller.call(k(),`${this.apiUrl}/datasets/${i}`,c({method:"PATCH",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(s,"update dataset"),yield s.json()})}deleteDataset(r){return f(this,arguments,function*({datasetId:e,datasetName:t}){let a="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(yield this.readDataset({datasetName:t})).id),i!==void 0)B(i),a+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");let s=yield this.caller.call(k(),this.apiUrl+a,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(s,`delete ${a}`),yield s.json()})}indexDataset(a){return f(this,arguments,function*({datasetId:e,datasetName:t,tag:r}){let i=e;if(!i&&!t)throw new Error("Must provide either datasetName or datasetId");if(i&&t)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(yield this.readDataset({datasetName:t})).id),B(i);let s={tag:r},o=yield this.caller.call(k(),`${this.apiUrl}/datasets/${i}/index`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(o,"index dataset"),yield o.json()})}similarExamples(i,s,o){return f(this,arguments,function*(e,t,r,{filter:a}={}){let u={limit:r,inputs:e};a!==void 0&&(u.filter=a),B(t);let l=yield this.caller.call(k(),`${this.apiUrl}/datasets/${t}/search`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(l,"fetch similar examples"),(yield l.json()).examples})}createExample(d,h,p){return f(this,arguments,function*(e,t,{datasetId:r,datasetName:a,createdAt:i,exampleId:s,metadata:o,split:u,sourceRunId:l}){let g=r;if(g===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(g!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");g===void 0&&(g=(yield this.readDataset({datasetName:a})).id);let L={dataset_id:g,inputs:e,outputs:t,created_at:(i||new Date)?.toISOString(),id:s,metadata:o,split:u,source_run_id:l},T=yield this.caller.call(k(),`${this.apiUrl}/examples`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(L),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(T,"create example"),yield T.json()})}createExamples(e){return f(this,null,function*(){let{inputs:t,outputs:r,metadata:a,sourceRunIds:i,exampleIds:s,datasetId:o,datasetName:u}=e,l=o;if(l===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(yield this.readDataset({datasetName:u})).id);let d=t.map((g,U)=>({dataset_id:l,inputs:g,outputs:r?r[U]:void 0,metadata:a?a[U]:void 0,split:e.splits?e.splits[U]:void 0,id:s?s[U]:void 0,source_run_id:i?i[U]:void 0})),h=yield this.caller.call(k(),`${this.apiUrl}/examples/bulk`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(h,"create examples"),yield h.json()})}createLLMExample(e,t,r){return f(this,null,function*(){return this.createExample({input:e},{output:t},r)})}createChatExample(e,t,r){return f(this,null,function*(){let a=e.map(s=>ia(s)?sa(s):s),i=ia(t)?sa(t):t;return this.createExample({input:a},{output:i},r)})}readExample(e){return f(this,null,function*(){B(e);let t=`/examples/${e}`;return yield this._get(t)})}listExamples(){return C(this,arguments,function*({datasetId:e,datasetName:t,exampleIds:r,asOf:a,splits:i,inlineS3Urls:s,metadata:o,limit:u,offset:l,filter:d}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(yield new y(this.readDataset({datasetName:t}))).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:h}),g=a?typeof a=="string"?a:a?.toISOString():void 0;g&&p.append("as_of",g);let U=s??!0;if(p.append("inline_s3_urls",U.toString()),r!==void 0)for(let F of r)p.append("id",F);if(i!==void 0)for(let F of i)p.append("splits",F);if(o!==void 0){let F=JSON.stringify(o);p.append("metadata",F)}u!==void 0&&p.append("limit",u.toString()),l!==void 0&&p.append("offset",l.toString()),d!==void 0&&p.append("filter",d);let L=0;try{for(var T=D(this._getPaginated("/examples",p)),w,P,M;w=!(P=yield new y(T.next())).done;w=!1){let F=P.value;for(let V of F)yield V,L++;if(u!==void 0&&L>=u)break}}catch{M=[P]}finally{try{w&&(P=T.return)&&(yield new y(P.call(T)))}finally{if(M)throw M[0]}}})}deleteExample(e){return f(this,null,function*(){B(e);let t=`/examples/${e}`,r=yield this.caller.call(k(),this.apiUrl+t,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(r,`delete ${t}`),yield r.json()})}updateExample(e,t){return f(this,null,function*(){B(e);let r=yield this.caller.call(k(),`${this.apiUrl}/examples/${e}`,c({method:"PATCH",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(r,"update example"),yield r.json()})}updateExamples(e){return f(this,null,function*(){let t=yield this.caller.call(k(),`${this.apiUrl}/examples/bulk`,c({method:"PATCH",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(t,"update examples"),yield t.json()})}listDatasetSplits(a){return f(this,arguments,function*({datasetId:e,datasetName:t,asOf:r}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(yield this.readDataset({datasetName:t})).id:i=e,B(i);let s=new URLSearchParams,o=r?typeof r=="string"?r:r?.toISOString():void 0;return o&&s.append("as_of",o),yield this._get(`/datasets/${i}/splits`,s)})}updateDatasetSplits(s){return f(this,arguments,function*({datasetId:e,datasetName:t,splitName:r,exampleIds:a,remove:i=!1}){let o;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?o=(yield this.readDataset({datasetName:t})).id:o=e,B(o);let u={split_name:r,examples:a.map(d=>(B(d),d)),remove:i},l=yield this.caller.call(k(),`${this.apiUrl}/datasets/${o}/splits`,c({method:"PUT",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(l,"update dataset splits",!0)})}evaluateRun(s,o){return f(this,arguments,function*(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:i}={loadChildRuns:!1}){Gr("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let u;if(typeof e=="string")u=yield this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)u=e;else throw new Error(`Invalid run type: ${typeof e}`);u.reference_example_id!==null&&u.reference_example_id!==void 0&&(i=yield this.readExample(u.reference_example_id));let l=yield t.evaluateRun(u,i),[d,h]=yield this._logEvaluationFeedback(l,u,r);return h[0]})}createFeedback(U,L,T){return f(this,arguments,function*(e,t,{score:r,value:a,correction:i,comment:s,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:d,feedbackConfig:h,projectId:p,comparativeExperimentId:g}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");let w={type:u??"api",metadata:o??{}};l!==void 0&&w?.metadata!==void 0&&!w.metadata.__run&&(w.metadata.__run={run_id:l}),w?.metadata!==void 0&&w.metadata.__run?.run_id!==void 0&&B(w.metadata.__run.run_id);let P={id:d??Y(),run_id:e,key:t,score:r,value:a,correction:i,comment:s,feedback_source:w,comparative_experiment_id:g,feedbackConfig:h,session_id:p},M=`${this.apiUrl}/feedback`,F=yield this.caller.call(k(),M,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(P),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(F,"create feedback",!0),P})}updateFeedback(s,o){return f(this,arguments,function*(e,{score:t,value:r,correction:a,comment:i}){let u={};t!=null&&(u.score=t),r!=null&&(u.value=r),a!=null&&(u.correction=a),i!=null&&(u.comment=i),B(e);let l=yield this.caller.call(k(),`${this.apiUrl}/feedback/${e}`,c({method:"PATCH",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(l,"update feedback",!0)})}readFeedback(e){return f(this,null,function*(){B(e);let t=`/feedback/${e}`;return yield this._get(t)})}deleteFeedback(e){return f(this,null,function*(){B(e);let t=`/feedback/${e}`,r=yield this.caller.call(k(),this.apiUrl+t,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(r,`delete ${t}`),yield r.json()})}listFeedback(){return C(this,arguments,function*({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let l of t)a.append("key",l);if(r)for(let l of r)a.append("source",l);try{for(var i=D(this._getPaginated("/feedback",a)),s,o,u;s=!(o=yield new y(i.next())).done;s=!1){let l=o.value;yield*ie(l)}}catch{u=[o]}finally{try{s&&(o=i.return)&&(yield new y(o.call(i)))}finally{if(u)throw u[0]}}})}createPresignedFeedbackToken(i,s){return f(this,arguments,function*(e,t,{expiration:r,feedbackConfig:a}={}){let o={run_id:e,feedback_key:t,feedback_config:a};return r?typeof r=="string"?o.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(o.expires_in=r):o.expires_in={hours:3},yield(yield this.caller.call(k(),`${this.apiUrl}/feedback/tokens`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}createComparativeExperiment(u){return f(this,arguments,function*({name:e,experimentIds:t,referenceDatasetId:r,createdAt:a,description:i,metadata:s,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(yield this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(a??new Date)?.toISOString(),extra:{}};return s&&(l.extra.metadata=s),yield(yield this.caller.call(k(),`${this.apiUrl}/datasets/comparative`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listPresignedFeedbackTokens(e){return C(this,null,function*(){B(e);let t=new URLSearchParams({run_id:e});try{for(var r=D(this._getPaginated("/feedback/tokens",t)),a,i,s;a=!(i=yield new y(r.next())).done;a=!1){let o=i.value;yield*ie(o)}}catch{s=[i]}finally{try{a&&(i=r.return)&&(yield new y(i.call(r)))}finally{if(s)throw s[0]}}})}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}_logEvaluationFeedback(e,t,r){return f(this,null,function*(){let a=this._selectEvalResults(e),i=[];for(let s of a){let o=r||{};s.evaluatorInfo&&(o=c(c({},s.evaluatorInfo),o));let u=null;s.targetRunId?u=s.targetRunId:t&&(u=t.id),i.push(yield this.createFeedback(u,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[a,i]})}logEvaluationFeedback(e,t,r){return f(this,null,function*(){let[a]=yield this._logEvaluationFeedback(e,t,r);return a})}_currentTenantIsOwner(e){return f(this,null,function*(){let t=yield this._getSettings();return e=="-"||t.tenant_handle===e})}_ownerConflictError(e,t){return f(this,null,function*(){let r=yield this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)})}_getLatestCommitHash(e){return f(this,null,function*(){let t=yield this.caller.call(k(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),r=yield t.json();if(!t.ok){let a=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${a}`);throw i.statusCode=t.status,i}if(r.commits.length!==0)return r.commits[0].commit_hash})}_likeOrUnlikePrompt(e,t){return f(this,null,function*(){let[r,a,i]=Ge(e),s=yield this.caller.call(k(),`${this.apiUrl}/likes/${r}/${a}`,c({method:"POST",body:JSON.stringify({like:t}),headers:m(c({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(s,`${t?"like":"unlike"} prompt`),yield s.json()})}_getPromptUrl(e){return f(this,null,function*(){let[t,r,a]=Ge(e);if(yield this._currentTenantIsOwner(t)){let i=yield this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`})}promptExists(e){return f(this,null,function*(){return!!(yield this.getPrompt(e))})}likePrompt(e){return f(this,null,function*(){return this._likeOrUnlikePrompt(e,!0)})}unlikePrompt(e){return f(this,null,function*(){return this._likeOrUnlikePrompt(e,!1)})}listCommits(e){return C(this,null,function*(){try{for(var t=D(this._getPaginated(`/commits/${e}/`,{},o=>o.commits)),r,a,i;r=!(a=yield new y(t.next())).done;r=!1){let s=a.value;yield*ie(s)}}catch{i=[a]}finally{try{r&&(a=t.return)&&(yield new y(a.call(t)))}finally{if(i)throw i[0]}}})}listPrompts(e){return C(this,null,function*(){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);try{for(var r=D(this._getPaginated("/repos",t,u=>u.repos)),a,i,s;a=!(i=yield new y(r.next())).done;a=!1){let o=i.value;yield*ie(o)}}catch{s=[i]}finally{try{a&&(i=r.return)&&(yield new y(i.call(r)))}finally{if(s)throw s[0]}}})}getPrompt(e){return f(this,null,function*(){let[t,r,a]=Ge(e),i=yield this.caller.call(k(),`${this.apiUrl}/repos/${t}/${r}`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));if(i.status===404)return null;yield H(i,"get prompt");let s=yield i.json();return s.repo?s.repo:null})}createPrompt(e,t){return f(this,null,function*(){let r=yield this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[a,i,s]=Ge(e);if(!(yield this._currentTenantIsOwner(a)))throw yield this._ownerConflictError("create a prompt",a);let o=m(c(c(c({repo_handle:i},t?.description&&{description:t.description}),t?.readme&&{readme:t.readme}),t?.tags&&{tags:t.tags}),{is_public:!!t?.isPublic}),u=yield this.caller.call(k(),`${this.apiUrl}/repos/`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(u,"create prompt");let{repo:l}=yield u.json();return l})}createCommit(e,t,r){return f(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[a,i,s]=Ge(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?yield this._getLatestCommitHash(`${a}/${i}`):r?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=yield this.caller.call(k(),`${this.apiUrl}/commits/${a}/${i}`,c({method:"POST",headers:m(c({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(l,"create commit");let d=yield l.json();return this._getPromptUrl(`${a}/${i}${d.commit_hash?`:${d.commit_hash}`:""}`)})}updatePrompt(e,t){return f(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[r,a]=Ge(e);if(!(yield this._currentTenantIsOwner(r)))throw yield this._ownerConflictError("update a prompt",r);let i={};if(t?.description!==void 0&&(i.description=t.description),t?.readme!==void 0&&(i.readme=t.readme),t?.tags!==void 0&&(i.tags=t.tags),t?.isPublic!==void 0&&(i.is_public=t.isPublic),t?.isArchived!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");let s=yield this.caller.call(k(),`${this.apiUrl}/repos/${r}/${a}`,c({method:"PATCH",body:JSON.stringify(i),headers:m(c({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield H(s,"update prompt"),s.json()})}deletePrompt(e){return f(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[t,r,a]=Ge(e);if(!(yield this._currentTenantIsOwner(t)))throw yield this._ownerConflictError("delete a prompt",t);return yield(yield this.caller.call(k(),`${this.apiUrl}/repos/${t}/${r}`,c({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}pullPromptCommit(e,t){return f(this,null,function*(){let[r,a,i]=Ge(e),s=yield this._getServerInfo(),o=lu(s.version,"0.5.23"),u=i;if(!o&&i==="latest"){let h=yield this._getLatestCommitHash(`${r}/${a}`);if(h)u=h;else throw new Error("No commits found")}let l=yield this.caller.call(k(),`${this.apiUrl}/commits/${r}/${a}/${u}${t?.includeModel?"?include_model=true":""}`,c({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield H(l,"pull prompt commit");let d=yield l.json();return{owner:r,repo:a,commit_hash:d.commit_hash,manifest:d.manifest,examples:d.examples}})}_pullPrompt(e,t){return f(this,null,function*(){let r=yield this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)})}pushPrompt(e,t){return f(this,null,function*(){return(yield this.promptExists(e))?t&&Object.keys(t).some(a=>a!=="object")&&(yield this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic})):yield this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?yield this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):yield this._getPromptUrl(e)})}clonePublicDataset(r){return f(this,arguments,function*(e,t={}){let{sourceApiUrl:a=this.apiUrl,datasetName:i}=t,[s,o]=this.parseTokenOrUrl(e,a),u=new n({apiUrl:s,apiKey:"placeholder"}),l=yield u.readSharedDataset(o),d=i||l.name;try{if(yield this.hasDataset({datasetId:d})){console.log(`Dataset ${d} already exists in your tenant. Skipping.`);return}}catch{}let h=yield u.listSharedExamples(o),p=yield this.createDataset(d,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{yield this.createExamples({inputs:h.map(g=>g.inputs),outputs:h.flatMap(g=>g.outputs?[g.outputs]:[]),datasetId:p.id})}catch(g){throw console.error(`An error occurred while creating dataset ${d}. You should delete it manually.`),g}})}parseTokenOrUrl(e,t,r=2,a="dataset"){try{return B(e),[t,e]}catch{}try{let s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){let o=s[s.length-r];return[t,o]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}};var du=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>Be(t)==="true");function bp(n){return n.replace(/[-:.]/g,"")}function wp(n,e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return bp(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}var nn=class n{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},a=[];for(let i of t){let[s,o]=i.split("="),u=decodeURIComponent(o);s==="langsmith-metadata"?r=JSON.parse(u):s==="langsmith-tags"&&(a=u.split(","))}return new n(r,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},ht=class n{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultConfig(),o=e,{metadata:r}=o,a=ce(o,["metadata"]),i=a.client??new ft,s=c(c({},r),a?.extra?.metadata);if(a.extra=m(c({},a.extra),{metadata:s}),Object.assign(this,m(c(c({},t),a),{client:i})),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let u=wp(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Y(),run_type:"chain",project_name:Ke("LANGCHAIN_PROJECT")??Ke("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Ke("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Ke("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}createChild(e){let t=this.child_execution_order+1,r=new n(m(c({},e),{parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t})),a=Symbol.for("lc:child_config"),i=e.extra?.[a]??this.extra[a];if(Ep(i)){let u=c({},i),l=vp(u.callbacks)?u.callbacks.copy?.():void 0;l&&(Object.assign(l,{_parentRunId:r.id}),l.handlers?.find(hu)?.updateFromRunTree?.(r),u.callbacks=l),r.extra[a]=u}let s=new Set,o=this;for(;o!=null&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}end(a,i){return f(this,arguments,function*(e,t,r=Date.now()){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r})}_convertToCreate(e,t,r=!0){let a=e.extra??{};if(a.runtime||(a.runtime={}),t)for(let[u,l]of Object.entries(t))a.runtime[u]||(a.runtime[u]=l);let i,s;return r?(s=e.parent_run?.id,i=[]):(i=e.child_runs.map(u=>this._convertToCreate(u,t,r)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}postRun(e=!0){return f(this,null,function*(){let t=yield Br(),r=yield this._convertToCreate(this,t,!0);if(yield this.client.createRun(r),!e){Gr("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let a of this.child_runs)yield a.postRun(!1)}})}patchRun(){return f(this,null,function*(){let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};yield this.client.updateRun(this.id,e)})}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r=e?.callbacks,a,i,s,o=du();if(r){let l=r?.getParentRunId?.()??"",d=r?.handlers?.find(h=>h?.name=="langchain_tracer");a=d?.getRun?.(l),i=d?.projectName,s=d?.client,o=o||!!d}return a?new n({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:s,tracingEnabled:o,project_name:i,tags:[...new Set((a?.tags??[]).concat(e?.tags??[]))],extra:{metadata:c(c({},a?.extra?.metadata),e?.metadata)}}).createChild(t):new n(m(c({},t),{client:s,tracingEnabled:o,project_name:i}))}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||typeof a!="string")return;let i=a.trim(),s=i.split(".").map(l=>{let[d,h]=l.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),o=s[0].uuid,u=m(c({},t),{name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:o,dotted_order:i});if(r.baggage&&typeof r.baggage=="string"){let l=nn.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags}return new n(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new nn(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,a]of Object.entries(t))e.set(r,a);return t}};function hu(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function fu(n){return Array.isArray(n)&&n.some(e=>hu(e))}function vp(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function Ep(n){return n!==void 0&&typeof n.callbacks=="object"&&(fu(n.callbacks?.handlers)||fu(n.callbacks))}var Vr="0.1.54";var Aa=$e(yu(),1);function me(n,e){return`${n.open}${e}${n.close}`}function Te(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function _u(n){return typeof n=="string"?n.trim():n==null?n:Te(n,n.toString())}function Xe(n){if(!n.end_time)return"";let e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:_e}=Aa.default,er=class extends Ee{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let a=this.runMap.get(r.parent_run_id);if(a)t.push(a),r=a;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((a,i,s)=>{let o=`${a.execution_order}:${a.run_type}:${a.name}`;return i===s.length-1?me(Aa.default.bold,o):o}).join(" > ");return me(_e.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Te(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.cyan,"[chain/end]")} [${t}] [${Xe(e)}] Exiting Chain run with output: ${Te(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.red,"[chain/error]")} [${t}] [${Xe(e)}] Chain run errored with error: ${Te(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${me(_e.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Te(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.cyan,"[llm/end]")} [${t}] [${Xe(e)}] Exiting LLM run with output: ${Te(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.red,"[llm/error]")} [${t}] [${Xe(e)}] LLM run errored with error: ${Te(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.green,"[tool/start]")} [${t}] Entering Tool run with input: "${_u(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.cyan,"[tool/end]")} [${t}] [${Xe(e)}] Exiting Tool run with output: "${_u(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.red,"[tool/error]")} [${t}] [${Xe(e)}] Tool run errored with error: ${Te(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Te(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.cyan,"[retriever/end]")} [${t}] [${Xe(e)}] Exiting Retriever run with output: ${Te(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${me(_e.red,"[retriever/error]")} [${t}] [${Xe(e)}] Retriever run errored with error: ${Te(e.error,"[error]")}`)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e);console.log(`${me(_e.blue,"[agent/action]")} [${r}] Agent selected action: ${Te(t.actions[t.actions.length-1],"[action]")}`)}};var kt=class n extends Ee{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??ke("LANGCHAIN_PROJECT")??ke("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new ft({});let i=n.getTraceableRunTree();i&&this.updateFromRunTree(i)}_convertToCreate(e,t=void 0){return f(this,null,function*(){return m(c({},e),{extra:m(c({},e.extra),{runtime:yield ns()}),child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t})})}persistRun(e){return f(this,null,function*(){})}onRunCreate(e){return f(this,null,function*(){let t=yield this._convertToCreate(e,this.exampleId);yield this.client.createRun(t)})}onRunUpdate(e){return f(this,null,function*(){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};yield this.client.updateRun(e.id,t)})}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();let a=[t];for(;a.length>0;){let i=a.shift();!i||r.has(i.id)||(r.add(i.id),this.runMap.set(i.id,i),i.child_runs&&a.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[a,i]of this.runMap){let s=new ht(m(c({},i),{child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0}));t[a]=s,r.push([a,i.dotted_order])}r.sort((a,i)=>!a[1]||!i[1]?0:a[1].localeCompare(i[1]));for(let[a]of r){let i=this.runMap.get(a),s=t[a];if(!(!i||!s)&&i.parent_run_id){let o=t[i.parent_run_id];o&&(o.child_runs.push(s),s.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return Xi()}catch{return}}};var an=$e(qr(),1);var Ca;function Op(){let n="default"in an.default?an.default.default:an.default;return new n({autoStart:!0,concurrency:1})}function X(n,e){return f(this,null,function*(){e===!0?yield n():(typeof Ca>"u"&&(Ca=Op()),Ca.add(n))})}var Na=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ke(t)==="true");Na()&&ke("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);var $a=class{setHandler(e){return this.setHandlers([e])}},Pt=class{constructor(e,t,r,a,i,s,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}handleText(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){try{yield t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleCustomEvent(e,t,r,a,i){return f(this,null,function*(){yield Promise.all(this.handlers.map(s=>X(()=>f(this,null,function*(){try{yield s.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${o}`),s.raiseError)throw o}}),s.awaitHandlers)))})}},ja=class extends Pt{getChild(e){let t=new Me(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleRetrieverEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleRetrieverError(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}}),t.awaitHandlers)))})}},sn=class extends Pt{handleLLMNewToken(e,t,r,a,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(o=>X(()=>f(this,null,function*(){if(!o.ignoreLLM)try{yield o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}}),o.awaitHandlers)))})}handleLLMError(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreLLM)try{yield t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleLLMEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreLLM)try{yield t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}},La=class extends Pt{getChild(e){let t=new Me(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleChainError(e,t,r,a,i){return f(this,null,function*(){yield Promise.all(this.handlers.map(s=>X(()=>f(this,null,function*(){if(!s.ignoreChain)try{yield s.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${o}`),s.raiseError)throw o}}),s.awaitHandlers)))})}handleChainEnd(e,t,r,a,i){return f(this,null,function*(){yield Promise.all(this.handlers.map(s=>X(()=>f(this,null,function*(){if(!s.ignoreChain)try{yield s.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${o}`),s.raiseError)throw o}}),s.awaitHandlers)))})}handleAgentAction(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleAgentEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}},Ma=class extends Pt{getChild(e){let t=new Me(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleToolError(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}handleToolEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>X(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${r}`),t.raiseError)throw r}}),t.awaitHandlers)))})}},Me=class n extends $a{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}handleLLMStart(e,t,r=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return f(this,null,function*(){return Promise.all(t.map((l,d)=>f(this,null,function*(){let h=d===0&&r?r:Y();return yield Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Tt(p)&&p._createRunForLLMStart(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u),X(()=>f(this,null,function*(){try{yield p.handleLLMStart?.(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u)}catch(g){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${g}`),p.raiseError)throw g}}),p.awaitHandlers)})),new sn(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChatModelStart(e,t,r=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return f(this,null,function*(){return Promise.all(t.map((l,d)=>f(this,null,function*(){let h=d===0&&r?r:Y();return yield Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Tt(p)&&p._createRunForChatModelStart(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u),X(()=>f(this,null,function*(){try{if(p.handleChatModelStart)yield p.handleChatModelStart?.(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u);else if(p.handleLLMStart){let g=pr(l);yield p.handleLLMStart?.(e,[g],h,this._parentRunId,i,this.tags,this.metadata,u)}}catch(g){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${g}`),p.raiseError)throw g}}),p.awaitHandlers)})),new sn(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChainStart(u,l){return f(this,arguments,function*(e,t,r=Y(),a=void 0,i=void 0,s=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreChain)return Tt(d)&&d._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,a,o),X(()=>f(this,null,function*(){try{yield d.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(h){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleChainStart: ${h}`),d.raiseError)throw h}}),d.awaitHandlers)})),new La(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleToolStart(u,l){return f(this,arguments,function*(e,t,r=Y(),a=void 0,i=void 0,s=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreAgent)return Tt(d)&&d._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),X(()=>f(this,null,function*(){try{yield d.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(h){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleToolStart: ${h}`),d.raiseError)throw h}}),d.awaitHandlers)})),new Ma(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleRetrieverStart(u,l){return f(this,arguments,function*(e,t,r=Y(),a=void 0,i=void 0,s=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreRetriever)return Tt(d)&&d._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),X(()=>f(this,null,function*(){try{yield d.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(h){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleRetrieverStart: ${h}`),d.raiseError)throw h}}),d.awaitHandlers)})),new ja(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleCustomEvent(e,t,r,a,i){return f(this,null,function*(){yield Promise.all(this.handlers.map(s=>X(()=>f(this,null,function*(){if(!s.ignoreCustomEvent)try{yield s.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(o){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${o}`),s.raiseError)throw o}}),s.awaitHandlers)))})}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata=c(c({},this.metadata),e),t&&(this.inheritableMetadata=c(c({},this.inheritableMetadata),e))}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new n(this._parentRunId);for(let a of this.handlers){let i=this.inheritableHandlers.includes(a);r.addHandler(a,i)}for(let a of this.tags){let i=this.inheritableTags.includes(a);r.addTags([a],i)}for(let a of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},i)}for(let a of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends ct{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,a,i,s,o){return f(this,null,function*(){return this._configureSync(e,t,r,a,i,s,o)})}static _configureSync(e,t,r,a,i,s,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new n,u.setHandlers(e?.map(tr)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(tr):t?.handlers,!1));let l=ke("LANGCHAIN_VERBOSE")==="true"||o?.verbose,d=kt.getTraceableRunTree()?.tracingEnabled||Na(),h=d||(ke("LANGCHAIN_TRACING")??!1);if(l||h){if(u||(u=new n),l&&!u.handlers.some(p=>p.name===er.prototype.name)){let p=new er;u.addHandler(p,!0)}if(h&&!u.handlers.some(p=>p.name==="langchain_tracer")&&d){let p=new kt;u.addHandler(p,!0),u._parentRunId=kt.getTraceableRunTree()?.id??u._parentRunId}}return(r||a)&&u&&(u.addTags(r??[]),u.addTags(a??[],!1)),(i||s)&&u&&(u.addMetadata(i??{}),u.addMetadata(s??{},!1)),u}};function tr(n){return"name"in n?n:ct.fromMethods(n)}var Ua=class{getStore(){}run(e,t){return t()}},Tp=new Ua,Da=Symbol.for("ls:tracing_async_local_storage"),bu=Symbol.for("lc:child_config"),Fa=class{getInstance(){return globalThis[Da]??Tp}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[bu]}runWithConfig(e,t,r){let a=Me._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),i=this.getInstance(),s=a?.getParentRunId(),o=a?.handlers?.find(l=>l?.name==="langchain_tracer"),u;return o&&s?u=o.convertToRunTree(s):r||(u=new ht({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra=m(c({},u.extra),{[bu]:e})),i.run(u,t)}initializeGlobalInstance(e){globalThis[Da]===void 0&&(globalThis[Da]=e)}},Pe=new Fa;function De(n,e){return f(this,null,function*(){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,a)=>{t=()=>{a(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))})}var le=class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}next(){return f(this,null,function*(){this.ensureReader();try{let e=yield this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}})}return(){return f(this,null,function*(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),yield e}return{done:!0,value:void 0}})}throw(e){return f(this,null,function*(){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),yield t}throw e})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return f(this,null,function*(){yield this.return()})}static fromReadableStream(e){let t=e.getReader();return new n({start(r){return a();function a(){return t.read().then(({done:i,value:s})=>{if(i){r.close();return}return r.enqueue(s),a()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({pull(r){return f(this,null,function*(){let{value:a,done:i}=yield e.next();i&&r.close(),r.enqueue(a)})},cancel(r){return f(this,null,function*(){yield e.return(r)})}})}};function Za(n,e=2){let t=Array.from({length:e},()=>[]);return t.map(function(a){return C(this,null,function*(){for(;;)if(a.length===0){let i=yield new y(n.next());for(let s of t)s.push(i)}else{if(a[0].done)return;yield a.shift().value}})})}function Ue(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){let t=c({},n);for(let[r,a]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Ue(t[r],a):t[r]=a;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}var ze=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{Pe.runWithConfig(e.config,()=>f(this,null,function*(){this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(a=>t(void 0),r)}),!0)})}next(...e){return f(this,null,function*(){return this.signal?.throwIfAborted(),this.firstResultUsed?Pe.runWithConfig(this.config,this.signal?()=>f(this,null,function*(){return De(this.generator.next(...e),this.signal)}):()=>f(this,null,function*(){return this.generator.next(...e)}),!0):(this.firstResultUsed=!0,this.firstResult)})}return(e){return f(this,null,function*(){return this.generator.return(e)})}throw(e){return f(this,null,function*(){return this.generator.throw(e)})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return f(this,null,function*(){yield this.return()})}};function wu(n,e,t,r,...a){return f(this,null,function*(){let i=new ze({generator:e,startSetup:t,signal:r}),s=yield i.setup;return{output:n(i,s,...a),setup:s}})}var Ae=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=lt({},t);return new rr({ops:t,state:r[r.length-1].newDocument})}},rr=class n extends Ae{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=lt(this.state,e.ops);return new n({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=lt({},e.ops);return new n({ops:e.ops,state:t[t.length-1].newDocument})}},xu=n=>n.name==="log_stream_tracer";function vu(n,e){return f(this,null,function*(){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input})}function Eu(n,e){return f(this,null,function*(){let{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t})}function Sp(n){return n!==void 0&&n.message!==void 0}var nr=class extends Ee{constructor(e){super(c({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=le.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return f(this,null,function*(){})}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(a=>this.includeTags?.includes(a))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(a=>!this.excludeTags?.includes(a))),r}tapOutputIterable(e,t){return C(this,null,function*(){try{for(var r=D(t),a,i,s;a=!(i=yield new y(r.next())).done;a=!1){let o=i.value;if(e!==this.rootId){let u=this.keyMapByRunId[e];u&&(yield new y(this.writer.write(new Ae({ops:[{op:"add",path:`/logs/${u}/streamed_output/-`,value:o}]}))))}yield o}}catch{s=[i]}finally{try{a&&(i=r.return)&&(yield new y(i.call(r)))}finally{if(s)throw s[0]}}})}onRunCreate(e){return f(this,null,function*(){if(this.rootId===void 0&&(this.rootId=e.id,yield this.writer.write(new Ae({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=yield vu(e,this._schemaFormat)),yield this.writer.write(new Ae({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))})}onRunUpdate(e){return f(this,null,function*(){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:yield vu(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:yield Eu(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new Ae({ops:r});yield this.writer.write(a)}finally{if(e.id===this.rootId){let t=new Ae({ops:[{op:"replace",path:"/final_output",value:yield Eu(e,this._schemaFormat)}]});yield this.writer.write(t),this.autoClose&&(yield this.writer.close())}}})}onLLMNewToken(e,t,r){return f(this,null,function*(){let a=this.keyMapByRunId[e.id];if(a===void 0)return;let i=e.inputs.messages!==void 0,s;i?Sp(r?.chunk)?s=r?.chunk:s=new et({id:`run-${e.id}`,content:t}):s=t;let o=new Ae({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:s}]});yield this.writer.write(o)})}};var ar=class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:c(c({},this.generationInfo),e.generationInfo)})}};function on({name:n,serialized:e}){return n!==void 0?n:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var Ou=n=>n.name==="event_stream_tracer",un=class extends Ee{constructor(e){super(c({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=le.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return f(this,null,function*(){})}_includeRun(e){let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(a=>this.includeTags?.includes(a))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(a=>!this.excludeTags?.includes(a))),r}tapOutputIterable(e,t){return C(this,null,function*(){let r=yield new y(t.next());if(r.done)return;let a=this.runInfoMap.get(e);if(a===void 0){yield r.value;return}function i(L,T){return L==="llm"&&typeof T=="string"?new ar({text:T}):T}let s=this.tappedPromises.get(e);if(s===void 0){let L;s=new Promise(T=>{L=T}),this.tappedPromises.set(e,s);try{let T={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};yield new y(this.send(m(c({},T),{data:{chunk:i(a.runType,r.value)}}),a)),yield r.value;try{for(var o=D(t),u,l,d;u=!(l=yield new y(o.next())).done;u=!1){let w=l.value;a.runType!=="tool"&&a.runType!=="retriever"&&(yield new y(this.send(m(c({},T),{data:{chunk:i(a.runType,w)}}),a))),yield w}}catch{d=[l]}finally{try{u&&(l=o.return)&&(yield new y(l.call(o)))}finally{if(d)throw d[0]}}}finally{L()}}else{yield r.value;try{for(var h=D(t),p,g,U;p=!(g=yield new y(h.next())).done;p=!1){let L=g.value;yield L}}catch{U=[g]}finally{try{p&&(g=h.return)&&(yield new y(g.call(h)))}finally{if(U)throw U[0]}}}})}send(e,t){return f(this,null,function*(){this._includeRun(t)&&(yield this.writer.write(e))})}sendEndEvent(e,t){return f(this,null,function*(){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):yield this.send(e,t)})}onLLMStart(e){return f(this,null,function*(){let t=on(e),r=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);let i=`on_${r}_start`;yield this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)})}onLLMNewToken(e,t,r){return f(this,null,function*(){let a=this.runInfoMap.get(e.id),i,s;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(e.parent_run_id!==void 0){if(a.runType==="chat_model")s="on_chat_model_stream",r?.chunk===void 0?i=new et({content:t,id:`run-${e.id}`}):i=r.chunk.message;else if(a.runType==="llm")s="on_llm_stream",r?.chunk===void 0?i=new ar({text:t}):i=r.chunk;else throw new Error(`Unexpected run type ${a.runType}`);yield this.send({event:s,data:{chunk:i},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}})}onLLMEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let a=e.outputs?.generations,i;if(t.runType==="chat_model"){for(let s of a??[]){if(i!==void 0)break;i=s[0]?.message}r="on_chat_model_end"}else if(t.runType==="llm")i={generations:a?.map(s=>s.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);yield this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onChainStart(e){return f(this,null,function*(){let t=on(e),r=e.run_type??"chain",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},a.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,a.inputs=e.inputs.input):(i.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),yield this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)})}onChainEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},s={output:e.outputs?.output??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(s.input=a.input,t.inputs=a.input),yield this.sendEndEvent({event:r,data:s,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)})}onToolStart(e){return f(this,null,function*(){let t=on(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),yield this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)})}onToolEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;yield this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onRetrieverStart(e){return f(this,null,function*(){let t=on(e),a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),yield this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)})}onRetrieverEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);yield this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}handleCustomEvent(e,t,r){return f(this,null,function*(){let a=this.runInfoMap.get(r);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);yield this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:t},a)})}finish(){return f(this,null,function*(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})})}};var ln=25;function Se(n){return f(this,null,function*(){return Me._configureSync(n?.callbacks,void 0,n?.tags,void 0,n?.metadata)})}function qa(...n){let e={};for(let t of n.filter(r=>!!r))for(let r of Object.keys(t))if(r==="metadata")e[r]=c(c({},e[r]),t[r]);else if(r==="tags"){let a=e[r]??[];e[r]=[...new Set(a.concat(t[r]??[]))]}else if(r==="configurable")e[r]=c(c({},e[r]),t[r]);else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){let a=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!a)e.callbacks=i;else if(Array.isArray(a))e.callbacks=a.concat(i);else{let s=a.copy();for(let o of i)s.addHandler(tr(o),!0);e.callbacks=s}else if(i)if(!a)e.callbacks=i;else if(Array.isArray(a)){let s=i.copy();for(let o of a)s.addHandler(tr(o),!0);e.callbacks=s}else e.callbacks=new Me(i._parentRunId,{handlers:a.handlers.concat(i.handlers),inheritableHandlers:a.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(i.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(i.inheritableTags))),metadata:c(c({},a.metadata),i.metadata)})}else{let a=r;e[a]=t[a]??e[a]}return e}var Ip=new Set(["string","number","boolean"]);function G(n){let e=Pe.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let r=e,{runId:a,runName:i}=r,s=ce(r,["runId","runName"]);t=Object.entries(s).reduce((o,[u,l])=>(l!==void 0&&(o[u]=l),o),t)}if(n&&(t=Object.entries(n).reduce((a,[i,s])=>(s!==void 0&&(a[i]=s),a),t)),t?.configurable)for(let a of Object.keys(t.configurable))Ip.has(typeof t.configurable[a])&&!t.metadata?.[a]&&(t.metadata||(t.metadata={}),t.metadata[a]=t.configurable[a]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let a=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,a])):t.signal=a,delete t.timeout}return t}function ne(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:a,configurable:i,runId:s}={}){let o=G(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),a!==void 0&&(o.runName=a),i!==void 0&&(o.configurable=c(c({},o.configurable),i)),s!==void 0&&delete o.runId,o}var Tu=$e(Rr(),1),cn=$e(qr(),1),Rp=[400,401,402,403,404,405,406,407,409],kp=n=>{if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||n?.code==="ECONNABORTED")throw n;let e=n?.response?.status??n?.status;if(e&&Rp.includes(+e))throw n;if(n?.error?.code==="insufficient_quota"){let t=new Error(n?.message);throw t.name="InsufficientQuotaError",t}},dn=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??kp;let t="default"in cn.default?cn.default.default:cn.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Tu.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{e.signal?.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var ir=class extends Ee{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}onRunCreate(e){return f(this,null,function*(){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?yield this.argOnStart(e):this.argOnStart.length===2&&(yield this.argOnStart(e,this.config))))})}onRunUpdate(e){return f(this,null,function*(){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?yield this.argOnError(e):this.argOnError.length===2&&(yield this.argOnError(e,this.config))):this.argOnEnd&&(this.argOnEnd.length===1?yield this.argOnEnd(e):this.argOnEnd.length===2&&(yield this.argOnEnd(e,this.config))))})}};function sr(n){return n?n.lc_runnable:!1}var fn=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,a=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||a.some(i=>this.includeTags?.includes(i))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&a.every(i=>!this.excludeTags?.includes(i))),r}};var Iu=Symbol("Let zodToJsonSchema decide on which parser to use"),Su={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Ru=n=>typeof n=="string"?m(c({},Su),{name:n}):c(c({},Su),n);var ku=n=>{let e=Ru(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return m(c({},e),{currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))})};function Ha(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage=m(c({},n.errorMessage),{[e]:t}))}function Z(n,e,t,r,a){n[e]=t,Ha(n,e,r,a)}function Pu(){return{}}function Au(n,e){let t={type:"array"};return n.type?._def?.typeName!==b.ZodAny&&(t.items=R(n.type._def,m(c({},e),{currentPath:[...e.currentPath,"items"]}))),n.minLength&&Z(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Z(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Z(t,"minItems",n.exactLength.value,n.exactLength.message,e),Z(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Cu(n,e){let t={type:"integer",format:"int64"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Z(t,"minimum",r.value,r.message,e):Z(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Z(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Z(t,"maximum",r.value,r.message,e):Z(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Z(t,"maximum",r.value,r.message,e));break;case"multipleOf":Z(t,"multipleOf",r.value,r.message,e);break}return t}function Nu(){return{type:"boolean"}}function $u(n,e){return R(n.type._def,e)}var ju=(n,e)=>R(n.innerType._def,e);function Ba(n,e,t){let r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,i)=>Ba(n,e,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Pp(n,e)}}var Pp=(n,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let r of n.checks)switch(r.kind){case"min":Z(t,"minimum",r.value,r.message,e);break;case"max":Z(t,"maximum",r.value,r.message,e);break}return t};function Lu(n,e){return m(c({},R(n.innerType._def,e)),{default:n.defaultValue()})}function Mu(n,e){return e.effectStrategy==="input"?R(n.schema._def,e):{}}function Du(n){return{type:"string",enum:n.values}}var Ap=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Uu(n,e){let t=[R(n.left._def,m(c({},e),{currentPath:[...e.currentPath,"allOf","0"]})),R(n.right._def,m(c({},e),{currentPath:[...e.currentPath,"allOf","1"]}))].filter(i=>!!i),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,a=[];return t.forEach(i=>{if(Ap(i))a.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let o=i;if("additionalProperties"in i&&i.additionalProperties===!1){let s=i,{additionalProperties:u}=s;o=ce(s,["additionalProperties"])}else r=void 0;a.push(o)}}),a.length?c({allOf:a},r):void 0}function Fu(n,e){let t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}var Va,pt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Va===void 0&&(Va=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Va),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function hn(n,e){let t={type:"string"};function r(a){return e.patternStrategy==="escape"?Cp(a):a}if(n.checks)for(let a of n.checks)switch(a.kind){case"min":Z(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e);break;case"max":Z(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ce(t,"email",a.message,e);break;case"format:idn-email":Ce(t,"idn-email",a.message,e);break;case"pattern:zod":Ne(t,pt.email,a.message,e);break}break;case"url":Ce(t,"uri",a.message,e);break;case"uuid":Ce(t,"uuid",a.message,e);break;case"regex":Ne(t,a.regex,a.message,e);break;case"cuid":Ne(t,pt.cuid,a.message,e);break;case"cuid2":Ne(t,pt.cuid2,a.message,e);break;case"startsWith":Ne(t,RegExp(`^${r(a.value)}`),a.message,e);break;case"endsWith":Ne(t,RegExp(`${r(a.value)}$`),a.message,e);break;case"datetime":Ce(t,"date-time",a.message,e);break;case"date":Ce(t,"date",a.message,e);break;case"time":Ce(t,"time",a.message,e);break;case"duration":Ce(t,"duration",a.message,e);break;case"length":Z(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,a.value):a.value,a.message,e),Z(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,a.value):a.value,a.message,e);break;case"includes":{Ne(t,RegExp(r(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&Ce(t,"ipv4",a.message,e),a.version!=="v4"&&Ce(t,"ipv6",a.message,e);break}case"emoji":Ne(t,pt.emoji,a.message,e);break;case"ulid":{Ne(t,pt.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ce(t,"binary",a.message,e);break}case"contentEncoding:base64":{Z(t,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{Ne(t,pt.base64,a.message,e);break}}break}case"nanoid":Ne(t,pt.nanoid,a.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var Cp=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Ce=(n,e,t,r)=>{n.format||n.anyOf?.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push(c({format:n.format},n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}})),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push(c({format:e},t&&r.errorMessages&&{errorMessage:{format:t}}))):Z(n,"format",e,t,r)},Ne=(n,e,t,r)=>{n.pattern||n.allOf?.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push(c({pattern:n.pattern},n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}})),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push(c({pattern:Zu(e,r)},t&&r.errorMessages&&{errorMessage:{pattern:t}}))):Z(n,"pattern",Zu(e,r),t,r)},Zu=(n,e)=>{let t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},a=r.i?t.source.toLowerCase():t.source,i="",s=!1,o=!1,u=!1;for(let l=0;l<a.length;l++){if(s){i+=a[l],s=!1;continue}if(r.i){if(o){if(a[l].match(/[a-z]/)){u?(i+=a[l],i+=`${a[l-2]}-${a[l]}`.toUpperCase(),u=!1):a[l+1]==="-"&&a[l+2]?.match(/[a-z]/)?(i+=a[l],u=!0):i+=`${a[l]}${a[l].toUpperCase()}`;continue}}else if(a[l].match(/[a-z]/)){i+=`[${a[l]}${a[l].toUpperCase()}]`;continue}}if(r.m){if(a[l]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(a[l]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&a[l]==="."){i+=o?`${a[l]}\r
`:`[${a[l]}\r
]`;continue}i+=a[l],a[l]==="\\"?s=!0:o&&a[l]==="]"?o=!1:!o&&a[l]==="["&&(o=!0)}try{let l=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function pn(n,e){if(e.target==="openApi3"&&n.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((r,a)=>m(c({},r),{[a]:R(n.valueType._def,m(c({},e),{currentPath:[...e.currentPath,"properties",a]}))??{}}),{}),additionalProperties:!1};let t={type:"object",additionalProperties:R(n.valueType._def,m(c({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??{}};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===b.ZodString&&n.keyType._def.checks?.length){let r=Object.entries(hn(n.keyType._def,e)).reduce((a,[i,s])=>i==="type"?a:m(c({},a),{[i]:s}),{});return m(c({},t),{propertyNames:r})}else if(n.keyType?._def.typeName===b.ZodEnum)return m(c({},t),{propertyNames:{enum:n.keyType._def.values}});return t}function qu(n,e){if(e.mapStrategy==="record")return pn(n,e);let t=R(n.keyType._def,m(c({},e),{currentPath:[...e.currentPath,"items","items","0"]}))||{},r=R(n.valueType._def,m(c({},e),{currentPath:[...e.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Hu(n){let e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),a=Array.from(new Set(r.map(i=>typeof i)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function Bu(){return{not:{}}}function Vu(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var or={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function zu(n,e){if(e.target==="openApi3")return Gu(n,e);let t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in or&&(!r._def.checks||!r._def.checks.length))){let r=t.reduce((a,i)=>{let s=or[i._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=t.reduce((a,i)=>{let s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(i._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===t.length){let a=r.filter((i,s,o)=>o.indexOf(i)===s);return{type:a.length>1?a:a[0],enum:t.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,a)=>[...r,...a._def.values.filter(i=>!r.includes(i))],[])};return Gu(n,e)}var Gu=(n,e)=>{let t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,a)=>R(r._def,m(c({},e),{currentPath:[...e.currentPath,"anyOf",`${a}`]}))).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Ju(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:or[n.innerType._def.typeName],nullable:!0}:{type:[or[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=R(n.innerType._def,m(c({},e),{currentPath:[...e.currentPath]}));return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&m(c({},r),{nullable:!0})}let t=R(n.innerType._def,m(c({},e),{currentPath:[...e.currentPath,"anyOf","0"]}));return t&&{anyOf:[t,{type:"null"}]}}function Wu(n,e){let t={type:"number"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"int":t.type="integer",Ha(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Z(t,"minimum",r.value,r.message,e):Z(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Z(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Z(t,"maximum",r.value,r.message,e):Z(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Z(t,"maximum",r.value,r.message,e));break;case"multipleOf":Z(t,"multipleOf",r.value,r.message,e);break}return t}function Np(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":R(n.catchall._def,m(c({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":R(n.catchall._def,m(c({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??!0}function Ku(n,e){let t=m(c({type:"object"},Object.entries(n.shape()).reduce((r,[a,i])=>{if(i===void 0||i._def===void 0)return r;let s=R(i._def,m(c({},e),{currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]}));return s===void 0?r:{properties:m(c({},r.properties),{[a]:s}),required:i.isOptional()?r.required:[...r.required,a]}},{properties:{},required:[]})),{additionalProperties:Np(n,e)});return t.required.length||delete t.required,t}var Xu=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return R(n.innerType._def,e);let t=R(n.innerType._def,m(c({},e),{currentPath:[...e.currentPath,"anyOf","1"]}));return t?{anyOf:[{not:{}},t]}:{}};var Yu=(n,e)=>{if(e.pipeStrategy==="input")return R(n.in._def,e);if(e.pipeStrategy==="output")return R(n.out._def,e);let t=R(n.in._def,m(c({},e),{currentPath:[...e.currentPath,"allOf","0"]})),r=R(n.out._def,m(c({},e),{currentPath:[...e.currentPath,"allOf",t?"1":"0"]}));return{allOf:[t,r].filter(a=>a!==void 0)}};function Qu(n,e){return R(n.type._def,e)}function el(n,e){let r={type:"array",uniqueItems:!0,items:R(n.valueType._def,m(c({},e),{currentPath:[...e.currentPath,"items"]}))};return n.minSize&&Z(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Z(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function tl(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>R(t._def,m(c({},e),{currentPath:[...e.currentPath,"items",`${r}`]}))).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:R(n.rest._def,m(c({},e),{currentPath:[...e.currentPath,"additionalItems"]}))}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>R(t._def,m(c({},e),{currentPath:[...e.currentPath,"items",`${r}`]}))).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function rl(){return{not:{}}}function nl(){return{}}var al=(n,e)=>R(n.innerType._def,e);function R(n,e,t=!1){let r=e.seen.get(n);if(e.override){let s=e.override?.(n,e,r,t);if(s!==Iu)return s}if(r&&!t){let s=$p(r,e);if(s!==void 0)return s}let a={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,a);let i=Lp(n,n.typeName,e);return i&&Mp(n,e,i),a.jsonSchema=i,i}var $p=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:jp(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},jp=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},Lp=(n,e,t)=>{switch(e){case b.ZodString:return hn(n,t);case b.ZodNumber:return Wu(n,t);case b.ZodObject:return Ku(n,t);case b.ZodBigInt:return Cu(n,t);case b.ZodBoolean:return Nu();case b.ZodDate:return Ba(n,t);case b.ZodUndefined:return rl();case b.ZodNull:return Vu(t);case b.ZodArray:return Au(n,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return zu(n,t);case b.ZodIntersection:return Uu(n,t);case b.ZodTuple:return tl(n,t);case b.ZodRecord:return pn(n,t);case b.ZodLiteral:return Fu(n,t);case b.ZodEnum:return Du(n);case b.ZodNativeEnum:return Hu(n);case b.ZodNullable:return Ju(n,t);case b.ZodOptional:return Xu(n,t);case b.ZodMap:return qu(n,t);case b.ZodSet:return el(n,t);case b.ZodLazy:return R(n.getter()._def,t);case b.ZodPromise:return Qu(n,t);case b.ZodNaN:case b.ZodNever:return Bu();case b.ZodEffects:return Mu(n,t);case b.ZodAny:return Pu();case b.ZodUnknown:return nl();case b.ZodDefault:return Lu(n,t);case b.ZodBranded:return $u(n,t);case b.ZodReadonly:return al(n,t);case b.ZodCatch:return ju(n,t);case b.ZodPipeline:return Yu(n,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(r=>{})(e)}},Mp=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t);var Ga=(n,e)=>{let t=ku(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[l,d])=>m(c({},u),{[l]:R(d._def,m(c({},t),{currentPath:[...t.basePath,t.definitionPath,l]}),!0)??{}}),{}):void 0,a=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,i=R(n._def,a===void 0?t:m(c({},t),{currentPath:[...t.basePath,t.definitionPath,a]}),!1)??{},s=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;s!==void 0&&(i.title=s);let o=a===void 0?r?m(c({},i),{[t.definitionPath]:r}):i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:m(c({},r),{[a]:i})};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function za(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function Dp(n,e){let t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function Up(n){let e="";for(let[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function il(n,e,t){let{firstNodeLabel:r,lastNodeLabel:a,nodeColors:i,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},l=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(s){let h="default",p={[h]:"{0}([{1}]):::otherclass"};r!==void 0&&(p[r]="{0}[{0}]:::startclass"),a!==void 0&&(p[a]="{0}[{0}]:::endclass");for(let g of Object.values(n)){let U=p[g]??p[h],L=za(g),T=g.split(":"),w=T[T.length-1];l+=`	${U.replace(/\{0\}/g,L).replace(/\{1\}/g,w)};
`}}let d="";for(let h of e){let p=h.source.includes(":")?h.source.split(":")[0]:void 0,g=h.target.includes(":")?h.target.split(":")[0]:void 0;d!==""&&(d!==p||d!==g)&&(l+=`	end
`,d=""),d===""&&p!==void 0&&p===g&&(l=`	subgraph ${p}
`,d=p);let[U,L]=Dp(h,n),T="";if(h.data!==void 0){let w=h.data,P=w.split(" ");P.length>u&&(w=P.reduce((M,F,V)=>(V%u===0&&M.push(""),M[M.length-1]+=` ${F}`,M),[]).join("<br>")),h.conditional?T=` -. ${w} .-> `:T=` -- ${w} --> `}else h.conditional?T=" -.-> ":T=" --> ";l+=`	${za(U)}${T}${za(L)};
`}return d!==""&&(l+=`end
`),s&&i!==void 0&&(l+=Up(i)),l}function sl(n,e){return f(this,null,function*(){let{backgroundColor:t="white"}=e??{},r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let a=`https://mermaid.ink/img/${r}?bgColor=${t}`,i=yield fetch(a);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return yield i.blob()})}var ol=42;function Ja(n){if(st(n.id))if(sr(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>ol&&(e=`${e.substring(0,ol)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function Fp(n){return sr(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:m(c({},Ga(n.data.schema)),{title:n.data.name})}}var ur=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=st(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>c({id:e[t.id]},Fp(t))),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let r=t||Y(),a={id:r,data:e};return this.nodes[r]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let i={source:e.id,target:t.id,data:r,conditional:a};return this.edges.push(i),i}firstNode(){let e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(l=>l.id).every(st)&&(r="");let i=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,d])=>{this.nodes[i(l)]=m(c({},d),{id:i(l)})});let s=e.edges.map(l=>m(c({},l),{source:i(l.source),target:i(l.target)}));this.edges=[...this.edges,...s];let o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:a={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:i}=e??{},s={};for(let h of Object.values(this.nodes))s[h.id]=Ja(h);let o=this.firstNode(),u=o?Ja(o):void 0,l=this.lastNode(),d=l?Ja(l):void 0;return il(s,this.edges,{firstNodeLabel:u,lastNodeLabel:d,withStyles:t,curveStyle:r,nodeColors:a,wrapLabelNWords:i})}drawMermaidPng(e){return f(this,null,function*(){let t=this.drawMermaid(e);return sl(t,{backgroundColor:e?.backgroundColor})})}};function ul(n){let e=new TextEncoder,t=new ReadableStream({start(a){return f(this,null,function*(){try{for(var i=D(n),s,o,u;s=!(o=yield i.next()).done;s=!1){let l=o.value;a.enqueue(e.encode(`event: data
data: ${JSON.stringify(l)}

`))}}catch{u=[o]}finally{try{s&&(o=i.return)&&(yield o.call(i))}finally{if(u)throw u[0]}}a.enqueue(e.encode(`event: end

`)),a.close()})}});return le.fromReadableStream(t)}function Wa(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}var ll=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function mn(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*Ka(n,e){for(;;){let{value:t,done:r}=Pe.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}function Xa(n,e){return C(this,null,function*(){let t=e[Symbol.asyncIterator]();for(;;){let{value:r,done:a}=yield new y(Pe.runWithConfig(n,t.next.bind(e),!0));if(a)break;yield r}})}function ee(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}var te=class extends Re{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new gt({bound:this,kwargs:e,config:{}})}map(){return new Qa({bound:this})}withRetry(e){return new ei(c({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt},e))}withConfig(e){return new gt({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new ri({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(G);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:t},(a,i)=>G(i===0?e:r))}return Array.from({length:t},()=>G(e))}batch(e,t,r){return f(this,null,function*(){let a=this._getOptionsList(t??{},e.length),i=a[0]?.maxConcurrency??r?.maxConcurrency,s=new dn({maxConcurrency:i,onFailedAttempt:u=>{throw u}}),o=e.map((u,l)=>s.call(()=>f(this,null,function*(){try{return yield this.invoke(u,a[l])}catch(d){if(r?.returnExceptions)return d;throw d}})));return Promise.all(o)})}_streamIterator(e,t){return C(this,null,function*(){yield this.invoke(e,t)})}stream(e,t){return f(this,null,function*(){let r=G(t),a=new ze({generator:this._streamIterator(e,r),config:r});return yield a.setup,le.fromAsyncGenerator(a)})}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=G(e):t=G({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r=c({},e);return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}_callWithConfig(e,t,r){return f(this,null,function*(){let a=G(r),s=yield(yield Se(a))?.handleChainStart(this.toJSON(),ee(t,"input"),a.runId,a?.runType,void 0,void 0,a?.runName??this.getName());delete a.runId;let o;try{let u=e.call(this,t,a,s);o=yield De(u,r?.signal)}catch(u){throw yield s?.handleChainError(u),u}return yield s?.handleChainEnd(ee(o,"output")),o})}_batchWithConfig(e,t,r,a){return f(this,null,function*(){let i=this._getOptionsList(r??{},t.length),s=yield Promise.all(i.map(Se)),o=yield Promise.all(s.map((l,d)=>f(this,null,function*(){let h=yield l?.handleChainStart(this.toJSON(),ee(t[d],"input"),i[d].runId,i[d].runType,void 0,void 0,i[d].runName??this.getName());return delete i[d].runId,h}))),u;try{let l=e.call(this,t,i,o,a);u=yield De(l,i?.[0]?.signal)}catch(l){throw yield Promise.all(o.map(d=>d?.handleChainError(l))),l}return yield Promise.all(o.map(l=>l?.handleChainEnd(ee(u,"output")))),u})}_transformStreamWithConfig(e,t,r){return C(this,null,function*(){let a,i=!0,s,o=!0,u=G(r),l=yield new y(Se(u));function d(){return C(this,null,function*(){try{for(var T=D(e),w,P,M;w=!(P=yield new y(T.next())).done;w=!1){let F=P.value;if(i)if(a===void 0)a=F;else try{a=Ue(a,F)}catch{a=void 0,i=!1}yield F}}catch{M=[P]}finally{try{w&&(P=T.return)&&(yield new y(P.call(T)))}finally{if(M)throw M[0]}}})}let h;try{let T=yield new y(wu(t.bind(this),d(),()=>f(this,null,function*(){return l?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName())}),r?.signal,u));delete u.runId,h=T.setup;let w=h?.handlers.find(Ou),P=T.output;w!==void 0&&h!==void 0&&(P=w.tapOutputIterable(h.runId,P));let M=h?.handlers.find(xu);M!==void 0&&h!==void 0&&(P=M.tapOutputIterable(h.runId,P));try{for(var p=D(P),g,U,L;g=!(U=yield new y(p.next())).done;g=!1){let F=U.value;if(yield F,o)if(s===void 0)s=F;else try{s=Ue(s,F)}catch{s=void 0,o=!1}}}catch{L=[U]}finally{try{g&&(U=p.return)&&(yield new y(U.call(p)))}finally{if(L)throw L[0]}}}catch(T){throw yield new y(h?.handleChainError(T,void 0,void 0,void 0,{inputs:ee(a,"input")})),T}yield new y(h?.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:ee(a,"input")}))})}getGraph(e){let t=new ur,r=t.addNode({name:`${this.getName()}Input`,schema:xt.any()}),a=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:xt.any()});return t.addEdge(r,a),t.addEdge(a,i),t}pipe(e){return new gn({first:this,last:mt(e)})}pick(e){return this.pipe(new ai(e))}assign(e){return this.pipe(new ni(new lr({steps:e})))}transform(e,t){return C(this,null,function*(){let r;try{for(var a=D(e),i,s,o;i=!(s=yield new y(a.next())).done;i=!1){let u=s.value;r===void 0?r=u:r=Ue(r,u)}}catch{o=[s]}finally{try{i&&(s=a.return)&&(yield new y(s.call(a)))}finally{if(o)throw o[0]}}yield*ie(this._streamIterator(r,G(t)))})}streamLog(e,t,r){return C(this,null,function*(){let a=new nr(m(c({},r),{autoClose:!1,_schemaFormat:"original"})),i=G(t);yield*ie(this._streamLog(e,a,i))})}_streamLog(e,t,r){return C(this,null,function*(){let{callbacks:a}=r;if(a===void 0)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{let p=a.copy();p.inheritableHandlers.push(t),r.callbacks=p}let i=this.stream(e,r);function s(){return f(this,null,function*(){try{let T=yield i;try{for(var p=D(T),g,U,L;g=!(U=yield p.next()).done;g=!1){let w=U.value;let P=new Ae({ops:[{op:"add",path:"/streamed_output/-",value:w}]});yield t.writer.write(P)}}catch{L=[U]}finally{try{g&&(U=p.return)&&(yield U.call(p))}finally{if(L)throw L[0]}}}finally{yield t.writer.close()}})}let o=s();try{try{for(var u=D(t),l,d,h;l=!(d=yield new y(u.next())).done;l=!1){let p=d.value;yield p}}catch{h=[d]}finally{try{l&&(d=u.return)&&(yield new y(d.call(u)))}finally{if(h)throw h[0]}}}finally{yield new y(o)}})}streamEvents(e,t,r){let a;if(t.version==="v1")a=this._streamEventsV1(e,t,r);else if(t.version==="v2")a=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?ul(a):le.fromAsyncGenerator(a)}_streamEventsV2(e,t,r){return C(this,null,function*(){let a=new un(m(c({},r),{autoClose:!1})),i=G(t),s=i.runId??Y();i.runId=s;let o=i.callbacks;if(o===void 0)i.callbacks=[a];else if(Array.isArray(o))i.callbacks=o.concat(a);else{let w=o.copy();w.inheritableHandlers.push(a),i.callbacks=w}let u=this;function l(){return f(this,null,function*(){try{let V=yield u.stream(e,i),J=a.tapOutputIterable(s,V);try{for(var w=D(J),P,M,F;P=!(M=yield w.next()).done;P=!1){let Q=M.value;;}}catch{F=[M]}finally{try{P&&(M=w.return)&&(yield M.call(w))}finally{if(F)throw F[0]}}}finally{yield a.finish()}})}let d=l(),h=!1,p;try{try{for(var g=D(a),U,L,T;U=!(L=yield new y(g.next())).done;U=!1){let w=L.value;if(!h){w.data.input=e,h=!0,p=w.run_id,yield w;continue}w.run_id===p&&w.event.endsWith("_end")&&w.data?.input&&delete w.data.input,yield w}}catch{T=[L]}finally{try{U&&(L=g.return)&&(yield new y(L.call(g)))}finally{if(T)throw T[0]}}}finally{yield new y(d)}})}_streamEventsV1(e,t,r){return C(this,null,function*(){let a,i=!1,s=G(t),o=s.tags??[],u=s.metadata??{},l=s.runName??this.getName(),d=new nr(m(c({},r),{autoClose:!1,_schemaFormat:"streaming_events"})),h=new fn(c({},r)),p=this._streamLog(e,d,s);try{for(var U=D(p),L,T,w;L=!(T=yield new y(U.next())).done;L=!1){let P=T.value;if(a?a=a.concat(P):a=rr.fromRunLogPatch(P),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let J=c({},a.state),Q={run_id:J.id,event:`on_${J.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};h.includeEvent(Q,J.type)&&(yield Q)}let M=P.ops.filter(J=>J.path.startsWith("/logs/")).map(J=>J.path.split("/")[2]),F=[...new Set(M)];for(let J of F){let Q,W={},ae=a.state.logs[J];if(ae.end_time===void 0?ae.streamed_output.length>0?Q="stream":Q="start":Q="end",Q==="start")ae.inputs!==void 0&&(W.input=ae.inputs);else if(Q==="end")ae.inputs!==void 0&&(W.input=ae.inputs),W.output=ae.final_output;else if(Q==="stream"){let ui=ae.streamed_output.length;if(ui!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${ui} instead. Encountered in: "${ae.name}"`);W={chunk:ae.streamed_output[0]},ae.streamed_output=[]}yield{event:`on_${ae.type}_${Q}`,name:ae.name,run_id:ae.id,tags:ae.tags,metadata:ae.metadata,data:W}}let{state:V}=a;if(V.streamed_output.length>0){let J=V.streamed_output.length;if(J!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${J} instead. Encountered in: "${V.name}"`);let Q={chunk:V.streamed_output[0]};V.streamed_output=[];let W={event:`on_${V.type}_stream`,run_id:V.id,tags:o,metadata:u,name:l,data:Q};h.includeEvent(W,V.type)&&(yield W)}}}catch{w=[T]}finally{try{L&&(T=U.return)&&(yield new y(T.call(U)))}finally{if(w)throw w[0]}}let g=a?.state;if(g!==void 0){let P={event:`on_${g.type}_end`,name:l,run_id:g.id,tags:o,metadata:u,data:{output:g.final_output}};h.includeEvent(P,g.type)&&(yield P)}})}static isRunnable(e){return sr(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new gt({bound:this,config:{},configFactories:[a=>({callbacks:[new ir({config:a,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return qp(this,e)}},gt=class n extends te{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}_mergeConfig(...e){return f(this,null,function*(){let t=qa(this.config,...e);return qa(t,...this.configFactories?yield Promise.all(this.configFactories.map(r=>f(this,null,function*(){return yield r(t)}))):[])})}bind(e){return new this.constructor({bound:this.bound,kwargs:c(c({},this.kwargs),e),config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:c(c({},this.config),e)})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}invoke(e,t){return f(this,null,function*(){return this.bound.invoke(e,yield this._mergeConfig(G(t),this.kwargs))})}batch(e,t,r){return f(this,null,function*(){let a=Array.isArray(t)?yield Promise.all(t.map(i=>f(this,null,function*(){return this._mergeConfig(G(i),this.kwargs)}))):yield this._mergeConfig(G(t),this.kwargs);return this.bound.batch(e,a,r)})}_streamIterator(e,t){return C(this,null,function*(){yield*ie(this.bound._streamIterator(e,yield new y(this._mergeConfig(G(t),this.kwargs))))})}stream(e,t){return f(this,null,function*(){return this.bound.stream(e,yield this._mergeConfig(G(t),this.kwargs))})}transform(e,t){return C(this,null,function*(){yield*ie(this.bound.transform(e,yield new y(this._mergeConfig(G(t),this.kwargs))))})}streamEvents(e,t,r){let a=this,i=function(){return C(this,null,function*(){yield*ie(a.bound.streamEvents(e,m(c({},yield new y(a._mergeConfig(G(t),a.kwargs))),{version:t.version}),r))})};return le.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&te.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new ir({config:a,onStart:e,onEnd:t,onError:r})]})]})}},Qa=class n extends te{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new n({bound:this.bound.bind(e)})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_invoke(e,t,r){return f(this,null,function*(){return this.bound.batch(e,ne(t,{callbacks:r?.getChild()}))})}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},ei=class n extends gt{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return ne(t,{callbacks:r?.getChild(a)})}_invoke(e,t,r){return f(this,null,function*(){return(0,Ya.default)(a=>xn(n.prototype,this,"invoke").call(this,e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_batch(e,t,r,a){return f(this,null,function*(){let i={};try{yield(0,Ya.default)(s=>f(this,null,function*(){let o=e.map((p,g)=>g).filter(p=>i[p.toString()]===void 0||i[p.toString()]instanceof Error),u=o.map(p=>e[p]),l=o.map(p=>this._patchConfigForRetry(s,t?.[p],r?.[p])),d=yield xn(n.prototype,this,"batch").call(this,u,l,m(c({},a),{returnExceptions:!0})),h;for(let p=0;p<d.length;p+=1){let g=d[p],U=o[p];g instanceof Error&&h===void 0&&(h=g,h.input=u[p]),i[U.toString()]=g}if(h)throw h;return d}),{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if(a?.returnExceptions!==!0)throw s}return Object.keys(i).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>i[parseInt(s,10)])})}batch(e,t,r){return f(this,null,function*(){return this._batchWithConfig(this._batch.bind(this),e,t,r)})}},gn=class n extends te{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}invoke(e,t){return f(this,null,function*(){let r=G(t),i=yield(yield Se(r))?.handleChainStart(this.toJSON(),ee(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let s=e,o;try{let u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1){let h=u[l].invoke(s,ne(r,{callbacks:i?.getChild(`seq:step:${l+1}`)}));s=yield De(h,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=yield this.last.invoke(s,ne(r,{callbacks:i?.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw yield i?.handleChainError(u),u}return yield i?.handleChainEnd(ee(o,"output")),o})}batch(e,t,r){return f(this,null,function*(){let a=this._getOptionsList(t??{},e.length),i=yield Promise.all(a.map(Se)),s=yield Promise.all(i.map((u,l)=>f(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),ee(e[l],"input"),a[l].runId,void 0,void 0,void 0,a[l].runName);return delete a[l].runId,d}))),o=e;try{for(let u=0;u<this.steps.length;u+=1){let d=this.steps[u].batch(o,s.map((h,p)=>{let g=h?.getChild(`seq:step:${u+1}`);return ne(a[p],{callbacks:g})}),r);o=yield De(d,a[0]?.signal)}}catch(u){throw yield Promise.all(s.map(l=>l?.handleChainError(u))),u}return yield Promise.all(s.map(u=>u?.handleChainEnd(ee(o,"output")))),o})}_streamIterator(e,t){return C(this,null,function*(){let r=yield new y(Se(t)),h=t??{},{runId:a}=h,i=ce(h,["runId"]),s=yield new y(r?.handleChainStart(this.toJSON(),ee(e,"input"),a,void 0,void 0,void 0,i?.runName)),o=[this.first,...this.middle,this.last],u=!0,l;function d(){return C(this,null,function*(){yield e})}try{let T=o[0].transform(d(),ne(i,{callbacks:s?.getChild("seq:step:1")}));for(let w=1;w<o.length;w+=1){let P=o[w];T=yield new y(P.transform(T,ne(i,{callbacks:s?.getChild(`seq:step:${w+1}`)})))}try{for(var p=D(T),g,U,L;g=!(U=yield new y(p.next())).done;g=!1){let w=U.value;if(t?.signal?.throwIfAborted(),yield w,u)if(l===void 0)l=w;else try{l=Ue(l,w)}catch{l=void 0,u=!1}}}catch{L=[U]}finally{try{g&&(U=p.return)&&(yield new y(U.call(p)))}finally{if(L)throw L[0]}}}catch(T){throw yield new y(s?.handleChainError(T)),T}yield new y(s?.handleChainEnd(ee(l,"output")))})}getGraph(e){let t=new ur,r=null;return this.steps.forEach((a,i)=>{let s=a.getGraph(e);i!==0&&s.trimFirstNode(),i!==this.steps.length-1&&s.trimLastNode(),t.extend(s);let o=s.firstNode();if(!o)throw new Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,o),r=s.lastNode()}),t}pipe(e){return n.isRunnableSequence(e)?new n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new n({first:this.first,middle:[...this.middle,this.last],last:mt(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&te.isRunnable(e)}static from([e,...t],r){return new n({first:mt(e),middle:t.slice(0,-1).map(mt),last:mt(t[t.length-1]),name:r})}},lr=class n extends te{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,r]of Object.entries(e.steps))this.steps[t]=mt(r)}static from(e){return new n({steps:e})}invoke(e,t){return f(this,null,function*(){let r=G(t),i=yield(yield Se(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let s={};try{let o=Object.entries(this.steps).map(d=>f(this,[d],function*([u,l]){s[u]=yield l.invoke(e,ne(r,{callbacks:i?.getChild(`map:key:${u}`)}))}));yield De(Promise.all(o),t?.signal)}catch(o){throw yield i?.handleChainError(o),o}return yield i?.handleChainEnd(s),s})}_transform(e,t,r){return C(this,null,function*(){let a=c({},this.steps),i=Za(e,Object.keys(a).length),s=new Map(Object.entries(a).map(([o,u],l)=>{let d=u.transform(i[l],ne(r,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,d.next().then(h=>({key:o,gen:d,result:h}))]}));for(;s.size;){let o=Promise.race(s.values()),{key:u,result:l,gen:d}=yield new y(De(o,r?.signal));s.delete(u),l.done||(yield{[u]:l.value},s.set(u,d.next().then(h=>({key:u,gen:d,result:h}))))}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function r(){return C(this,null,function*(){yield e})}let a=G(t),i=new ze({generator:this.transform(r(),a),config:a});return yield i.setup,le.fromAsyncGenerator(i)})}},ti=class n extends te{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Cr(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}invoke(e,t){return f(this,null,function*(){let[r]=this._getOptionsList(t??{},1),a=yield Se(r),i=this.func(ne(r,{callbacks:a}),e);return De(i,r?.signal)})}_streamIterator(e,t){return C(this,null,function*(){let[r]=this._getOptionsList(t??{},1),a=yield new y(this.invoke(e,t));if(mn(a)){try{for(var i=D(a),s,o,u;s=!(o=yield new y(i.next())).done;s=!1){let l=o.value;r?.signal?.throwIfAborted(),yield l}}catch{u=[o]}finally{try{s&&(o=i.return)&&(yield new y(o.call(i)))}finally{if(u)throw u[0]}}return}if(ll(a)){for(;;){r?.signal?.throwIfAborted();let l=a.next();if(l.done)break;yield l.value}return}yield a})}static from(e){return new n({func:e})}};function Zp(n){if(Cr(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var yn=class n extends te{static lc_name(){return"RunnableLambda"}constructor(e){if(Cr(e.func))return ti.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Zp(e.func),this.func=e.func}static from(e){return new n({func:e})}_invoke(e,t,r){return f(this,null,function*(){return new Promise((a,i)=>{let s=ne(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??ln)-1});Pe.runWithConfig(s,()=>f(this,null,function*(){try{let h=yield this.func(e,m(c({},s),{config:s}));if(h&&te.isRunnable(h)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");h=yield h.invoke(e,m(c({},s),{recursionLimit:(s.recursionLimit??ln)-1}))}else if(mn(h)){let p;try{for(var o=D(Xa(s,h)),u,l,d;u=!(l=yield o.next()).done;u=!1){let g=l.value;if(t?.signal?.throwIfAborted(),p===void 0)p=g;else try{p=Ue(p,g)}catch{p=g}}}catch{d=[l]}finally{try{u&&(l=o.return)&&(yield l.call(o))}finally{if(d)throw d[0]}}h=p}else if(Wa(h)){let p;for(let g of Ka(s,h))if(t?.signal?.throwIfAborted(),p===void 0)p=g;else try{p=Ue(p,g)}catch{p=g}h=p}a(h)}catch(h){i(h)}}))})})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._invoke,e,t)})}_transform(e,t,r){return C(this,null,function*(){let a;try{for(var o=D(e),u,l,d;u=!(l=yield new y(o.next())).done;u=!1){let M=l.value;if(a===void 0)a=M;else try{a=Ue(a,M)}catch{a=M}}}catch{d=[l]}finally{try{u&&(l=o.return)&&(yield new y(l.call(o)))}finally{if(d)throw d[0]}}let i=ne(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??ln)-1}),s=yield new y(new Promise((M,F)=>{Pe.runWithConfig(i,()=>f(this,null,function*(){try{let V=yield this.func(a,m(c({},i),{config:i}));M(V)}catch(V){F(V)}}))}));if(s&&te.isRunnable(s)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");let M=yield new y(s.stream(a,i));try{for(var h=D(M),p,g,U;p=!(g=yield new y(h.next())).done;p=!1){let F=g.value;yield F}}catch{U=[g]}finally{try{p&&(g=h.return)&&(yield new y(g.call(h)))}finally{if(U)throw U[0]}}}else if(mn(s))try{for(var L=D(Xa(i,s)),T,w,P;T=!(w=yield new y(L.next())).done;T=!1){let M=w.value;r?.signal?.throwIfAborted(),yield M}}catch{P=[w]}finally{try{T&&(w=L.return)&&(yield new y(w.call(L)))}finally{if(P)throw P[0]}}else if(Wa(s))for(let M of Ka(i,s))r?.signal?.throwIfAborted(),yield M;else yield s})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function r(){return C(this,null,function*(){yield e})}let a=G(t),i=new ze({generator:this.transform(r(),a),config:a});return yield i.setup,le.fromAsyncGenerator(i)})}};var ri=class extends te{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}invoke(e,t){return f(this,null,function*(){let r=G(t),a=yield Se(t),l=r,{runId:i}=l,s=ce(l,["runId"]),o=yield a?.handleChainStart(this.toJSON(),ee(e,"input"),i,void 0,void 0,void 0,s?.runName),u;for(let d of this.runnables()){r?.signal?.throwIfAborted();try{let h=yield d.invoke(e,ne(s,{callbacks:o?.getChild()}));return yield o?.handleChainEnd(ee(h,"output")),h}catch(h){u===void 0&&(u=h)}}throw u===void 0?new Error("No error stored at end of fallback."):(yield o?.handleChainError(u),u)})}_streamIterator(e,t){return C(this,null,function*(){let r=G(t),a=yield new y(Se(t)),h=r,{runId:i}=h,s=ce(h,["runId"]),o=yield new y(a?.handleChainStart(this.toJSON(),ee(e,"input"),i,void 0,void 0,void 0,s?.runName)),u,l;for(let T of this.runnables()){r?.signal?.throwIfAborted();let w=ne(s,{callbacks:o?.getChild()});try{l=yield new y(T.stream(e,w));break}catch(P){u===void 0&&(u=P)}}if(l===void 0){let T=u??new Error("No error stored at end of fallback.");throw yield new y(o?.handleChainError(T)),T}let d;try{try{for(var p=D(l),g,U,L;g=!(U=yield new y(p.next())).done;g=!1){let T=U.value;yield T;try{d=d===void 0?d:Ue(d,T)}catch{d=void 0}}}catch{L=[U]}finally{try{g&&(U=p.return)&&(yield new y(U.call(p)))}finally{if(L)throw L[0]}}}catch(T){throw yield new y(o?.handleChainError(T)),T}yield new y(o?.handleChainEnd(ee(d,"output")))})}batch(e,t,r){return f(this,null,function*(){if(r?.returnExceptions)throw new Error("Not implemented.");let a=this._getOptionsList(t??{},e.length),i=yield Promise.all(a.map(u=>Se(u))),s=yield Promise.all(i.map((u,l)=>f(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),ee(e[l],"input"),a[l].runId,void 0,void 0,void 0,a[l].runName);return delete a[l].runId,d}))),o;for(let u of this.runnables()){a[0].signal?.throwIfAborted();try{let l=yield u.batch(e,s.map((d,h)=>ne(a[h],{callbacks:d?.getChild()})),r);return yield Promise.all(s.map((d,h)=>d?.handleChainEnd(ee(l[h],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(yield Promise.all(s.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")})}};function mt(n){if(typeof n=="function")return new yn({func:n});if(te.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){let e={};for(let[t,r]of Object.entries(n))e[t]=mt(r);return new lr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var ni=class extends te{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof lr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}invoke(e,t){return f(this,null,function*(){let r=yield this.mapper.invoke(e,t);return c(c({},e),r)})}_transform(e,t,r){return C(this,null,function*(){let a=this.mapper.getStepsKeys(),[i,s]=Za(e),o=this.mapper.transform(s,ne(r,{callbacks:t?.getChild()})),u=o.next();try{for(var l=D(i),d,h,p;d=!(h=yield new y(l.next())).done;d=!1){let w=h.value;if(typeof w!="object"||Array.isArray(w))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof w}`);let P=Object.fromEntries(Object.entries(w).filter(([M])=>!a.includes(M)));Object.keys(P).length>0&&(yield P)}}catch{p=[h]}finally{try{d&&(h=l.return)&&(yield new y(h.call(l)))}finally{if(p)throw p[0]}}yield(yield new y(u)).value;try{for(var g=D(o),U,L,T;U=!(L=yield new y(g.next())).done;U=!1){let w=L.value;yield w}}catch{T=[L]}finally{try{U&&(L=g.return)&&(yield new y(L.call(g)))}finally{if(T)throw T[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function r(){return C(this,null,function*(){yield e})}let a=G(t),i=new ze({generator:this.transform(r(),a),config:a});return yield i.setup,le.fromAsyncGenerator(i)})}},ai=class extends te{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}_pick(e){return f(this,null,function*(){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._pick.bind(this),e,t)})}_transform(e){return C(this,null,function*(){try{for(var t=D(e),r,a,i;r=!(a=yield new y(t.next())).done;r=!1){let s=a.value;let o=yield new y(this._pick(s));o!==void 0&&(yield o)}}catch{i=[a]}finally{try{r&&(a=t.return)&&(yield new y(a.call(t)))}finally{if(i)throw i[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function r(){return C(this,null,function*(){yield e})}let a=G(t),i=new ze({generator:this.transform(r(),a),config:a});return yield i.setup,le.fromAsyncGenerator(i)})}},_n=class extends gt{constructor(e){let t=gn.from([yn.from(r=>f(this,null,function*(){let a;if(Sn(r))try{a=yield this.schema.parseAsync(r.args)}catch{throw new hr("Received tool input did not match expected schema",JSON.stringify(r.args))}else a=r;return a})).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function qp(n,e){let t=e.name??n.getName(),r=e.description??e.schema?.description;return e.schema.constructor===xt.ZodString?new _n({name:t,description:r,schema:xt.object({input:xt.string()}).transform(a=>a.input),bound:n}):new _n({name:t,description:r,schema:e.schema,bound:n})}var bn=class extends te{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}mergePartialAndUserVariables(e){return f(this,null,function*(){let t=this.partialVariables??{},r={};for(let[i,s]of Object.entries(t))typeof s=="string"?r[i]=s:r[i]=yield s();return c(c({},r),e)})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(r=>this.formatPromptValue(r),e,m(c({},t),{runType:"prompt"}))})}serialize(){throw new Error("Use .toJSON() instead")}static deserialize(e){return f(this,null,function*(){switch(e._type){case"prompt":{let{PromptTemplate:t}=yield import("./chunk-27LZZFO3.js");return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=yield import("./chunk-27LZZFO3.js");return t.deserialize(m(c({},e),{_type:"prompt"}))}case"few_shot":{let{FewShotPromptTemplate:t}=yield import("./chunk-7WIVCTYZ.js");return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}})}};var wn=class extends bn{formatPromptValue(e){return f(this,null,function*(){let t=yield this.format(e);return new gr(t)})}};var Hp=Object.prototype.toString,Ct=Array.isArray||function(e){return Hp.call(e)==="[object Array]"};function si(n){return typeof n=="function"}function Bp(n){return Ct(n)?"array":typeof n}function ii(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function cl(n,e){return n!=null&&typeof n=="object"&&e in n}function Vp(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var Gp=RegExp.prototype.test;function zp(n,e){return Gp.call(n,e)}var Jp=/\S/;function Wp(n){return!zp(Jp,n)}var Kp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Xp(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Kp[t]})}var Yp=/\s*/,Qp=/\s+/,dl=/\s*=/,em=/\s*\}/,tm=/#|\^|\/|>|\{|&|=|!/;function rm(n,e){if(!n)return[];var t=!1,r=[],a=[],i=[],s=!1,o=!1,u="",l=0;function d(){if(s&&!o)for(;i.length;)delete a[i.pop()];else i=[];s=!1,o=!1}var h,p,g;function U(W){if(typeof W=="string"&&(W=W.split(Qp,2)),!Ct(W)||W.length!==2)throw new Error("Invalid tags: "+W);h=new RegExp(ii(W[0])+"\\s*"),p=new RegExp("\\s*"+ii(W[1])),g=new RegExp("\\s*"+ii("}"+W[1]))}U(e||Ie.tags);for(var L=new dr(n),T,w,P,M,F,V;!L.eos();){if(T=L.pos,P=L.scanUntil(h),P)for(var J=0,Q=P.length;J<Q;++J)M=P.charAt(J),Wp(M)?(i.push(a.length),u+=M):(o=!0,t=!0,u+=" "),a.push(["text",M,T,T+1]),T+=1,M===`
`&&(d(),u="",l=0,t=!1);if(!L.scan(h))break;if(s=!0,w=L.scan(tm)||"name",L.scan(Yp),w==="="?(P=L.scanUntil(dl),L.scan(dl),L.scanUntil(p)):w==="{"?(P=L.scanUntil(g),L.scan(em),L.scanUntil(p),w="&"):P=L.scanUntil(p),!L.scan(p))throw new Error("Unclosed tag at "+L.pos);if(w==">"?F=[w,P,T,L.pos,u,l,t]:F=[w,P,T,L.pos],l++,a.push(F),w==="#"||w==="^")r.push(F);else if(w==="/"){if(V=r.pop(),!V)throw new Error('Unopened section "'+P+'" at '+T);if(V[1]!==P)throw new Error('Unclosed section "'+V[1]+'" at '+T)}else w==="name"||w==="{"||w==="&"?o=!0:w==="="&&U(P)}if(d(),V=r.pop(),V)throw new Error('Unclosed section "'+V[1]+'" at '+L.pos);return am(nm(a))}function nm(n){for(var e=[],t,r,a=0,i=n.length;a<i;++a)t=n[a],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function am(n){for(var e=[],t=e,r=[],a,i,s=0,o=n.length;s<o;++s)switch(a=n[s],a[0]){case"#":case"^":t.push(a),r.push(a),t=a[4]=[];break;case"/":i=r.pop(),i[5]=a[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(a)}return e}function dr(n){this.string=n,this.tail=n,this.pos=0}dr.prototype.eos=function(){return this.tail===""};dr.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};dr.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function At(n,e){this.view=n,this.cache={".":this.view},this.parent=e}At.prototype.push=function(e){return new At(e,this)};At.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var a=this,i,s,o,u=!1;a;){if(e.indexOf(".")>0)for(i=a.view,s=e.split("."),o=0;i!=null&&o<s.length;)o===s.length-1&&(u=cl(i,s[o])||Vp(i,s[o])),i=i[s[o++]];else i=a.view[e],u=cl(a.view,e);if(u){r=i;break}a=a.parent}t[e]=r}return si(r)&&(r=r.call(this.view)),r};function ge(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}ge.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};ge.prototype.parse=function(e,t){var r=this.templateCache,a=e+":"+(t||Ie.tags).join(":"),i=typeof r<"u",s=i?r.get(a):void 0;return s==null&&(s=rm(e,t),i&&r.set(a,s)),s};ge.prototype.render=function(e,t,r,a){var i=this.getConfigTags(a),s=this.parse(e,i),o=t instanceof At?t:new At(t,void 0);return this.renderTokens(s,o,r,e,a)};ge.prototype.renderTokens=function(e,t,r,a,i){for(var s="",o,u,l,d=0,h=e.length;d<h;++d)l=void 0,o=e[d],u=o[0],u==="#"?l=this.renderSection(o,t,r,a,i):u==="^"?l=this.renderInverted(o,t,r,a,i):u===">"?l=this.renderPartial(o,t,r,i):u==="&"?l=this.unescapedValue(o,t):u==="name"?l=this.escapedValue(o,t,i):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(s+=l);return s};ge.prototype.renderSection=function(e,t,r,a,i){var s=this,o="",u=t.lookup(e[1]);function l(p){return s.render(p,t,r,i)}if(u){if(Ct(u))for(var d=0,h=u.length;d<h;++d)o+=this.renderTokens(e[4],t.push(u[d]),r,a,i);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,a,i);else if(si(u)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,a.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,a,i);return o}};ge.prototype.renderInverted=function(e,t,r,a,i){var s=t.lookup(e[1]);if(!s||Ct(s)&&s.length===0)return this.renderTokens(e[4],t,r,a,i)};ge.prototype.indentPartial=function(e,t,r){for(var a=t.replace(/[^ \t]/g,""),i=e.split(`
`),s=0;s<i.length;s++)i[s].length&&(s>0||!r)&&(i[s]=a+i[s]);return i.join(`
`)};ge.prototype.renderPartial=function(e,t,r,a){if(r){var i=this.getConfigTags(a),s=si(r)?r(e[1]):r[e[1]];if(s!=null){var o=e[6],u=e[5],l=e[4],d=s;u==0&&l&&(d=this.indentPartial(s,l,o));var h=this.parse(d,i);return this.renderTokens(h,t,r,d,a)}}};ge.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};ge.prototype.escapedValue=function(e,t,r){var a=this.getConfigEscape(r)||Ie.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&a===Ie.escape?String(i):a(i)};ge.prototype.rawValue=function(e){return e[1]};ge.prototype.getConfigTags=function(e){return Ct(e)?e:e&&typeof e=="object"?e.tags:void 0};ge.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ct(e))return e.escape};var Ie={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){cr.templateCache=n},get templateCache(){return cr.templateCache}},cr=new ge;Ie.clearCache=function(){return cr.clearCache()};Ie.parse=function(e,t){return cr.parse(e,t)};Ie.render=function(e,t,r,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Bp(e)+'" was given as the first argument for mustache#render(template, view, partials)');return cr.render(e,t,r,a)};Ie.escape=Xp;Ie.Scanner=dr;Ie.Context=At;Ie.Writer=ge;var vn=Ie;function fl(){vn.escape=n=>n}var hl=n=>{let e=n.split(""),t=[],r=(i,s)=>{for(let o=s;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1},a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){let i=r("}",a);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,i).join("")}),a=i+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{let i=r("{}",a),s=(i<0?e.slice(a):e.slice(a,i)).join("");t.push({type:"literal",text:s}),a=i<0?e.length:i}}return t},im=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),sm=n=>{fl();let e=vn.parse(n);return im(e)},om=(n,e)=>hl(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),um=(n,e)=>(fl(),vn.render(n,e)),oi={"f-string":om,mustache:um},lm={"f-string":hl,mustache:sm},Nt=(n,e,t)=>oi[e](n,t),pl=(n,e)=>lm[e](n),ml=(n,e,t)=>{if(!(e in oi)){let r=Object.keys(oi);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{let r=t.reduce((a,i)=>(a[i]="foo",a),{});Array.isArray(n)?n.forEach(a=>{if(a.type==="text")Nt(a.text,e,r);else if(a.type==="image_url")if(typeof a.image_url=="string")Nt(a.image_url,e,r);else{let i=a.image_url.url;Nt(i,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(a,null,2)}`)}):Nt(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};var gl=class n extends wn{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),ml(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}format(e){return f(this,null,function*(){let t=yield this.mergePartialAndUserVariables(e);return Nt(this.template,this.templateFormat,t)})}static fromExamples(e,t,r,a=`

`,i=""){let s=[i,...e,t].join(a);return new n({inputVariables:r,template:s})}static fromTemplate(e,t){let s=t??{},{templateFormat:r="f-string"}=s,a=ce(s,["templateFormat"]),i=new Set;return pl(e,r).forEach(o=>{o.type==="variable"&&i.add(o.name)}),new n(c({inputVariables:[...i],templateFormat:r,template:e},a))}partial(e){return f(this,null,function*(){let t=this.inputVariables.filter(i=>!(i in e)),r=c(c({},this.partialVariables??{}),e),a=m(c({},this),{inputVariables:t,partialVariables:r});return new n(a)})}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static deserialize(e){return f(this,null,function*(){if(!e.template)throw new Error("Prompt template must have a template");return new n({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})})}};export{Y as a,xi as b,wn as c,Nt as d,ml as e,gl as f,bn as g};
