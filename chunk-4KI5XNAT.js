import{b as d,c as h,d as m,e as c,f as b,g}from"./chunk-F75AY6IO.js";import{a as n,b as l,h as r}from"./chunk-TJICSKBO.js";var f=class extends g{constructor(e){super(e)}format(e){return r(this,null,function*(){return(yield this.formatPromptValue(e)).toString()})}formatPromptValue(e){return r(this,null,function*(){let t=yield this.formatMessages(e);return new d(t)})}};var w=class u extends h{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),c(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}getExamples(e){return r(this,null,function*(){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")})}partial(e){return r(this,null,function*(){let t=this.inputVariables.filter(i=>!(i in e)),a=n(n({},this.partialVariables??{}),e),s=l(n({},this),{inputVariables:t,partialVariables:a});return new u(s)})}format(e){return r(this,null,function*(){let t=yield this.mergePartialAndUserVariables(e),a=yield this.getExamples(t),s=yield Promise.all(a.map(o=>this.examplePrompt.format(o))),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return m(i,this.templateFormat,t)})}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static deserialize(e){return r(this,null,function*(){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let a=yield b.deserialize(t),s;if(Array.isArray(e.examples))s=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new u({inputVariables:e.input_variables,examplePrompt:a,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})})}},y=class u extends f{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),c(this.prefix+this.suffix,this.templateFormat,t)}}getExamples(e){return r(this,null,function*(){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")})}formatMessages(e){return r(this,null,function*(){let t=yield this.mergePartialAndUserVariables(e),a=yield this.getExamples(t);a=a.map(i=>{let o={};return this.examplePrompt.inputVariables.forEach(p=>{o[p]=i[p]}),o});let s=[];for(let i of a){let o=yield this.examplePrompt.formatMessages(i);s.push(...o)}return s})}format(e){return r(this,null,function*(){let t=yield this.mergePartialAndUserVariables(e),a=yield this.getExamples(t),i=(yield Promise.all(a.map(p=>this.examplePrompt.formatMessages(p)))).flat().map(p=>p.content),o=[this.prefix,...i,this.suffix].join(this.exampleSeparator);return m(o,this.templateFormat,t)})}partial(e){return r(this,null,function*(){let t=this.inputVariables.filter(i=>!(i in e)),a=n(n({},this.partialVariables??{}),e),s=l(n({},this),{inputVariables:t,partialVariables:a});return new u(s)})}};export{w as a,y as b};
